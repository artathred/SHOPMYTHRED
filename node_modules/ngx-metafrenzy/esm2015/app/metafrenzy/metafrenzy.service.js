import { Injectable, RendererFactory2, Inject, ViewEncapsulation } from '@angular/core';
import { Meta, Title } from '@angular/platform-browser';
import { DOCUMENT } from '@angular/common';
export class MetafrenzyService {
    constructor(title, meta, rendererFactory, document) {
        this.title = title;
        this.meta = meta;
        this.rendererFactory = rendererFactory;
        this.document = document;
    }
    setTitle(title) {
        this.title.setTitle(title);
    }
    getTitle() {
        return this.title.getTitle();
    }
    setMetaTag(name, content) {
        const metaDefinition = {};
        if (name.lastIndexOf('og:', 0) === 0) {
            metaDefinition['property'] = name;
        }
        else {
            metaDefinition['name'] = name;
        }
        metaDefinition['content'] = content;
        this.meta.updateTag(metaDefinition);
    }
    getMetaTag(selector, returnElement) {
        const tag = this.meta.getTag(selector);
        if (!tag) {
            return '';
        }
        return returnElement === true ? tag : tag.content;
    }
    removeMetaTag(selector) {
        if (selector instanceof HTMLMetaElement) {
            this.meta.removeTagElement(selector);
        }
        else {
            this.meta.removeTag(selector);
        }
    }
    setMetaCharsetTag(value) {
        this.meta.updateTag({
            charset: value
        }, 'charset');
    }
    removeLinkTags(shouldRemoveLinkTagCb) {
        const links = this.document.head.getElementsByTagName('link');
        const toRemove = [];
        for (let i = 0; i < links.length; i++) {
            if (shouldRemoveLinkTagCb(links[i])) {
                toRemove.push(links[i]);
            }
        }
        toRemove.forEach(el => el.remove());
    }
    setLinkTag(tag) {
        try {
            const renderer = this.rendererFactory.createRenderer(this.document, {
                id: '-1',
                encapsulation: ViewEncapsulation.None,
                styles: [],
                data: {}
            });
            const link = renderer.createElement('link');
            const head = this.document.head;
            Object.keys(tag).forEach((property) => {
                return renderer.setAttribute(link, property, String(tag[property]));
            });
            this.removeLinkTags(el => {
                if ((el.getAttribute('name') !== null &&
                    el.getAttribute('name') === link.getAttribute('name')) ||
                    (el.getAttribute('rel') !== null &&
                        el.getAttribute('rel') === link.getAttribute('rel') &&
                        link.getAttribute('rel') !== 'stylesheet' &&
                        link.getAttribute('rel') !== 'alternate')) {
                    return true;
                }
                return false;
            });
            renderer.appendChild(head, link);
        }
        catch (e) { }
    }
    setAllTitleTags(title) {
        this.setTitle(title);
        this.setMetaTag('og:title', title);
    }
    setAllDescriptionTags(description) {
        this.setMetaTag('description', description);
        this.setMetaTag('og:description', description);
    }
    setCanonical(href) {
        this.setLinkTag({
            rel: 'canonical',
            href
        });
    }
    removeCanonical() {
        this.removeLinkTags(el => el.getAttribute('rel') === 'canonical');
    }
    setRobots(content) {
        this.setLinkTag({
            rel: 'robots',
            content
        });
    }
    setOpenGraph(og) {
        Object.keys(og).forEach((name) => {
            this.setMetaTag('og:' + name, String(og[name]));
        });
    }
    setTags(tags) {
        if (tags.hasOwnProperty('title') && tags.title) {
            this.setAllTitleTags(tags.title);
        }
        if (tags.hasOwnProperty('description') && tags.description) {
            this.setAllDescriptionTags(tags.description);
        }
        if (tags.hasOwnProperty('url') && tags.url) {
            this.setMetaTag('og:url', tags.url);
            this.setCanonical(tags.url);
        }
        if (tags.hasOwnProperty('image') && tags.image) {
            this.setMetaTag('og:image:url', tags.image);
        }
        if (tags.hasOwnProperty('robots') && tags.robots) {
            this.setRobots(tags.robots);
        }
    }
}
MetafrenzyService.decorators = [
    { type: Injectable }
];
MetafrenzyService.ctorParameters = () => [
    { type: Title },
    { type: Meta },
    { type: RendererFactory2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWZyZW56eS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2FwcC9tZXRhZnJlbnp5L21ldGFmcmVuenkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RixPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQXVDM0MsTUFBTSxPQUFPLGlCQUFpQjtJQUUxQixZQUNxQixLQUFZLEVBQ1osSUFBVSxFQUNWLGVBQWlDLEVBQ3hCLFFBQWE7UUFIdEIsVUFBSyxHQUFMLEtBQUssQ0FBTztRQUNaLFNBQUksR0FBSixJQUFJLENBQU07UUFDVixvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7UUFDeEIsYUFBUSxHQUFSLFFBQVEsQ0FBSztJQUN4QyxDQUFDO0lBRUosUUFBUSxDQUFDLEtBQWE7UUFDbEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELFFBQVE7UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVELFVBQVUsQ0FBQyxJQUFZLEVBQUUsT0FBZTtRQUNwQyxNQUFNLGNBQWMsR0FBUSxFQUFFLENBQUM7UUFFL0IsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDbEMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQztTQUNyQzthQUFNO1lBQ0gsY0FBYyxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQztTQUNqQztRQUVELGNBQWMsQ0FBQyxTQUFT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QyxDQUFDO1NBQy9CO0lBQ0wsQ0FBQzs7O1lBL0pKLFVBQVU7OztZQXZDSSxLQUFLO1lBQVgsSUFBSTtZQURRLGdCQUFnQjs0Q0ErQzVCLE1BQU0sU0FBQyxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgUmVuZGVyZXJGYWN0b3J5MiwgSW5qZWN0LCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXRhLCBUaXRsZSB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExpbmtEZWZpbml0aW9uIHtcclxuICAgIGNoYXJzZXQ/OiBzdHJpbmc7XHJcbiAgICBjcm9zc29yaWdpbj86IHN0cmluZztcclxuICAgIGhyZWY/OiBzdHJpbmc7XHJcbiAgICBocmVmbGFuZz86IHN0cmluZztcclxuICAgIG1lZGlhPzogc3RyaW5nO1xyXG4gICAgcmVsPzogc3RyaW5nO1xyXG4gICAgcmV2Pzogc3RyaW5nO1xyXG4gICAgc2l6ZXM/OiBzdHJpbmc7XHJcbiAgICB0YXJnZXQ/OiBzdHJpbmc7XHJcbiAgICB0eXBlPzogc3RyaW5nO1xyXG4gICAgW3Byb3A6IHN0cmluZ106IHN0cmluZyB8IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBPcGVuR3JhcGgge1xyXG4gICAgdGl0bGU/OiBzdHJpbmc7XHJcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcclxuICAgIHR5cGU/OiBzdHJpbmc7XHJcbiAgICB1cmw/OiBzdHJpbmc7XHJcbiAgICBpbWFnZT86IHN0cmluZztcclxuICAgIHNpdGVfbmFtZT86IHN0cmluZztcclxuICAgIFtwcm9wOiBzdHJpbmddOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVGFncyB7XHJcbiAgICB0aXRsZT86IHN0cmluZztcclxuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xyXG4gICAgdXJsPzogc3RyaW5nO1xyXG4gICAgcm9ib3RzPzogUm9ib3RzO1xyXG4gICAgaW1hZ2U/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFJvYm90cyA9XHJcbiAgICAnaW5kZXgsZm9sbG93JyB8ICdpbmRleCxub2ZvbGxvdycgfCAnbm9pbmRleCxub2ZvbGxvdycgfCAnbm9pbmRleCxmb2xsb3cnIHxcclxuICAgICdpbmRleCwgZm9sbG93JyB8ICdpbmRleCwgbm9mb2xsb3cnIHwgJ25vaW5kZXgsIG5vZm9sbG93JyB8ICdub2luZGV4LCBmb2xsb3cnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTWV0YWZyZW56eVNlcnZpY2Uge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgdGl0bGU6IFRpdGxlLFxyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgbWV0YTogTWV0YSxcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHJlbmRlcmVyRmFjdG9yeTogUmVuZGVyZXJGYWN0b3J5MixcclxuICAgICAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50OiBhbnlcclxuICAgICkge31cclxuXHJcbiAgICBzZXRUaXRsZSh0aXRsZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy50aXRsZS5zZXRUaXRsZSh0aXRsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGl0bGUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50aXRsZS5nZXRUaXRsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE1ldGFUYWcobmFtZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBtZXRhRGVmaW5pdGlvbjogYW55ID0ge307XHJcblxyXG4gICAgICAgIGlmIChuYW1lLmxhc3RJbmRleE9mKCdvZzonLCAwKSA9PT0gMCkge1xyXG4gICAgICAgICAgICBtZXRhRGVmaW5pdGlvblsncHJvcGVydHknXSA9IG5hbWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbWV0YURlZmluaXRpb25bJ25hbWUnXSA9IG5hbWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtZXRhRGVmaW5pdGlvblsnY29udGVudCddID0gY29udGVudDtcclxuXHJcbiAgICAgICAgdGhpcy5tZXRhLnVwZGF0ZVRhZyhtZXRhRGVmaW5pdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TWV0YVRhZyhzZWxlY3Rvcjogc3RyaW5nLCByZXR1cm5FbGVtZW50PzogYm9vbGVhbik6IHN0cmluZ3xIVE1MTWV0YUVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IHRhZyA9IHRoaXMubWV0YS5nZXRUYWcoc2VsZWN0b3IpO1xyXG4gICAgICAgIGlmICghdGFnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXR1cm5FbGVtZW50ID09PSB0cnVlID8gdGFnIDogdGFnLmNvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlTWV0YVRhZyhzZWxlY3Rvcjogc3RyaW5nfEhUTUxNZXRhRWxlbWVudCkge1xyXG4gICAgICAgIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIEhUTUxNZXRhRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLm1ldGEucmVtb3ZlVGFnRWxlbWVudChzZWxlY3Rvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tZXRhLnJlbW92ZVRhZyhzZWxlY3Rvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldE1ldGFDaGFyc2V0VGFnKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLm1ldGEudXBkYXRlVGFnKHtcclxuICAgICAgICAgICAgY2hhcnNldDogdmFsdWVcclxuICAgICAgICB9LCAnY2hhcnNldCcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUxpbmtUYWdzKHNob3VsZFJlbW92ZUxpbmtUYWdDYjogKGxpbmtUYWc6IEhUTUxMaW5rRWxlbWVudCkgPT4gYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IGxpbmtzOiBIVE1MQ29sbGVjdGlvbk9mPEhUTUxMaW5rRWxlbWVudD4gPSB0aGlzLmRvY3VtZW50LmhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xpbmsnKTtcclxuXHJcbiAgICAgICAgY29uc3QgdG9SZW1vdmU6IEhUTUxMaW5rRWxlbWVudFtdID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlua3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHNob3VsZFJlbW92ZUxpbmtUYWdDYihsaW5rc1tpXSkpIHtcclxuICAgICAgICAgICAgICAgIHRvUmVtb3ZlLnB1c2gobGlua3NbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0b1JlbW92ZS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRMaW5rVGFnKHRhZzogTGlua0RlZmluaXRpb24pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMucmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKHRoaXMuZG9jdW1lbnQsIHtcclxuICAgICAgICAgICAgICAgIGlkOiAnLTEnLFxyXG4gICAgICAgICAgICAgICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICAgICAgICAgICAgICAgIHN0eWxlczogW10sXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7fVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSByZW5kZXJlci5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlYWQgPSB0aGlzLmRvY3VtZW50LmhlYWQ7XHJcblxyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyh0YWcpLmZvckVhY2goKHByb3BlcnR5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJlci5zZXRBdHRyaWJ1dGUobGluaywgcHJvcGVydHksIFN0cmluZyh0YWdbcHJvcGVydHldKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVMaW5rVGFncyhlbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgKGVsLmdldEF0dHJpYnV0ZSgnbmFtZScpICE9PSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgnbmFtZScpID09PSBsaW5rLmdldEF0dHJpYnV0ZSgnbmFtZScpKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgIChlbC5nZXRBdHRyaWJ1dGUoJ3JlbCcpICE9PSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgncmVsJykgPT09IGxpbmsuZ2V0QXR0cmlidXRlKCdyZWwnKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmdldEF0dHJpYnV0ZSgncmVsJykgIT09ICdzdHlsZXNoZWV0JyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmdldEF0dHJpYnV0ZSgncmVsJykgIT09ICdhbHRlcm5hdGUnKVxyXG4gICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZW5kZXJlci5hcHBlbmRDaGlsZChoZWFkLCBsaW5rKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7fVxyXG4gICAgfVxyXG5cclxuICAgIHNldEFsbFRpdGxlVGFncyh0aXRsZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5zZXRUaXRsZSh0aXRsZSk7XHJcbiAgICAgICAgdGhpcy5zZXRNZXRhVGFnKCdvZzp0aXRsZScsIHRpdGxlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRBbGxEZXNjcmlwdGlvblRhZ3MoZGVzY3JpcHRpb246IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuc2V0TWV0YVRhZygnZGVzY3JpcHRpb24nLCBkZXNjcmlwdGlvbik7XHJcbiAgICAgICAgdGhpcy5zZXRNZXRhVGFnKCdvZzpkZXNjcmlwdGlvbicsIGRlc2NyaXB0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRDYW5vbmljYWwoaHJlZjogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5zZXRMaW5rVGFnKHtcclxuICAgICAgICAgICAgcmVsOiAnY2Fub25pY2FsJyxcclxuICAgICAgICAgICAgaHJlZlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUNhbm9uaWNhbCgpIHtcclxuICAgICAgdGhpcy5yZW1vdmVMaW5rVGFncyhlbCA9PiBlbC5nZXRBdHRyaWJ1dGUoJ3JlbCcpID09PSAnY2Fub25pY2FsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Um9ib3RzKGNvbnRlbnQ6IFJvYm90cykge1xyXG4gICAgICAgIHRoaXMuc2V0TGlua1RhZyh7XHJcbiAgICAgICAgICAgIHJlbDogJ3JvYm90cycsXHJcbiAgICAgICAgICAgIGNvbnRlbnRcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRPcGVuR3JhcGgob2c6IE9wZW5HcmFwaCkge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKG9nKS5mb3JFYWNoKChuYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRNZXRhVGFnKCdvZzonICsgbmFtZSwgU3RyaW5nKG9nW25hbWVdKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGFncyh0YWdzOiBUYWdzKSB7XHJcbiAgICAgICAgaWYgKHRhZ3MuaGFzT3duUHJvcGVydHkoJ3RpdGxlJykgJiYgdGFncy50aXRsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEFsbFRpdGxlVGFncyh0YWdzLnRpdGxlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0YWdzLmhhc093blByb3BlcnR5KCdkZXNjcmlwdGlvbicpICYmIHRhZ3MuZGVzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRBbGxEZXNjcmlwdGlvblRhZ3ModGFncy5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGFncy5oYXNPd25Qcm9wZXJ0eSgndXJsJykgJiYgdGFncy51cmwpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRNZXRhVGFnKCdvZzp1cmwnLCB0YWdzLnVybCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2Fub25pY2FsKHRhZ3MudXJsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0YWdzLmhhc093blByb3BlcnR5KCdpbWFnZScpICYmIHRhZ3MuaW1hZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRNZXRhVGFnKCdvZzppbWFnZTp1cmwnLCB0YWdzLmltYWdlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0YWdzLmhhc093blByb3BlcnR5KCdyb2JvdHMnKSAmJiB0YWdzLnJvYm90cykge1xyXG4gICAgICAgICAgICB0aGlzLnNldFJvYm90cyh0YWdzLnJvYm90cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=