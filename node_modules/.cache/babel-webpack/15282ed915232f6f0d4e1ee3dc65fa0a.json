{"ast":null,"code":"import _asyncToGenerator from \"/Users/artakoroushnia/Desktop/thred-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { DragScrollComponent } from 'ngx-drag-scroll';\nimport { CropperComponent } from '../cropper/cropper.component';\nimport { Globals } from '../globals';\nimport { Validators } from '@angular/forms';\nimport * as html2canvas from 'html2canvas';\nimport { CurrencyMaskInputMode } from \"ngx-currency\";\nlet DesignComponent = class DesignComponent {\n  constructor(sanitizer, cdr, modalService, activeModal, fb, spinner) {\n    this.cdr = cdr;\n    this.modalService = modalService;\n    this.activeModal = activeModal;\n    this.fb = fb;\n    this.spinner = spinner;\n    this.customCurrencyMaskConfig = {\n      align: \"left\",\n      allowNegative: false,\n      allowZero: true,\n      decimal: \".\",\n      precision: 2,\n      prefix: \"$ \",\n      suffix: \"\",\n      thousands: \",\",\n      min: 0,\n      inputMode: CurrencyMaskInputMode.NATURAL\n    };\n    this.selectedSide = 0;\n    this.step = 0;\n    this.openCrop = false;\n    this.designForm = this.fb.group({\n      company: null,\n      firstName: [null, Validators.required],\n      lastName: [null, Validators.required],\n      price: [null, [Validators.required, Validators.pattern(\"^([0-9]{0,2}((.)[0-9]{0,2}))$\")]]\n    });\n    this.sanitizer = sanitizer;\n  }\n\n  myInnerHeight() {\n    let height = window.innerHeight;\n    let width = window.innerWidth;\n\n    if (width < height) {\n      return width * 0.98;\n    } else {\n      if (this.step == 0) {\n        return height * 0.70;\n      }\n\n      return height * 0.70;\n    }\n  }\n\n  storeInfo() {\n    return Globals.storeInfo;\n  }\n\n  availableCurrencies() {\n    return Globals.availableCurrencies;\n  }\n\n  selectedCurrency() {\n    return Globals.selectedCurrency;\n  }\n\n  availableTemplates() {\n    return Globals.availableTemplates;\n  }\n\n  products() {\n    return Globals.products;\n  }\n\n  selectedIndicator() {\n    var _a, _b, _c, _d, _e, _f;\n\n    let co = (_b = (_a = Globals.storeInfo) === null || _a === void 0 ? void 0 : _a.loading) === null || _b === void 0 ? void 0 : _b.color;\n    let bco = (_d = (_c = Globals.storeInfo) === null || _c === void 0 ? void 0 : _c.loading) === null || _d === void 0 ? void 0 : _d.bg_color;\n    let name = (_f = (_e = Globals.storeInfo) === null || _e === void 0 ? void 0 : _e.loading) === null || _f === void 0 ? void 0 : _f.name;\n    let color = \"rgba(\" + co[0] + \",\" + co[1] + \",\" + co[2] + \",\" + co[3] + \")\";\n    let bg_color = \"rgba(\" + bco[0] + \",\" + bco[1] + \",\" + bco[2] + \",\" + bco[3] + \")\";\n    let indicator = {\n      \"name\": name,\n      \"color\": color,\n      \"bg_color\": bg_color\n    };\n    return indicator;\n  }\n\n  takeSnap() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this.frontImg == undefined && _this.backImg == undefined) {\n        return;\n      }\n\n      _this.spinner.show(\"designSpinner\");\n\n      setTimeout(() => {\n        _this.selectedSide = 0;\n\n        if (_this.frontImg == undefined) {\n          _this.selectedSide = 1;\n        }\n\n        _this.cdr.detectChanges();\n\n        let element = document.querySelector(\"#capture\");\n        html2canvas.default(element).then( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (canvas) {\n            _this.linkImg = canvas.toDataURL();\n            var amt = _this.selectedTemplate.minPrice / 100;\n\n            if (_this.backImg && _this.frontImg) {\n              amt += _this.selectedTemplate.extraCost / 100;\n            }\n\n            _this.designForm.controls.price.setValue(amt);\n\n            _this.spinner.hide(\"designSpinner\");\n\n            _this.step = 1;\n          });\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      }, 500);\n    })();\n  }\n\n  selectedTheme() {\n    var _a, _b, _c, _d, _e, _f;\n\n    let co = (_b = (_a = Globals.storeInfo) === null || _a === void 0 ? void 0 : _a.colorStyle) === null || _b === void 0 ? void 0 : _b.btn_color;\n    let bco = (_d = (_c = Globals.storeInfo) === null || _c === void 0 ? void 0 : _c.colorStyle) === null || _d === void 0 ? void 0 : _d.bg_color;\n    let name = (_f = (_e = Globals.storeInfo) === null || _e === void 0 ? void 0 : _e.colorStyle) === null || _f === void 0 ? void 0 : _f.name;\n    let color = \"rgba(\" + co[0] + \",\" + co[1] + \",\" + co[2] + \",\" + co[3] + \")\";\n    let bg_color = \"rgba(\" + bco[0] + \",\" + bco[1] + \",\" + bco[2] + \",\" + bco[3] + \")\";\n    var theme = {\n      \"name\": name,\n      \"color\": color,\n      \"bg_color\": bg_color\n    };\n    return theme;\n  }\n\n  shouldShowCanvas() {\n    if (this.selectedSide == 0) {\n      if (this.frontImg == undefined) {\n        return true;\n      }\n\n      return false;\n    }\n\n    if (this.backImg == undefined) {\n      return true;\n    }\n\n    return false;\n  }\n\n  minimumPrice() {\n    var _a, _b;\n\n    return ((_b = (_a = this.selectedTemplate) === null || _a === void 0 ? void 0 : _a.minPrice) !== null && _b !== void 0 ? _b : 0) / 100;\n  }\n\n  selectedImage() {\n    if (this.selectedSide == 0) {\n      return this.frontImg;\n    }\n\n    return this.backImg;\n  }\n\n  moveLeft() {\n    var _a, _b;\n\n    if (((_a = this.ds) === null || _a === void 0 ? void 0 : _a.currIndex) != 0) {\n      (_b = this.ds) === null || _b === void 0 ? void 0 : _b.moveLeft();\n    }\n  }\n\n  moveRight() {\n    var _a, _b, _c, _d;\n\n    if (((_a = this.ds) === null || _a === void 0 ? void 0 : _a.currIndex) != ((_c = (_b = this.selectedTemplate) === null || _b === void 0 ? void 0 : _b.colors.length) !== null && _c !== void 0 ? _c : 0) - 1) {\n      (_d = this.ds) === null || _d === void 0 ? void 0 : _d.moveRight();\n    }\n  }\n\n  didMove() {\n    var _a, _b, _c;\n\n    this.selectedColor = (_a = this.selectedTemplate) === null || _a === void 0 ? void 0 : _a.colors[(_c = (_b = this.ds) === null || _b === void 0 ? void 0 : _b.currIndex) !== null && _c !== void 0 ? _c : 0];\n  }\n\n  getTypeImages(template) {\n    var len = template.colors.filter(obj => {\n      return obj.code == \"black\";\n    });\n    var img;\n\n    if (len.length == 0) {\n      img = template.colors.filter(obj => {\n        return obj.code == \"white\";\n      })[0].img;\n    } else {\n      img = len[0].img;\n    }\n\n    return this.sanitizer.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + img);\n  }\n\n  sideName() {\n    var _a;\n\n    var side = this.selectedSide;\n\n    if (side == undefined) {\n      side = 0;\n    }\n\n    return (\"Click To Add \" + ((_a = this.selectedTemplate) === null || _a === void 0 ? void 0 : _a.supportedSides[side].name) + \" design\").toUpperCase();\n  }\n\n  cancel() {\n    this.activeModal.dismiss();\n  }\n\n  fileChangeEvent(event, type) {\n    var _a, _b, _c;\n\n    if (type === void 0) {\n      type = (_a = this.selectedSide) !== null && _a !== void 0 ? _a : 0;\n    }\n\n    this.openCrop = true;\n    const modalRef = this.modalService.open(CropperComponent, {\n      size: \"md\"\n    });\n    modalRef.componentInstance.imageChangedEvent = event;\n    var width = 1125;\n    var height = 1742;\n\n    if ((_b = this.selectedTemplate) === null || _b === void 0 ? void 0 : _b.supportedSides[type].useReverseAspect) {\n      width = 1742;\n      height = 1125;\n    }\n\n    modalRef.componentInstance.ratio = (_c = this.selectedTemplate) === null || _c === void 0 ? void 0 : _c.supportedSides[type].reversedAspectRatio();\n    modalRef.componentInstance.width = width;\n    modalRef.componentInstance.height = height;\n    modalRef.dismissed.subscribe(img => {\n      this.openCrop = false;\n\n      if (img != '0') {\n        event.srcElement.value = \"\";\n        event.target.value = \"\";\n\n        if (type == 0) {\n          this.frontImg = img;\n        } else {\n          this.backImg = img;\n        }\n      }\n    });\n  }\n\n  getColorSide(side, color) {\n    if (side == undefined) {\n      side = this.selectedSide;\n    }\n\n    if (color == undefined) {\n      color = this.selectedColor;\n    }\n\n    var img = color.img;\n\n    if (side == 1) {\n      img = color.imgBack;\n    }\n\n    return this.sanitizer.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + img);\n  }\n\n  getProductImages(type) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n\n    if (type == \"prev\") {\n      if (((_a = this.ds) === null || _a === void 0 ? void 0 : _a.currIndex) == 0) {\n        return '';\n      }\n\n      return this.sanitizer.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + ((_b = this.selectedTemplate) === null || _b === void 0 ? void 0 : _b.colors[((_d = (_c = this.ds) === null || _c === void 0 ? void 0 : _c.currIndex) !== null && _d !== void 0 ? _d : 1) - 1].img));\n    }\n\n    if (((_e = this.ds) === null || _e === void 0 ? void 0 : _e.currIndex) == ((_g = (_f = this.selectedTemplate) === null || _f === void 0 ? void 0 : _f.colors.length) !== null && _g !== void 0 ? _g : 1) - 1) {\n      return '';\n    }\n\n    return this.sanitizer.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + ((_h = this.selectedTemplate) === null || _h === void 0 ? void 0 : _h.colors[((_k = (_j = this.ds) === null || _j === void 0 ? void 0 : _j.currIndex) !== null && _k !== void 0 ? _k : 1) + 1].img));\n  }\n\n  getProductColor(type) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n\n    if (type == \"prev\") {\n      if (((_a = this.ds) === null || _a === void 0 ? void 0 : _a.currIndex) == 0) {\n        return '';\n      }\n\n      return this.getColor((_b = this.selectedTemplate) === null || _b === void 0 ? void 0 : _b.colors[((_d = (_c = this.ds) === null || _c === void 0 ? void 0 : _c.currIndex) !== null && _d !== void 0 ? _d : 1) - 1]);\n    }\n\n    if (((_e = this.ds) === null || _e === void 0 ? void 0 : _e.currIndex) == ((_g = (_f = this.selectedTemplate) === null || _f === void 0 ? void 0 : _f.colors.length) !== null && _g !== void 0 ? _g : 1) - 1) {\n      return '';\n    }\n\n    return this.getColor((_h = this.selectedTemplate) === null || _h === void 0 ? void 0 : _h.colors[((_k = (_j = this.ds) === null || _j === void 0 ? void 0 : _j.currIndex) !== null && _k !== void 0 ? _k : 1) + 1]);\n  }\n\n  nextStep() {\n    this.takeSnap();\n  }\n\n  moveColors(index) {\n    var _a;\n\n    (_a = this.ds) === null || _a === void 0 ? void 0 : _a.moveTo(index);\n  }\n\n  moveTo(index) {\n    var _a;\n\n    (_a = this.dsp) === null || _a === void 0 ? void 0 : _a.moveTo(index);\n  }\n\n  selectSide(side) {\n    this.selectedSide = side;\n  }\n\n  selectTemplate(template) {\n    var _a, _b;\n\n    this.selectedTemplate = template;\n    this.selectedColor = template.colors[0];\n    this.selectedSide = 0;\n    let index = (_b = (_a = this.templates) === null || _a === void 0 ? void 0 : _a.indexOf(template)) !== null && _b !== void 0 ? _b : 0;\n    this.moveTo(index);\n    this.moveColors(0);\n  }\n\n  getColor(color) {\n    let r = color.rgb[0] * 255;\n    let g = color.rgb[1] * 255;\n    let b = color.rgb[2] * 255;\n    return \"rgb(\" + r + \",\" + g + \",\" + b + \")\";\n  }\n\n  templateNum() {\n    var _a;\n\n    if (this.selectedTemplate) {\n      return (_a = this.templates) === null || _a === void 0 ? void 0 : _a.indexOf(this.selectedTemplate);\n    }\n\n    return 0;\n  }\n\n  ngOnInit() {\n    this.loadTemplate();\n  }\n\n  calculateHeight() {\n    var _a;\n\n    return this.calculateWidth() * this.selectedTemplate.supportedSides[(_a = this.selectedSide) !== null && _a !== void 0 ? _a : 0].regularAspectRatio();\n  }\n\n  calculateWidth() {\n    var _a, _b;\n\n    return this.myInnerHeight() * ((_b = this.selectedTemplate.supportedSides[(_a = this.selectedSide) !== null && _a !== void 0 ? _a : 0].widthMultiplier) !== null && _b !== void 0 ? _b : 0);\n  }\n\n  calculateCenterY() {\n    var _a;\n\n    return this.myInnerHeight() / 2 + this.selectedTemplate.supportedSides[(_a = this.selectedSide) !== null && _a !== void 0 ? _a : 0].centerYConst * (this.myInnerHeight() / 375) - this.calculateHeight() / 2;\n  }\n\n  calculateColor(color) {\n    if (color.code == \"white\") {\n      return {\n        text_color: \"secondary\",\n        border_color: \"#808080\"\n      };\n    }\n\n    return {\n      text_color: \"light\",\n      border_color: \"#ffffff\"\n    };\n  }\n\n  loadTemplate() {\n    this.selectedTemplate = this.templates[0];\n    this.selectedColor = this.selectedTemplate.colors[0];\n    this.cdr.detectChanges(); // var unsafeImageUrl = this.sanitizer.\n    // this.base64Data = this.sanitizer.bypassSecurityTrustUrl(unsafeImageUrl);\n  }\n\n};\n\n__decorate([ViewChild('carousel', {\n  read: DragScrollComponent\n})], DesignComponent.prototype, \"ds\", void 0);\n\n__decorate([ViewChild('productTemplates', {\n  read: DragScrollComponent\n})], DesignComponent.prototype, \"dsp\", void 0);\n\nDesignComponent = __decorate([Component({\n  selector: 'app-design',\n  templateUrl: './design.component.html',\n  styleUrls: ['./design.component.css']\n})], DesignComponent);\nexport { DesignComponent };","map":{"version":3,"sources":["/Users/artakoroushnia/Desktop/thred-web/src/app/design/design.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild, ChangeDetectorRef } from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { Template } from '../models/template.model';\nimport { DragScrollComponent } from 'ngx-drag-scroll';\nimport { Color } from '../models/color.model';\nimport { TemplateSide } from '../models/template-side.model';\nimport { CropperComponent } from '../cropper/cropper.component';\nimport { NgbModal, NgbActiveModal } from '@ng-bootstrap/ng-bootstrap';\nimport { Globals } from '../globals';\nimport { Validators, FormBuilder } from '@angular/forms';\nimport { Dict } from '../services/load.service';\nimport * as html2canvas from 'html2canvas'\nimport { NgxSpinnerService } from 'ngx-spinner';\nimport { CurrencyMaskInputMode, NgxCurrencyModule } from \"ngx-currency\";\n\n\n\n@Component({\n  selector: 'app-design',\n  templateUrl: './design.component.html',\n  styleUrls: ['./design.component.css']\n})\nexport class DesignComponent implements OnInit {\n\n  myInnerHeight(){\n    let height = window.innerHeight\n    let width = window.innerWidth\n\n    if (width < height){\n      return width * 0.98\n    }\n    else{\n      if (this.step == 0){\n        return height * 0.70\n      }\n      return height * 0.70\n    }\n  }\n\n  customCurrencyMaskConfig = {\n    align: \"left\",\n    allowNegative: false,\n    allowZero: true,\n    decimal: \".\",\n    precision: 2,\n    prefix: \"$ \",\n    suffix: \"\",\n    thousands: \",\",\n    min: 0,\n    inputMode: CurrencyMaskInputMode.NATURAL\n  };\n\n  \n\n  templates?: Array<Template>\n  selectedTemplate?: Template\n\n  frontImg?: any\n  linkImg?: any\n  backImg?: any\n\n\n  selectedColor?: Color\n  selectedSide?: number = 0\n  step?: number = 0\n\n  openCrop = false\n\n  storeInfo(){return Globals.storeInfo}\n\n  availableCurrencies(){return Globals.availableCurrencies}\n\n  selectedCurrency(){return Globals.selectedCurrency}\n\n\n  availableTemplates(){return Globals.availableTemplates}\n\n  products(){return Globals.products}\n\n  selectedIndicator(){\n\n    \n\n    let co = Globals.storeInfo?.loading?.color\n    let bco = Globals.storeInfo?.loading?.bg_color\n    let name = Globals.storeInfo?.loading?.name\n    \n    let color = \"rgba(\" + co[0] + \",\" + co[1] + \",\" + co[2] + \",\" + co[3] + \")\"\n\n    let bg_color = \"rgba(\" + bco[0] + \",\" + bco[1] + \",\" + bco[2] + \",\" + bco[3] + \")\"\n\n    let indicator: Dict<string> = {\n      \"name\": name,\n      \"color\": color,\n      \"bg_color\": bg_color\n    }\n    return indicator\n  }\n\n\n\n  async takeSnap(){\n\n    if (this.frontImg == undefined && this.backImg == undefined){\n      return\n    }\n    this.spinner.show(\"designSpinner\")\n\n    \n\n    setTimeout(() => {\n      this.selectedSide = 0\n      if (this.frontImg == undefined){\n        this.selectedSide = 1\n      }\n      this.cdr.detectChanges()\n      let element = document.querySelector(\"#capture\") as HTMLElement\n  \n      html2canvas.default(element).then(async (canvas) => {\n        this.linkImg = canvas.toDataURL()\n        var amt = this.selectedTemplate!.minPrice / 100\n        if (this.backImg && this.frontImg){\n          amt += this.selectedTemplate!.extraCost / 100\n        }\n        this.designForm.controls.price.setValue(amt)\n        this.spinner.hide(\"designSpinner\")\n        this.step = 1\n      })\n    }, 500);\n\n\n  }\n  \n\n  selectedTheme(){\n    \n    let co = Globals.storeInfo?.colorStyle?.btn_color\n    let bco = Globals.storeInfo?.colorStyle?.bg_color\n    let name = Globals.storeInfo?.colorStyle?.name\n\n    let color = \"rgba(\" + co[0] + \",\" + co[1] + \",\" + co[2] + \",\" + co[3] + \")\"\n\n    let bg_color = \"rgba(\" + bco[0] + \",\" + bco[1] + \",\" + bco[2] + \",\" + bco[3] + \")\"\n\n    var theme: Dict<string> = {\n      \"name\": name,\n      \"color\": color,\n      \"bg_color\": bg_color\n    }\n    return theme\n  }\n\n  designForm = this.fb.group({\n    company: null,\n    firstName: [null, Validators.required],\n    lastName: [null, Validators.required],\n    price: [null, [Validators.required, Validators.pattern(\"^([0-9]{0,2}((.)[0-9]{0,2}))$\")]],\n  });\n\n\n  sanitizer?: DomSanitizer\n\n  @ViewChild('carousel', {read: DragScrollComponent}) ds?: DragScrollComponent;\n  @ViewChild('productTemplates', {read: DragScrollComponent}) dsp?: DragScrollComponent;\n\n  shouldShowCanvas(){\n    if (this.selectedSide == 0){\n      if (this.frontImg == undefined){\n        return true\n      }\n      return false\n    }\n    if (this.backImg == undefined){\n      return true\n    }\n    return false\n  }\n\n  minimumPrice(){\n    return (this.selectedTemplate?.minPrice ?? 0) / 100\n  }\n\n  selectedImage(){\n    if (this.selectedSide == 0){\n      return this.frontImg\n    }\n    return this.backImg\n  }\n\n  moveLeft() {\n    if (this.ds?.currIndex != 0){\n      this.ds?.moveLeft();\n    }\n  }\n\n  moveRight() {\n    if (this.ds?.currIndex != (this.selectedTemplate?.colors.length ?? 0) - 1){\n      this.ds?.moveRight();\n    }\n  }\n\n  didMove() {\n    this.selectedColor = this.selectedTemplate?.colors[this.ds?.currIndex ?? 0]\n  }\n\n\n  getTypeImages(template: Template) {\n\n    var len = template.colors.filter(obj => {\n      return obj.code == \"black\"\n    })\n    var img: any\n    if (len.length == 0){\n      img = template.colors.filter(obj => {\n        return obj.code == \"white\"\n      })[0].img\n    }\n    else{\n      img = len[0].img\n    }\n    return this.sanitizer!.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + img)\n  }\n\n  sideName(){\n    var side = this.selectedSide\n    if (side == undefined){\n      side = 0\n    }\n    return (\"Click To Add \" + this.selectedTemplate?.supportedSides[side].name + \" design\").toUpperCase()\n  }\n\n  cancel(){\n    this.activeModal.dismiss()\n  }\n\n  fileChangeEvent(event: any, type = this.selectedSide ?? 0): void {\n\n\n    this.openCrop = true\n\n    const modalRef = this.modalService.open(CropperComponent, {size : \"md\"});\n    \n    modalRef.componentInstance.imageChangedEvent = event\n\n\n\n    var width = 1125\n    var height = 1742\n\n    if (this.selectedTemplate?.supportedSides[type].useReverseAspect){\n      width = 1742\n      height = 1125\n    }\n\n    modalRef.componentInstance.ratio = this.selectedTemplate?.supportedSides[type].reversedAspectRatio()\n\n    modalRef.componentInstance.width = width\n    modalRef.componentInstance.height = height\n\n    modalRef.dismissed.subscribe((img: string) => {\n      this.openCrop = false\n      if (img != '0'){\n        event.srcElement.value = \"\"\n        event.target.value = \"\"\n        if (type == 0){\n          this.frontImg = img\n        }\n        else{\n          this.backImg = img\n        }\n      }\n    })\n  }\n\n  getColorSide(side?: number, color?: Color) {\n\n    if (side == undefined){\n      side = this.selectedSide\n    }\n    if (color == undefined){\n      color = this.selectedColor\n    }\n\n    var img = color!.img\n\n    if (side == 1){\n      img = color!.imgBack\n    }\n \n    return this.sanitizer!.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + img)\n  }\n\n  getProductImages(type: string) {\n\n    if (type == \"prev\"){\n      if (this.ds?.currIndex == 0){\n        return ''\n      }\n      return this.sanitizer!.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + this.selectedTemplate?.colors[(this.ds?.currIndex ?? 1) - 1].img)\n    }\n    if (this.ds?.currIndex == (this.selectedTemplate?.colors.length ?? 1) - 1){\n      return ''\n    }\n    return this.sanitizer!.bypassSecurityTrustResourceUrl(\"data:image/jpeg;base64,\" + this.selectedTemplate?.colors[(this.ds?.currIndex ?? 1) + 1].img)\n  }\n\n  getProductColor(type: string){\n    if (type == \"prev\"){\n      if (this.ds?.currIndex == 0){\n        return ''\n      }\n      return this.getColor(this.selectedTemplate?.colors[(this.ds?.currIndex ?? 1) - 1]!)\n    }\n\n    if (this.ds?.currIndex == (this.selectedTemplate?.colors.length ?? 1) - 1){\n      return ''\n    }\n    return this.getColor(this.selectedTemplate?.colors[(this.ds?.currIndex ?? 1) + 1]!)\n  }\n\n  nextStep(){\n    this.takeSnap()\n    \n  }\n\n  moveColors(index: number) {\n    this.ds?.moveTo(index);\n  }\n\n  moveTo(index: number) {\n    this.dsp?.moveTo(index);\n  }\n\n  selectSide(side: number){\n    this.selectedSide = side\n  }\n\n  selectTemplate(template: Template){\n\n    this.selectedTemplate = template\n    this.selectedColor = template.colors[0]\n    this.selectedSide = 0\n\n    let index = this.templates?.indexOf(template) ?? 0\n    this.moveTo(index)\n    this.moveColors(0)\n\n  }\n\n  getColor(color: Color){\n    let r = color.rgb[0] * 255\n    let g = color.rgb[1] * 255\n    let b = color.rgb[2] * 255\n\n\n    return \"rgb(\" + r + \",\" + g + \",\" + b + \")\" \n  }\n\n\n  templateNum(){\n    if (this.selectedTemplate){\n      return this.templates?.indexOf(this.selectedTemplate)\n    }\n    return 0\n  }\n\n\n\n  constructor(\n    sanitizer: DomSanitizer,\n    private cdr: ChangeDetectorRef,\n    private modalService: NgbModal,\n    private activeModal: NgbActiveModal,\n    private fb: FormBuilder,\n    private spinner: NgxSpinnerService,\n  ) { \n    this.sanitizer = sanitizer\n  }\n\n  ngOnInit(): void {\n    \n\n    this.loadTemplate()\n  }\n\n  calculateHeight(){\n    return this.calculateWidth() * this.selectedTemplate!.supportedSides[this.selectedSide ?? 0].regularAspectRatio()\n  }\n\n  calculateWidth(){\n    return this.myInnerHeight() * (this.selectedTemplate!.supportedSides[this.selectedSide ?? 0].widthMultiplier ?? 0)\n  }\n\n  calculateCenterY(){\n    return ((this.myInnerHeight() / 2) + (this.selectedTemplate!.supportedSides[this.selectedSide ?? 0].centerYConst * (this.myInnerHeight() / 375))) - (this.calculateHeight()) / 2\n  }\n\n  calculateColor(color: Color){\n    if (color.code == \"white\"){\n      return {\n        text_color: \"secondary\",\n        border_color: \"#808080\"\n      }\n    }\n    return {\n      text_color: \"light\",\n      border_color: \"#ffffff\"\n    }\n  }\n\n  loadTemplate() {\n    \n    this.selectedTemplate = this.templates![0]\n    this.selectedColor = this.selectedTemplate!.colors[0]\n    this.cdr.detectChanges()\n    // var unsafeImageUrl = this.sanitizer.\n\n    // this.base64Data = this.sanitizer.bypassSecurityTrustUrl(unsafeImageUrl);\n  }\n\n}\n\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}