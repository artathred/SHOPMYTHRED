{"ast":null,"code":"import _asyncToGenerator from \"/Users/artakoroushnia/Desktop/thred-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { PLATFORM_ID } from '@angular/core';\nimport firebase from 'firebase/app';\nimport { Product } from '../models/product.model';\nimport { Template } from '../models/template.model';\nimport { TemplateSide } from '../models/template-side.model';\nimport { Color } from '../models/color.model';\nimport { Country } from '../models/shipping-country.model';\nimport { Globals } from '../globals';\nimport { isPlatformBrowser } from '@angular/common';\nimport { Blog } from '../models/blog.model';\nimport { first } from 'rxjs/operators';\nimport { ProductInCart } from '../models/product-in-cart.model';\nimport { ShippingInfo } from '../models/shipping-address.model';\nimport { BillingInfo } from '../models/billing-address.model';\nimport { v4 as uuid } from 'uuid';\nimport { Order } from '../models/order.model';\nimport { Store } from '../models/store.model';\nimport { StoreTheme } from '../models/theme.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/firestore\";\nimport * as i2 from \"@angular/fire/auth\";\nimport * as i3 from \"@angular/fire/functions\";\nimport * as i4 from \"@angular/fire/storage\";\nimport * as i5 from \"ngx-stripe\";\nimport * as i6 from \"@angular/material/snack-bar\";\nexport class LoadService {\n  constructor(platformID, db, auth, functions, storage, stripeService, snackBar) {\n    this.platformID = platformID;\n    this.db = db;\n    this.auth = auth;\n    this.functions = functions;\n    this.storage = storage;\n    this.stripeService = stripeService;\n    this.snackBar = snackBar;\n    this.isShop = false;\n    this.hideCart = false;\n    this.shouldShowCurrency = false;\n  }\n\n  logView() {\n    if (!Globals.didLog && Globals.storeInfo.uid) {\n      Globals.didLog = true;\n      this.functions.httpsCallable(\"updateView\")({\n        storeUID: Globals.storeInfo.uid\n      }).pipe(first()).subscribe( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (resp) {\n          if (resp) {} else {}\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }(), err => {\n        console.error({\n          err\n        });\n      });\n    }\n  }\n\n  getCountries() {\n    let sub = this.db.collection(\"Print_Info\").doc(\"Shipping_Info\").valueChanges().subscribe(docData => {\n      const data = docData;\n      const usShipping = Math.round(data.shipping_rate_us * 100);\n      const caShipping = Math.round(data.shipping_rate_canada * 100);\n      const intlShipping = Math.round(data.shipping_rate_intl * 100);\n      const currencies = data.supportedCurrencies;\n      Globals.availableCurrencies = [];\n      currencies.forEach(currency => {\n        var _a;\n\n        const name = currency.country;\n        const flag = currency.flag;\n        const currency_name = currency.name;\n        const rate = currency.rate;\n        const is_main_currency = currency.is_main_currency;\n        const symbol = currency.symbol;\n        const name_full = currency.country_full;\n        const country = new Country(name, flag, name_full, currency_name, symbol, rate, is_main_currency, 0);\n\n        if (name == \"CA\") {\n          country.shipping_rate_usd = caShipping;\n        } else if (name == \"US\") {\n          country.shipping_rate_usd = usShipping;\n          Globals.selectedCurrency = country;\n        } else {\n          country.shipping_rate_usd = intlShipping;\n        }\n\n        if (!((_a = Globals.availableCurrencies) === null || _a === void 0 ? void 0 : _a.includes(country))) {\n          Globals.availableCurrencies.push(country);\n        }\n      });\n      Globals.availableCurrencies.sort(function (a, b) {\n        if (a.name < b.name) {\n          return -1;\n        }\n\n        if (a.name > b.name) {\n          return 1;\n        }\n\n        return 0;\n      });\n\n      if (isPlatformBrowser(this.platformID)) {\n        let cacheCurrency = localStorage.getItem(\"LOCAL_CURRENCY\");\n\n        if (cacheCurrency && cacheCurrency != null && cacheCurrency != \"\") {\n          Globals.selectedCurrency = Globals.availableCurrencies.find(currency => currency.currency_name == cacheCurrency);\n        } else {\n          Globals.selectedCurrency = Globals.availableCurrencies.find(currency => currency.currency_name == \"USD\");\n        }\n      }\n\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getUser(username, uid) {\n    var query = this.db.collection(\"Users\", ref => ref.where(\"Username\", '==', username));\n\n    if (uid) {\n      query = this.db.collection(\"Users\", ref => ref.where(firebase.firestore.FieldPath.documentId(), '==', uid));\n    }\n\n    let sub = query.valueChanges({\n      idField: 'UID'\n    }).subscribe(doc => {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n      let docData = doc[0];\n\n      if (docData) {\n        let uid = docData.UID; //UID OF COMMENT IMAGE\n\n        let dpUID = docData[\"ProfilePicID\"]; //UID OF COMMENT IMAGE\n\n        let username = docData[\"Username\"]; //COMMENTER'S USERNAME\n\n        let fullName = docData[\"Full_Name\"];\n        let bio = docData[\"Bio\"];\n        let notifID = docData[\"Notification ID\"];\n        let userFollowing = (_a = docData[\"Following_List\"]) !== null && _a !== void 0 ? _a : [];\n        let usersBlocking = (_b = docData[\"Users_Blocking\"]) !== null && _b !== void 0 ? _b : [];\n        let followerCount = (_c = docData[\"Followers_Count\"]) !== null && _c !== void 0 ? _c : 0;\n        let followingCount = (_d = docData[\"Following_Count\"]) !== null && _d !== void 0 ? _d : 0;\n        let postCount = (_e = docData[\"Posts_Count\"]) !== null && _e !== void 0 ? _e : 0;\n        let verified = (_f = docData[\"Verified\"]) !== null && _f !== void 0 ? _f : false;\n        let postNotifs = (_g = docData[\"Post_Notifications\"]) !== null && _g !== void 0 ? _g : [];\n        let isPublic = (_h = docData[\"Public\"]) !== null && _h !== void 0 ? _h : true;\n        let slogan = docData[\"Slogan\"];\n        let loading = docData[\"indicator\"];\n        let style = docData[\"store_style\"];\n        let font = docData[\"font\"];\n        let socials = docData[\"Socials\"];\n        Globals.storeInfo = new Store(uid, dpUID, username, fullName, bio, notifID, userFollowing, [], followerCount, postCount, followingCount, usersBlocking, this.getProfileURL(uid, dpUID), verified, isPublic, postNotifs, slogan, undefined, this.getDefaultURL(), this.getDefaultURL(), this.getDefaultURL(), undefined, font, socials);\n        let list = (_j = docData[\"image_list\"]) !== null && _j !== void 0 ? _j : [];\n        list.forEach(type => {\n          if (type == 'theme') {\n            Globals.storeInfo.themeLink = new URL(this.getThemeURL(uid));\n          } else if (type == 'home') {\n            Globals.storeInfo.homeLink = new URL(this.getHomeURL(uid));\n          } else if (type == 'action') {\n            Globals.storeInfo.actionLink = new URL(this.getActionURL(uid));\n          }\n        });\n\n        if (loading === null || loading === void 0 ? void 0 : loading.name) {\n          Globals.storeInfo.loading.name = loading === null || loading === void 0 ? void 0 : loading.name;\n        }\n\n        if (loading === null || loading === void 0 ? void 0 : loading.color) {\n          Globals.storeInfo.loading.color = this.parseColor(loading.color);\n        }\n\n        if (loading === null || loading === void 0 ? void 0 : loading.bg_color) {\n          Globals.storeInfo.loading.bg_color = this.parseColor(loading.bg_color);\n        }\n\n        if (style) {\n          Globals.storeInfo.colorStyle = new StoreTheme(style === null || style === void 0 ? void 0 : style.name, style === null || style === void 0 ? void 0 : style.back_code, style === null || style === void 0 ? void 0 : style.text_code, this.parseColor(style === null || style === void 0 ? void 0 : style.bg_color), this.parseColor(style === null || style === void 0 ? void 0 : style.btn_color));\n        }\n      } else {\n        Globals.storeInfo.uid = \"\";\n      }\n\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  parseColor(color) {\n    var finalArr = new Array();\n    color === null || color === void 0 ? void 0 : color.split(\",\").forEach(color => {\n      finalArr.push(Number(color.trim()));\n    });\n    return finalArr;\n  }\n\n  getCustomer() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      Globals.userInfo = new Store();\n      let uid = (_a = yield _this.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n\n      if (uid) {\n        let sub = _this.db.collection(\"Users\").doc(uid).valueChanges({\n          idField: 'UID'\n        }).subscribe(doc => {\n          var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n          let docData = doc;\n\n          if (docData) {\n            let uid = docData.UID; //UID OF COMMENT IMAGE\n\n            let dpUID = docData[\"ProfilePicID\"]; //UID OF COMMENT IMAGE\n\n            let username = docData[\"Username\"]; //COMMENTER'S USERNAME\n\n            let fullName = docData[\"Full_Name\"];\n            let bio = docData[\"Bio\"];\n            let notifID = docData[\"Notification ID\"];\n            let userFollowing = (_a = docData[\"Following_List\"]) !== null && _a !== void 0 ? _a : [];\n            let usersBlocking = (_b = docData[\"Users_Blocking\"]) !== null && _b !== void 0 ? _b : [];\n            let followerCount = (_c = docData[\"Followers_Count\"]) !== null && _c !== void 0 ? _c : 0;\n            let followingCount = (_d = docData[\"Following_Count\"]) !== null && _d !== void 0 ? _d : 0;\n            let postCount = (_e = docData[\"Posts_Count\"]) !== null && _e !== void 0 ? _e : 0;\n            let verified = (_f = docData[\"Verified\"]) !== null && _f !== void 0 ? _f : false;\n            let postNotifs = (_g = docData[\"Post_Notifications\"]) !== null && _g !== void 0 ? _g : [];\n            let isPublic = (_h = docData[\"Public\"]) !== null && _h !== void 0 ? _h : true;\n            let slogan = docData[\"Slogan\"];\n            let style = docData[\"store_style\"];\n            let font = docData[\"font\"];\n            let socials = docData[\"Socials\"];\n            let loading = docData[\"indicator\"];\n            Globals.userInfo = new Store(uid, dpUID, username, fullName, bio, notifID, userFollowing, [], followerCount, postCount, followingCount, usersBlocking, _this.getProfileURL(uid, dpUID), verified, isPublic, postNotifs, slogan, undefined, _this.getDefaultURL(), _this.getDefaultURL(), _this.getDefaultURL(), undefined, font, socials);\n            let list = (_j = docData[\"image_list\"]) !== null && _j !== void 0 ? _j : [];\n            list.forEach(type => {\n              if (type == 'theme') {\n                Globals.userInfo.themeLink = new URL(_this.getThemeURL(uid));\n              } else if (type == 'home') {\n                Globals.userInfo.homeLink = new URL(_this.getHomeURL(uid));\n              } else if (type == 'action') {\n                Globals.userInfo.actionLink = new URL(_this.getActionURL(uid));\n              }\n            });\n\n            if (loading === null || loading === void 0 ? void 0 : loading.name) {\n              Globals.userInfo.loading.name = loading === null || loading === void 0 ? void 0 : loading.name;\n            }\n\n            if (loading === null || loading === void 0 ? void 0 : loading.color) {\n              Globals.userInfo.loading.color = _this.parseColor(loading.color);\n            }\n\n            if (loading === null || loading === void 0 ? void 0 : loading.bg_color) {\n              Globals.userInfo.loading.bg_color = _this.parseColor(loading.bg_color);\n            }\n\n            if (style) {\n              Globals.userInfo.colorStyle = new StoreTheme(style === null || style === void 0 ? void 0 : style.name, style === null || style === void 0 ? void 0 : style.back_code, style === null || style === void 0 ? void 0 : style.text_code, _this.parseColor(style === null || style === void 0 ? void 0 : style.bg_color), _this.parseColor(style === null || style === void 0 ? void 0 : style.btn_color));\n            }\n\n            if (_this.myCallback) _this.myCallback();\n            if (isPlatformBrowser(_this.platformID)) sub.unsubscribe();\n          }\n        });\n      } else {\n        if (_this.myCallback) _this.myCallback();\n      }\n    })();\n  }\n\n  getThemes() {\n    Globals.themes = [];\n    var query = this.db.collection(\"Store_Themes\", ref => ref.orderBy(\"index\", \"asc\"));\n    let sub = query.valueChanges().subscribe(docDatas => {\n      docDatas.forEach(doc => {\n        var _a;\n\n        let docData = doc;\n\n        if (docData) {\n          let name = docData.name;\n          let btn_color = docData.btn_color;\n          let bg_color = docData.bg_color;\n          let back_code = docData.back_code;\n          let text_code = docData.text_code;\n          let theme = new StoreTheme(name, back_code, text_code, this.parseColor(bg_color), this.parseColor(btn_color));\n          (_a = Globals.themes) === null || _a === void 0 ? void 0 : _a.push(theme);\n        }\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getPosts(filterID) {\n    Globals.products = [];\n    const time = firebase.firestore.Timestamp.now();\n    var query = this.db.collection(\"Users/\" + Globals.storeInfo.uid + \"/Products\", ref => ref.where(\"Timestamp\", '<=', time).where(\"Has_Picture\", '==', true).where(\"Available\", '==', true).where(\"Public\", '==', true).orderBy(\"Timestamp\", \"desc\"));\n\n    if (filterID) {\n      query = this.db.collection(\"Users/\" + Globals.storeInfo.uid + \"/Products\", ref => ref.where(\"Timestamp\", '<=', time).where(\"Type\", '==', filterID).where(\"Available\", '==', true).where(\"Public\", '==', true).orderBy(\"Timestamp\", \"desc\"));\n    }\n\n    let sub = query.valueChanges().subscribe(docDatas => {\n      var _a;\n\n      docDatas.forEach(doc => {\n        var _a, _b, _c, _d, _e, _f;\n\n        let docData = doc;\n\n        if (docData) {\n          let uid = docData.UID;\n          let productID = docData.Product_ID;\n          let timestamp = docData.Timestamp.toDate();\n          let description = docData.Description;\n          let name = docData.Name;\n          let blurred = docData.Blurred;\n          let templateColor = docData.Template_Color;\n          let likes = docData.Likes;\n          let priceCents = docData.Price_Cents;\n          let comments = docData.Comments;\n          let isPublic = (_a = docData.Public) !== null && _a !== void 0 ? _a : true;\n          let productType = (_b = docData.Type) !== null && _b !== void 0 ? _b : \"ATC1000\";\n          let displaySide = (_c = docData.Side) !== null && _c !== void 0 ? _c : \"front\";\n          let sides = (_d = docData[\"Sides\"]) !== null && _d !== void 0 ? _d : [\"Front\"];\n          let product = new Product(uid, productID, description, productID, timestamp, \"\", blurred, priceCents, name, templateColor, likes, false, comments, true, isPublic, productType, displaySide, sides, this.getURL(uid, productID));\n\n          if (!((_e = Globals.products) === null || _e === void 0 ? void 0 : _e.includes(product))) {\n            (_f = Globals.products) === null || _f === void 0 ? void 0 : _f.push(product);\n          }\n        }\n      });\n\n      if (!filterID) {\n        Globals.availableTemplates = this.getTemplatesFiltered();\n      }\n\n      (_a = Globals.products) === null || _a === void 0 ? void 0 : _a.sort(function (a, b) {\n        if (a.timestamp > b.timestamp) {\n          return -1;\n        }\n\n        if (a.timestamp < b.timestamp) {\n          return 1;\n        }\n\n        return 0;\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getBlogs(filterID) {\n    Globals.blogs = [];\n    const time = firebase.firestore.Timestamp.now();\n    var query = this.db.collection(\"Users/\" + Globals.storeInfo.uid + \"/Blogs\", ref => ref.where(\"Timestamp\", '<=', time).where(\"isAvailable\", '==', true).orderBy(\"Timestamp\", \"desc\"));\n    let sub = query.valueChanges({\n      idField: \"Blog_ID\"\n    }).subscribe(docDatas => {\n      docDatas.forEach(doc => {\n        let docData = doc;\n\n        if (docData) {\n          let uid = docData.UID;\n          let title = docData.Title;\n          let timestamp = docData.Timestamp.toDate();\n          let isAvailable = docData.isAvailable;\n          let blogID = docData.Blog_ID;\n          let blogItems = docData.Blog_Items;\n          let coverURL = docData.Cover_URL;\n          let blog = new Blog(uid, timestamp, \"\", isAvailable, title, blogItems, blogID, coverURL);\n          Globals.blogs.push(blog);\n        }\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  hasEmptyProperties(obj, ignoreKeys) {\n    for (var key in obj) {\n      if (ignoreKeys.includes(key)) {\n        continue;\n      }\n\n      if (obj[key] == null || obj[key] == \"\" || obj[key] == undefined) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  linkAddress() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      let uid = (_a = yield _this2.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n      let shipping = Globals.shippingInfo;\n\n      if (uid && shipping && _this2.hasEmptyProperties(shipping, [\"unit\", \"company\", \"country_code\"])) {\n        return;\n      }\n\n      let email = shipping.email;\n\n      if ((_b = yield _this2.isLoggedIn()) === null || _b === void 0 ? void 0 : _b.isAnonymous) {\n        let fData = {\n          email: email\n        };\n\n        _this2.functions.httpsCallable('updateAuth')(fData).pipe(first()).subscribe( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (resp) {\n            if (resp) {\n              yield _this2.setAddress(uid);\n\n              _this2.auth.signInWithEmailAndPassword(email, resp).then(() => {\n                // Signed in..\n                if (_this2.myCallback) _this2.myCallback();\n              }).catch(error => {\n                var errorCode = error.code;\n                var errorMessage = error.message; // if (this.myCallback) \n                // this.myCallback()\n              });\n            } else {\n              //error\n              if (resp.errorInfo.code == \"auth/email-already-exists\") {\n                console.log(\"This email address is being used by another account.\"); //show popup ******\n              }\n            }\n          });\n\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }(), err => {\n          console.error({\n            err\n          });\n        });\n      } else {\n        yield _this2.setAddress(uid);\n        if (_this2.myCallback) _this2.myCallback();\n      }\n    })();\n  }\n\n  setAddress(uid) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      let shipping = Globals.shippingInfo;\n      let data = {\n        Administrative_Area: shipping === null || shipping === void 0 ? void 0 : shipping.admin_area,\n        City: shipping === null || shipping === void 0 ? void 0 : shipping.city,\n        Country: shipping === null || shipping === void 0 ? void 0 : shipping.country,\n        First_Name: shipping === null || shipping === void 0 ? void 0 : shipping.name.split(' ').slice(0, -1).join(' '),\n        Last_Name: shipping === null || shipping === void 0 ? void 0 : shipping.name.split(' ').slice(-1).join(' '),\n        Phone_Num: shipping === null || shipping === void 0 ? void 0 : shipping.phone_num,\n        Email: shipping === null || shipping === void 0 ? void 0 : shipping.email,\n        Postal_Code: shipping === null || shipping === void 0 ? void 0 : shipping.postal,\n        Street: shipping === null || shipping === void 0 ? void 0 : shipping.street,\n        Company: (_a = shipping === null || shipping === void 0 ? void 0 : shipping.company) !== null && _a !== void 0 ? _a : \"\",\n        Unit_Number: (_b = shipping === null || shipping === void 0 ? void 0 : shipping.unit) !== null && _b !== void 0 ? _b : \"\"\n      };\n\n      if (uid) {\n        yield _this3.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Delivery_Address\").set(data);\n      }\n    })();\n  }\n\n  createPayment(storeID, isCard = true) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      _this4.functions.httpsCallable('createWebIntent')({\n        merchant_uid: storeID,\n        isCard: isCard\n      }).pipe(first()).subscribe( /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator(function* (resp) {\n          if (_this4.orderCallback) _this4.orderCallback(resp.order_id, resp.client_secret);\n        });\n\n        return function (_x3) {\n          return _ref3.apply(this, arguments);\n        };\n      }(), err => {\n        console.error({\n          err\n        });\n      });\n    })();\n  }\n\n  linkCard(details) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c;\n\n      var billing = Globals.billingInfo;\n      let uid = (_a = yield _this5.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n\n      if (details.card) {\n        if (billing && _this5.hasEmptyProperties(billing, [\"unit\", \"company\", \"brand\", \"number\"])) {\n          console.log(\"k\");\n          return;\n        }\n\n        console.log(\"s\");\n\n        if (_this5.isUndefined(billing === null || billing === void 0 ? void 0 : billing.unit)) {\n          billing.unit = undefined;\n        }\n\n        let name = billing === null || billing === void 0 ? void 0 : billing.name;\n        let card = details.card;\n        var b = {\n          line1: billing === null || billing === void 0 ? void 0 : billing.street,\n          city: billing === null || billing === void 0 ? void 0 : billing.city,\n          state: billing === null || billing === void 0 ? void 0 : billing.admin_area,\n          postal_code: billing === null || billing === void 0 ? void 0 : billing.postal,\n          country: billing === null || billing === void 0 ? void 0 : billing.country_code\n        };\n\n        if (billing === null || billing === void 0 ? void 0 : billing.unit) {\n          b.line2 = billing.unit;\n        }\n\n        _this5.stripeService.createPaymentMethod({\n          type: 'card',\n          card: card.element,\n          billing_details: {\n            address: b,\n            name: name\n          }\n        }).subscribe(result => {\n          var _a;\n\n          if (result.paymentMethod) {\n            // Use the token\n            var fData = {\n              token: result.paymentMethod.id,\n              name: billing === null || billing === void 0 ? void 0 : billing.name,\n              line1: billing === null || billing === void 0 ? void 0 : billing.street,\n              line2: (_a = billing === null || billing === void 0 ? void 0 : billing.unit) !== null && _a !== void 0 ? _a : null,\n              city: billing === null || billing === void 0 ? void 0 : billing.city,\n              state: billing === null || billing === void 0 ? void 0 : billing.admin_area,\n              zip: billing === null || billing === void 0 ? void 0 : billing.postal,\n              country: billing === null || billing === void 0 ? void 0 : billing.country_code\n            };\n\n            if (true) {\n              _this5.functions.httpsCallable('verifyCard')(fData).pipe(first()).subscribe( /*#__PURE__*/function () {\n                var _ref4 = _asyncToGenerator(function* (resp) {\n                  var _a, _b;\n\n                  let data = {\n                    Administrative_Area: billing === null || billing === void 0 ? void 0 : billing.admin_area,\n                    City: billing === null || billing === void 0 ? void 0 : billing.city,\n                    Country: billing === null || billing === void 0 ? void 0 : billing.country,\n                    First_Name: billing === null || billing === void 0 ? void 0 : billing.name.split(' ').slice(0, -1).join(' '),\n                    Last_Name: billing === null || billing === void 0 ? void 0 : billing.name.split(' ').slice(-1).join(' '),\n                    Postal_Code: billing === null || billing === void 0 ? void 0 : billing.postal,\n                    Street: billing === null || billing === void 0 ? void 0 : billing.street,\n                    Company: (_a = billing === null || billing === void 0 ? void 0 : billing.company) !== null && _a !== void 0 ? _a : \"\",\n                    Unit_Number: (_b = billing === null || billing === void 0 ? void 0 : billing.unit) !== null && _b !== void 0 ? _b : \"\"\n                  };\n\n                  if (uid) {\n                    yield _this5.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Billing_Address\").set(data);\n                  }\n\n                  if (_this5.myCallback) _this5.myCallback();\n                });\n\n                return function (_x4) {\n                  return _ref4.apply(this, arguments);\n                };\n              }(), err => {\n                console.error({\n                  err\n                });\n              });\n            } else {// if (this.myCallback) \n              //   this.myCallback()\n            }\n          } else if (result.error) {\n            // Error creating the token\n            console.log(result.error.message);\n          }\n        });\n      } else {\n        let data = {\n          Administrative_Area: billing === null || billing === void 0 ? void 0 : billing.admin_area,\n          City: billing === null || billing === void 0 ? void 0 : billing.city,\n          Country: billing === null || billing === void 0 ? void 0 : billing.country,\n          First_Name: billing === null || billing === void 0 ? void 0 : billing.name.split(' ').slice(0, -1).join(' '),\n          Last_Name: billing === null || billing === void 0 ? void 0 : billing.name.split(' ').slice(-1).join(' '),\n          Postal_Code: billing === null || billing === void 0 ? void 0 : billing.postal,\n          Street: billing === null || billing === void 0 ? void 0 : billing.street,\n          Company: (_b = billing === null || billing === void 0 ? void 0 : billing.company) !== null && _b !== void 0 ? _b : \"\",\n          Unit_Number: (_c = billing === null || billing === void 0 ? void 0 : billing.unit) !== null && _c !== void 0 ? _c : \"\"\n        };\n\n        if (uid) {\n          yield _this5.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Billing_Address\").set(data);\n        }\n\n        if (_this5.myCallback) _this5.myCallback();\n      }\n    })();\n  }\n\n  getBlog(blogID) {\n    Globals.selectedBlog = new Blog();\n    let sub = this.db.collectionGroup(\"Blogs\", ref => ref.where(\"Blog_ID\", '==', blogID)).valueChanges().subscribe(docDatas => {\n      docDatas.forEach(doc => {\n        const docData = doc;\n\n        if (docData) {\n          let uid = docData.UID;\n          let title = docData.Title;\n          let timestamp = docData.Timestamp.toDate();\n          let isAvailable = docData.isAvailable;\n          let blogID = docData.Blog_ID;\n          let blogItems = docData.Blog_Items;\n          let coverURL = docData.Cover_URL;\n          let blog = new Blog(uid, timestamp, \"\", isAvailable, title, blogItems, blogID, coverURL);\n          Globals.selectedBlog = blog;\n        }\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getBillingInfo() {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let uid = (_a = yield _this6.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n\n      let sub = _this6.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Identifiers\").valueChanges().subscribe(doc => {\n        let docData = doc;\n\n        if (docData) {\n          let card_type = docData.card_type;\n          let card_last_4 = docData.card_last_4;\n\n          if (Globals.billingInfo) {\n            Globals.billingInfo.brand = card_type;\n            Globals.billingInfo.number = card_last_4;\n          } else {\n            Globals.billingInfo = new BillingInfo(undefined, undefined, card_last_4, card_type);\n          }\n        } else {\n          Globals.billingInfo = new BillingInfo();\n        }\n\n        if (_this6.myCallback) _this6.myCallback();\n        if (isPlatformBrowser(_this6.platformID)) sub.unsubscribe();\n      });\n    })();\n  }\n\n  getShippingAddress(oUID) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      var uid = oUID;\n\n      if (!uid) {\n        uid = (_a = yield _this7.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n      }\n\n      let sub = _this7.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Delivery_Address\").valueChanges().subscribe(doc => {\n        var _a, _b, _c;\n\n        Globals.shippingInfo = undefined;\n        let docData = doc;\n\n        if (docData) {\n          let area = docData.Administrative_Area;\n          let city = docData.City;\n          let country = docData.Country;\n          let firstName = docData.First_Name;\n          let lastName = docData.Last_Name;\n          let name = firstName + \" \" + lastName;\n          let phone = docData.Phone_Num;\n          let postal_code = docData.Postal_Code;\n          let street = docData.Street;\n          var company = (_a = docData.Company) !== null && _a !== void 0 ? _a : \"\";\n          var email = (_b = docData.Email) !== null && _b !== void 0 ? _b : \"\";\n          if (company == \"\") company = undefined;\n          if (email == \"\") email = undefined;\n          var unit = (_c = docData.Unit_Number) !== null && _c !== void 0 ? _c : \"\";\n          if (unit == \"\") unit = undefined;\n          Globals.shippingInfo = new ShippingInfo(name, company, street, city, country, area, unit, postal_code, phone, undefined, email);\n        } else {\n          Globals.shippingInfo = new ShippingInfo();\n        }\n\n        if (_this7.myCallback) _this7.myCallback();\n        if (isPlatformBrowser(_this7.platformID)) sub.unsubscribe();\n      });\n    })();\n  }\n\n  getBillingAddress() {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let uid = (_a = yield _this8.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n\n      let sub = _this8.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Billing_Address\").valueChanges().subscribe(doc => {\n        // Globals.selectedBlog = undefined\n        var _a, _b;\n\n        let docData = doc;\n\n        if (docData) {\n          let area = docData.Administrative_Area;\n          let city = docData.City;\n          let country = docData.Country;\n          let firstName = docData.First_Name;\n          let lastName = docData.Last_Name;\n          let name = firstName + \" \" + lastName;\n          let postal_code = docData.Postal_Code;\n          let street = docData.Street;\n          var company = (_a = docData.Company) !== null && _a !== void 0 ? _a : \"\";\n          if (company == \"\") company = undefined;\n          var unit = (_b = docData.Unit_Number) !== null && _b !== void 0 ? _b : \"\";\n          if (unit == \"\") unit = undefined;\n\n          if (Globals.billingInfo) {\n            Globals.billingInfo.admin_area = area;\n            Globals.billingInfo.city = city;\n            Globals.billingInfo.country = country;\n            Globals.billingInfo.name = name;\n            Globals.billingInfo.postal = postal_code;\n            Globals.billingInfo.street = street;\n            Globals.billingInfo.company = company !== null && company !== void 0 ? company : \"\";\n          } else {\n            Globals.billingInfo = new BillingInfo(name, company, undefined, undefined, street, city, country, area, unit, postal_code, undefined);\n          }\n        } else {\n          Globals.billingInfo = new BillingInfo();\n        }\n\n        if (_this8.myCallback) _this8.myCallback();\n        if (isPlatformBrowser(_this8.platformID)) sub.unsubscribe();\n      });\n    })();\n  }\n\n  isUndefined(element) {\n    return element == undefined || element == null || element == \"\";\n  }\n\n  getTax(taxData) {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      // let uid = (await this.isLoggedIn())?.uid\n      const country = taxData.country;\n      const admin = taxData.admin_area;\n      const street = taxData.street;\n      const postal = taxData.postal;\n      var salesTax = 0.0;\n\n      if (country === \"Canada\" || country === \"CA\") {\n        let sub = _this9.db.collection(\"Canada_Tax_Docs\").doc(admin).valueChanges().subscribe(doc => {\n          // Globals.selectedBlog = undefined\n          let taxDoc = doc;\n\n          if (taxDoc) {\n            if (!_this9.isUndefined(taxDoc.HST)) {\n              salesTax += taxDoc.HST;\n            } else {\n              if (!_this9.isUndefined(taxDoc.GST)) {\n                salesTax += taxDoc.GST;\n              }\n\n              if (!_this9.isUndefined(taxDoc.PST)) {\n                salesTax += taxDoc.PST;\n              }\n            }\n          }\n\n          Globals.shippingTax = salesTax;\n          if (_this9.myCallback) _this9.myCallback();\n          if (isPlatformBrowser(_this9.platformID)) sub.unsubscribe();\n        });\n      } else if (country === \"United States\" || country === \"US\" || country === \"USA\") {\n        Globals.shippingTax = salesTax;\n        if (_this9.myCallback) _this9.myCallback();\n      } else if (country === \"United Kingdom\" || country === \"UK\" || country === \"GB\") {\n        let sub = _this9.db.collection(\"Canada_Tax_Docs\").doc(admin).valueChanges().subscribe(doc => {\n          // Globals.selectedBlog = undefined\n          let taxDoc = doc;\n\n          if (taxDoc) {\n            if (!_this9.isUndefined(taxDoc.HST)) {\n              salesTax += taxDoc.VAT;\n            }\n          }\n\n          Globals.shippingTax = salesTax;\n          if (_this9.myCallback) _this9.myCallback();\n          if (isPlatformBrowser(_this9.platformID)) sub.unsubscribe();\n        });\n      }\n    })();\n  }\n\n  addToCart(mappedData) {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let uid = (_a = yield _this10.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n      const storeUID = Globals.storeInfo.uid;\n\n      if (!storeUID) {\n        return;\n      }\n\n      let data = {\n        \"Cart_List\": firebase.firestore.FieldValue.arrayUnion(mappedData),\n        \"UID\": storeUID,\n        \"Timestamp\": mappedData.Timestamp\n      };\n\n      if (uid) {\n        yield _this10.db.collection(\"Users/\" + uid + \"/Cart_Info\").doc(\"Cart_List_\" + storeUID).set(data, {\n          merge: true\n        });\n      }\n    })();\n  }\n\n  saveUser(mappedData) {\n    var _this11 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let uid = (_a = yield _this11.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n\n      if (mappedData.profile_pic) {\n        let picID = yield _this11.uploadFile(mappedData, uid);\n        mappedData.picID = picID;\n      }\n\n      yield _this11.saveUsername(mappedData, uid);\n    })();\n  }\n\n  updateProduct(mappedData) {\n    var _this12 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d, _e, _f, _g, _h;\n\n      let uid = (_b = (_a = yield _this12.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid) !== null && _b !== void 0 ? _b : \"\";\n      let productID = mappedData.productID;\n      let data = {\n        \"Name\": (_c = mappedData.name) !== null && _c !== void 0 ? _c : \"Post\",\n        \"Search_Name\": (_d = mappedData.name.toLowerCase()) !== null && _d !== void 0 ? _d : \"post\",\n        \"Description\": (_e = mappedData.description) !== null && _e !== void 0 ? _e : \"\",\n        \"Price_Cents\": (_f = mappedData.price) !== null && _f !== void 0 ? _f : 2000,\n        \"Available\": (_g = mappedData.available) !== null && _g !== void 0 ? _g : true\n      };\n      yield _this12.db.collection(\"Users/\" + uid + \"/Products\").doc(productID).update(data);\n      let product = (_h = Globals.products) === null || _h === void 0 ? void 0 : _h.filter(obj => {\n        return obj.productID == productID;\n      })[0];\n      product.name = data.Name;\n      product.description = data.Description;\n      product.price = data.Price_Cents;\n      return console.log(\"Updated Product\");\n    })();\n  }\n\n  createProduct(mappedData) {\n    var _this13 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d, _e;\n\n      let uid = (_b = (_a = yield _this13.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid) !== null && _b !== void 0 ? _b : \"\";\n\n      let productID = _this13.db.collection(\"Users/\" + uid + \"/Products\").doc().ref.id;\n\n      let data = (_c = yield _this13.saveProductInfo(mappedData, productID, uid)) !== null && _c !== void 0 ? _c : {};\n\n      if (((_d = mappedData.images) === null || _d === void 0 ? void 0 : _d.length) > 0) {\n        yield mappedData.images.forEach( /*#__PURE__*/function () {\n          var _ref5 = _asyncToGenerator(function* (image) {\n            let url = yield _this13.uploadProductImages(image.img, image.type, productID, uid);\n            console.log(url);\n          });\n\n          return function (_x5) {\n            return _ref5.apply(this, arguments);\n          };\n        }());\n        let url = mappedData.images.filter(obj => {\n          return obj.type == \"link_\";\n        })[0].img;\n        let product = new Product(uid, productID, data.Description, productID, data.Timestamp, undefined, data.Blurred, data.Price_Cents, data.Name, data.Template_Color, data.Likes, false, data.Comments, data.Available, data.Public, data.Type, data.Side, data.sides, url);\n        (_e = Globals.products) === null || _e === void 0 ? void 0 : _e.unshift(product);\n      }\n    })();\n  }\n\n  saveStore(mappedData) {\n    var _this14 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      let uid = (_a = yield _this14.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n\n      if (((_b = mappedData.images) === null || _b === void 0 ? void 0 : _b.length) > 0) {\n        mappedData.image_list = new Array();\n        yield mappedData.images.forEach( /*#__PURE__*/function () {\n          var _ref6 = _asyncToGenerator(function* (image) {\n            mappedData.image_list.push(image.type);\n            let url = yield _this14.uploadStoreImages(image.img, image.type, uid);\n          });\n\n          return function (_x6) {\n            return _ref6.apply(this, arguments);\n          };\n        }());\n      }\n\n      yield _this14.saveStoreInfo(mappedData, uid);\n    })();\n  }\n\n  uploadProductImages(image, type, productID, uid) {\n    var _this15 = this;\n\n    return _asyncToGenerator(function* () {\n      const filePath = 'Users/' + uid + '/Products/' + productID + \"/\" + type + productID + '.png';\n\n      let ref = _this15.storage.ref(filePath);\n\n      const byteArray = new Buffer(image.replace(/^[\\w\\d;:\\/]+base64\\,/g, ''), 'base64'); // const task = await this.storage.upload(filePath, byteArray);\n\n      const task = yield ref.put(byteArray);\n      const url = yield task.ref.getDownloadURL(); // if (type == \"theme\"){\n      //   Globals.userInfo!.themeLink = url\n      //   if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //     Globals.storeInfo!.themeLink = url\n      //   }\n      // }\n      // else if (type == \"home\"){\n      //   Globals.userInfo!.homeLink = url\n      //   if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //     Globals.storeInfo!.homeLink = url\n      //   }\n      // }\n      // else if (type == \"action\"){\n      //   Globals.userInfo!.actionLink = url\n      //   if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //     Globals.storeInfo!.actionLink = url\n      //   }\n      // }\n\n      return url;\n      return undefined;\n    })();\n  }\n\n  uploadStoreImages(image, type, uid) {\n    var _this16 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c;\n\n      if (type) {\n        const filePath = 'Users/' + uid + '/Store_Images/' + type + '.png';\n\n        let ref = _this16.storage.ref(filePath);\n\n        const byteArray = new Buffer(image.replace(/^[\\w\\d;:\\/]+base64\\,/g, ''), 'base64'); // const task = await this.storage.upload(filePath, byteArray);\n\n        const task = yield ref.put(byteArray);\n        const url = yield task.ref.getDownloadURL();\n\n        if (type == \"theme\") {\n          Globals.userInfo.themeLink = url;\n\n          if (Globals.storeInfo.uid == ((_a = Globals.userInfo) === null || _a === void 0 ? void 0 : _a.uid)) {\n            Globals.storeInfo.themeLink = url;\n          }\n        } else if (type == \"home\") {\n          Globals.userInfo.homeLink = url;\n\n          if (Globals.storeInfo.uid == ((_b = Globals.userInfo) === null || _b === void 0 ? void 0 : _b.uid)) {\n            Globals.storeInfo.homeLink = url;\n          }\n        } else if (type == \"action\") {\n          Globals.userInfo.actionLink = url;\n\n          if (Globals.storeInfo.uid == ((_c = Globals.userInfo) === null || _c === void 0 ? void 0 : _c.uid)) {\n            Globals.storeInfo.actionLink = url;\n          }\n        }\n\n        return url;\n      }\n\n      return undefined;\n    })();\n  }\n\n  saveProductInfo(mappedData, productID, uid) {\n    var _this17 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d, _e, _f, _g;\n\n      let data = {\n        \"Name\": (_a = mappedData.name) !== null && _a !== void 0 ? _a : \"Post\",\n        \"Search_Name\": (_b = mappedData.name.toLowerCase()) !== null && _b !== void 0 ? _b : \"post\",\n        \"Description\": (_c = mappedData.description) !== null && _c !== void 0 ? _c : \"\",\n        \"Price_Cents\": (_d = mappedData.price) !== null && _d !== void 0 ? _d : 2000,\n        \"UID\": uid,\n        \"Blurred\": false,\n        \"Timestamp\": new Date(),\n        \"Template_Color\": (_e = mappedData.templateColor) !== null && _e !== void 0 ? _e : \"black\",\n        \"Likes\": 0,\n        \"Comments\": 0,\n        \"Has_Picture\": false,\n        \"Product_ID\": productID,\n        \"Available\": true,\n        \"Public\": true,\n        \"Type\": (_f = mappedData.productType) !== null && _f !== void 0 ? _f : \"ATC1000\",\n        \"Side\": (_g = mappedData.displaySide) !== null && _g !== void 0 ? _g : \"front\",\n        \"Sides\": mappedData.sides\n      };\n\n      if (uid) {\n        yield _this17.db.collection(\"Users/\" + uid + \"/Products\").doc(productID).set(data);\n        return data; // Globals.userInfo!.slogan = mappedData.slogan\n        // let matchingTheme = Globals.themes?.filter(theme => theme.name == mappedData.theme.name)[0]\n        // if (matchingTheme){\n        //   Globals.userInfo!.colorStyle = matchingTheme\n        // }\n        // Globals.userInfo!.slogan = mappedData.slogan\n        // Globals.userInfo!.fontName = mappedData.font\n        // if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n        //   if (matchingTheme){\n        //     Globals.storeInfo!.colorStyle = matchingTheme\n        //     Globals.storeInfo!.fontName = mappedData.font\n        //   }\n        // }\n      }\n\n      return undefined;\n    })();\n  }\n\n  saveStoreInfo(mappedData, uid) {\n    var _this18 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c;\n\n      var data = {\n        \"Slogan\": (_a = mappedData.slogan) !== null && _a !== void 0 ? _a : \"\"\n      };\n\n      if (mappedData.indicator) {\n        data[\"indicator\"] = mappedData.indicator;\n      }\n\n      if (mappedData.theme) {\n        data[\"store_style\"] = mappedData.theme;\n      }\n\n      if (mappedData.font) {\n        data[\"font\"] = mappedData.font;\n      }\n\n      if (mappedData.image_list) {\n        data[\"image_list\"] = firebase.firestore.FieldValue.arrayUnion(...mappedData.image_list);\n      }\n\n      if (uid) {\n        yield _this18.db.collection(\"Users\").doc(uid).update(data);\n        Globals.userInfo.slogan = mappedData.slogan;\n        let matchingTheme = (_b = Globals.themes) === null || _b === void 0 ? void 0 : _b.filter(theme => theme.name == mappedData.theme.name)[0];\n\n        if (matchingTheme) {\n          Globals.userInfo.colorStyle = matchingTheme;\n        }\n\n        Globals.userInfo.slogan = mappedData.slogan;\n        Globals.userInfo.fontName = mappedData.font;\n\n        if (Globals.storeInfo.uid == ((_c = Globals.userInfo) === null || _c === void 0 ? void 0 : _c.uid)) {\n          if (matchingTheme) {\n            Globals.storeInfo.colorStyle = matchingTheme;\n            Globals.storeInfo.fontName = mappedData.font;\n          }\n        }\n      }\n\n      if (_this18.myCallback) _this18.myCallback();\n    })();\n  }\n\n  uploadFile(mappedData, uid) {\n    var _this19 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let picID = uuid().toString().replace(\"-\", \"\");\n      const filePath = 'Users/' + uid + '/profile_pic-' + picID + '.jpeg';\n\n      let ref = _this19.storage.ref(filePath);\n\n      const byteArray = new Buffer(mappedData.profile_pic.replace(/^[\\w\\d;:\\/]+base64\\,/g, ''), 'base64'); // const task = await this.storage.upload(filePath, byteArray);\n\n      const task = yield ref.put(byteArray);\n      const url = yield task.ref.getDownloadURL();\n      Globals.userInfo.dpID = picID;\n      Globals.userInfo.profileLink = url;\n\n      if (Globals.storeInfo.uid == ((_a = Globals.userInfo) === null || _a === void 0 ? void 0 : _a.uid)) {\n        Globals.storeInfo.dpID = picID;\n        Globals.storeInfo.profileLink = url;\n      }\n\n      return picID;\n    })();\n  }\n\n  saveUsername(mappedData, uid) {\n    var _this20 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      var data = {\n        \"Username\": mappedData.username,\n        \"Full_Name\": mappedData.full_name,\n        \"Bio\": mappedData.bio\n      };\n\n      if (mappedData.picID) {\n        data[\"ProfilePicID\"] = mappedData.picID;\n      }\n\n      if (mappedData.socials) {\n        data[\"Socials\"] = (_a = mappedData.socials) !== null && _a !== void 0 ? _a : [];\n      }\n\n      if (uid) {\n        yield _this20.db.collection(\"Users\").doc(uid).update(data);\n        Globals.userInfo.username = mappedData.username;\n        Globals.userInfo.fullName = mappedData.full_name;\n\n        if (Globals.storeInfo.uid == ((_b = Globals.userInfo) === null || _b === void 0 ? void 0 : _b.uid)) {\n          Globals.storeInfo.username = mappedData.username;\n          Globals.storeInfo.fullName = mappedData.full_name;\n        }\n      }\n\n      if (_this20.myCallback) _this20.myCallback();\n    })();\n  }\n\n  openSnackBar(message, timeDuration = 1000, horizontal = 'right', vertical = 'top') {\n    this.snackBar.open(message, '', {\n      duration: timeDuration,\n      horizontalPosition: horizontal,\n      verticalPosition: vertical\n    });\n  }\n\n  changeCart(mappedData) {\n    var _this21 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let uid = (_a = yield _this21.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n      let data = {\n        \"Cart_List\": mappedData\n      };\n      const storeUID = Globals.storeInfo.uid;\n\n      if (!storeUID) {\n        return;\n      }\n\n      if (uid) {\n        yield _this21.db.collection(\"Users/\" + uid + \"/Cart_Info\").doc(\"Cart_List_\" + storeUID).set(data);\n      }\n    })();\n  }\n\n  signOut() {\n    var _this22 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this22.auth.signOut().then(() => {\n        Globals.userInfo = undefined;\n        if (_this22.myCallback) _this22.myCallback();\n      }).catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        if (_this22.errCallback) _this22.errCallback(errorMessage);\n      }); // Sign Out\n    })();\n  }\n\n  isLoggedIn() {\n    return this.auth.authState.pipe(first()).toPromise();\n  }\n\n  registerAccount(type, credentials) {\n    var _this23 = this;\n\n    if (type == \"Guest\") {\n      this.auth.signInAnonymously().then(() => {\n        // Signed in..\n        if (this.myCallback) this.myCallback();\n      }).catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        if (this.errCallback) this.errCallback(errorMessage);\n      });\n    } else if (type == \"Email_UP\") {\n      let username = credentials === null || credentials === void 0 ? void 0 : credentials.username;\n      let password = credentials === null || credentials === void 0 ? void 0 : credentials.password;\n      let email = credentials === null || credentials === void 0 ? void 0 : credentials.email;\n      this.auth.createUserWithEmailAndPassword(email, password).then( /*#__PURE__*/function () {\n        var _ref7 = _asyncToGenerator(function* (result) {\n          var _a, _b; // Signed in..\n\n\n          yield (_a = result.user) === null || _a === void 0 ? void 0 : _a.sendEmailVerification();\n\n          if (result.user && username) {\n            yield _this23.setUsername((_b = result.user) === null || _b === void 0 ? void 0 : _b.uid, username, true);\n            if (_this23.myCallback) _this23.myCallback();\n          } else {\n            yield _this23.auth.signOut();\n            if (_this23.myCallback) _this23.myCallback();\n          }\n        });\n\n        return function (_x7) {\n          return _ref7.apply(this, arguments);\n        };\n      }()).catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        if (this.errCallback) this.errCallback(errorMessage);\n        console.log(errorCode);\n      });\n    } else if (type == \"Email_IN\") {\n      let password = credentials === null || credentials === void 0 ? void 0 : credentials.password;\n      let email = credentials === null || credentials === void 0 ? void 0 : credentials.email;\n      this.auth.signInWithEmailAndPassword(email, password).then( /*#__PURE__*/function () {\n        var _ref8 = _asyncToGenerator(function* (result) {\n          // Signed in..\n          if (result.user) {\n            if (_this23.myCallback) _this23.myCallback();\n          } else {\n            yield _this23.auth.signOut();\n            if (_this23.myCallback) _this23.myCallback();\n          }\n        });\n\n        return function (_x8) {\n          return _ref8.apply(this, arguments);\n        };\n      }()).catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        if (this.errCallback) this.errCallback(errorMessage);\n        console.log(errorCode);\n      });\n    } else if (type == \"Email_IN_USER\") {\n      let data = {\n        \"Field\": credentials === null || credentials === void 0 ? void 0 : credentials.Field,\n        \"Term\": credentials === null || credentials === void 0 ? void 0 : credentials.Term\n      };\n      this.functions.httpsCallable('auth')(data).pipe(first()).subscribe( /*#__PURE__*/function () {\n        var _ref9 = _asyncToGenerator(function* (resp) {\n          if (resp) {\n            if (resp.includes(\"ERROR:\")) {\n              let err = resp.replace(\"ERROR:\", \"\");\n              console.log(err);\n            } else {\n              let email = resp;\n              let password = credentials === null || credentials === void 0 ? void 0 : credentials.password;\n\n              _this23.auth.signInWithEmailAndPassword(email, password).then( /*#__PURE__*/function () {\n                var _ref10 = _asyncToGenerator(function* (result) {\n                  // Signed in..\n                  if (result.user) {\n                    if (_this23.myCallback) _this23.myCallback();\n                  } else {\n                    yield _this23.auth.signOut();\n                    if (_this23.myCallback) _this23.myCallback();\n                  }\n                });\n\n                return function (_x10) {\n                  return _ref10.apply(this, arguments);\n                };\n              }()).catch(error => {\n                var errorCode = error.code;\n                var errorMessage = error.message;\n                if (_this23.errCallback) _this23.errCallback(errorMessage);\n                console.log(errorCode);\n              });\n            }\n          } else {}\n        });\n\n        return function (_x9) {\n          return _ref9.apply(this, arguments);\n        };\n      }(), err => {\n        var errorCode = err.code;\n        var errorMessage = err.message;\n        if (this.errCallback) this.errCallback(errorMessage);\n        console.log(errorCode);\n      });\n    } else if (type == \"Apple\") {\n      var appleProvider = new firebase.auth.OAuthProvider('apple.com');\n      appleProvider.addScope('email');\n      appleProvider.addScope('name');\n      this.auth.signInWithPopup(appleProvider).then( /*#__PURE__*/function () {\n        var _ref11 = _asyncToGenerator(function* (result) {\n          // Signed in..\n          var _a, _b, _c, _d, _e, _f, _g, _h;\n\n          if (((_b = (_a = result.additionalUserInfo) === null || _a === void 0 ? void 0 : _a.isNewUser) !== null && _b !== void 0 ? _b : false) && ((_c = result.user) === null || _c === void 0 ? void 0 : _c.uid)) {\n            yield (_d = result.user) === null || _d === void 0 ? void 0 : _d.sendEmailVerification();\n            yield _this23.setUsername((_e = result.user) === null || _e === void 0 ? void 0 : _e.uid, (_g = (_f = result === null || result === void 0 ? void 0 : result.additionalUserInfo) === null || _f === void 0 ? void 0 : _f.username) !== null && _g !== void 0 ? _g : 'user_' + uuid.toString(), !_this23.isUndefined((_h = result === null || result === void 0 ? void 0 : result.additionalUserInfo) === null || _h === void 0 ? void 0 : _h.username));\n          }\n\n          if (_this23.myCallback) _this23.myCallback();\n        });\n\n        return function (_x11) {\n          return _ref11.apply(this, arguments);\n        };\n      }()).catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        if (this.errCallback) this.errCallback(errorMessage);\n      });\n    } else if (type == \"Google\") {\n      var googleProvider = new firebase.auth.GoogleAuthProvider();\n      googleProvider.addScope('email');\n      googleProvider.addScope('profile');\n      this.auth.signInWithPopup(googleProvider).then( /*#__PURE__*/function () {\n        var _ref12 = _asyncToGenerator(function* (result) {\n          var _a, _b, _c, _d, _e, _f, _g; // Signed in..\n\n\n          if (((_b = (_a = result.additionalUserInfo) === null || _a === void 0 ? void 0 : _a.isNewUser) !== null && _b !== void 0 ? _b : false) && ((_c = result.user) === null || _c === void 0 ? void 0 : _c.uid)) {\n            // await result.user?.sendEmailVerification()\n            yield _this23.setUsername((_d = result.user) === null || _d === void 0 ? void 0 : _d.uid, (_f = (_e = result === null || result === void 0 ? void 0 : result.additionalUserInfo) === null || _e === void 0 ? void 0 : _e.username) !== null && _f !== void 0 ? _f : 'user_' + uuid().replace('-', ''), !_this23.isUndefined((_g = result === null || result === void 0 ? void 0 : result.additionalUserInfo) === null || _g === void 0 ? void 0 : _g.username));\n          }\n\n          if (_this23.myCallback) _this23.myCallback();\n        });\n\n        return function (_x12) {\n          return _ref12.apply(this, arguments);\n        };\n      }()).catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        console.log(error);\n        if (this.errCallback) this.errCallback(errorMessage);\n      });\n    }\n  }\n\n  setUsername(uid, username, hasUsername) {\n    var _this24 = this;\n\n    return _asyncToGenerator(function* () {\n      var data = {\n        'Full_Name': \"GUEST\",\n        'Username': username,\n        'Bio': '',\n        'ProfilePicID': null,\n        'notification_tokens': [],\n        'Following_List': [],\n        'Following_Count': 0,\n        'Followers_Count': 0,\n        'Posts_Count': 0,\n        'Platform': \"WEB\"\n      };\n\n      if (hasUsername !== null && hasUsername !== void 0 ? hasUsername : false) {\n        data.Full_Name = username.toUpperCase();\n      }\n\n      yield _this24.db.collection(\"Users\").doc(uid).set(data, {\n        merge: true\n      });\n      return true;\n    })();\n  }\n\n  authenticated() {\n    var _this25 = this;\n\n    return _asyncToGenerator(function* () {\n      const user = yield _this25.isLoggedIn();\n\n      if (user) {\n        return true;\n      } else {\n        return false;\n      }\n    })();\n  }\n\n  getCart() {\n    var _this26 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      const uid = (_a = yield _this26.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n      const storeUID = Globals.storeInfo.uid;\n      Globals.cart = [];\n\n      if (!storeUID || !uid) {\n        if (_this26.myCallback) _this26.myCallback();\n        return;\n      }\n\n      let sub = _this26.db.collection(\"Users/\" + uid + \"/Cart_Info\").doc(\"Cart_List_\" + storeUID).valueChanges().subscribe(doc => {\n        const docData = doc;\n\n        if (docData) {\n          let cartList = docData.Cart_List;\n          cartList.forEach((productInCart, i) => {\n            var _a;\n\n            let uid = productInCart.UID;\n            let size = productInCart.Size;\n            let qty = productInCart.Qty;\n            let timestamp = productInCart.Timestamp.toDate();\n            let productID = productInCart.Post_ID;\n            let product = new Product(uid, productID, undefined, productID, timestamp, undefined, undefined, undefined, undefined, undefined, undefined, false, undefined, true, undefined, undefined, undefined, [], _this26.getURL(uid, productID));\n            let productCart = new ProductInCart(product, size, qty, false, timestamp, \"\", undefined);\n            (_a = Globals.cart) === null || _a === void 0 ? void 0 : _a.push(productCart);\n\n            _this26.getPost(productID, true, i);\n          });\n        }\n\n        if (_this26.myCallback) _this26.myCallback();\n        if (isPlatformBrowser(_this26.platformID)) sub.unsubscribe();\n      });\n    })();\n  }\n\n  getOrder(orderID) {\n    var _this27 = this;\n\n    return _asyncToGenerator(function* () {\n      let sub = _this27.db.collectionGroup(\"Orders\", ref => ref.where(\"order_id\", '==', orderID)).valueChanges().subscribe(docDatas => {\n        docDatas.forEach(doc => {\n          var _a, _b, _c;\n\n          const docData = doc;\n\n          if (docData) {\n            let status = (_a = docData.status) !== null && _a !== void 0 ? _a : \"cancelled\";\n            let intents = docData.order_intents;\n            let timestamp = docData.timestamp.toDate();\n            let shippingIntent = docData.shipping_intent;\n            let trackingNumber = docData.tracking_id;\n            let shippingCost = ((_b = docData.shipping_cost) !== null && _b !== void 0 ? _b : 0) / 100;\n            let taxPercent = docData.tax;\n            let taxNum = docData.sales_tax;\n            let currency = (_c = docData.currency) !== null && _c !== void 0 ? _c : \"CAD\";\n            let currencySymbol = docData.currency_symbol;\n            let orderID = docData.order_id;\n            let merchantID = docData.merchant_uid;\n            var subtotal = 0.0;\n            let address = docData.delivery_address;\n            let street = address.street_address;\n            let city = address.city;\n            let country = address.country;\n            let postalCode = address.postal_code;\n            let area = address.admin_area;\n            let phone = address.phone_number;\n            let name = address.full_name;\n            let company = address.company;\n            let email = address.email;\n            let country_code = address.country_code;\n            const uid = docData.uid; // let shippingCost = (doc[\"shipping_cost\"] as? Double ?? 0.00) / 100              \n\n            let unitNum = address.unit_number;\n            let orderAddress = new ShippingInfo(name, company, street, city, country, area, unitNum, postalCode, phone, country_code, email);\n            let tax = taxNum !== null && taxNum !== void 0 ? taxNum : (taxPercent !== null && taxPercent !== void 0 ? taxPercent : 0) * subtotal;\n            let totalCost = (tax !== null && tax !== void 0 ? tax : 0.0) + (subtotal !== null && subtotal !== void 0 ? subtotal : 0.0) + (shippingCost !== null && shippingCost !== void 0 ? shippingCost : 0.0);\n            let order = new Order(orderID, timestamp, [], status, intents, totalCost, tax, subtotal, orderAddress, currency, currencySymbol, trackingNumber, shippingIntent, shippingCost, uid, merchantID);\n            Globals.selectedOrder = order;\n\n            _this27.getOrderProducts(order, uid, 0, true);\n          } else {\n            Globals.selectedOrder = new Order();\n          }\n        });\n        if (_this27.myCallback) _this27.myCallback();\n        if (isPlatformBrowser(_this27.platformID)) sub.unsubscribe();\n      });\n    })();\n  }\n\n  getOrders() {\n    var _this28 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      const uid = (_a = yield _this28.isLoggedIn()) === null || _a === void 0 ? void 0 : _a.uid;\n      const storeUID = Globals.storeInfo.uid;\n\n      if (!storeUID || !uid) {\n        if (_this28.myCallback) _this28.myCallback();\n        return;\n      }\n\n      var query = _this28.db.collection(\"Users/\" + uid + \"/Orders\", ref => ref.where(\"merchant_uid\", '==', storeUID).orderBy(\"timestamp\", \"desc\"));\n\n      Globals.orders = [];\n      let sub = query.valueChanges().subscribe(docDatas => {\n        docDatas.forEach((doc, index) => {\n          var _a, _b, _c;\n\n          const docData = doc;\n\n          if (docData) {\n            let status = (_a = docData.status) !== null && _a !== void 0 ? _a : \"cancelled\";\n            let intents = docData.order_intents;\n            let timestamp = docData.timestamp.toDate();\n            let shippingIntent = docData.shipping_intent;\n            let trackingNumber = docData.tracking_id;\n            let shippingCost = docData.shipping_cost;\n            let taxPercent = docData.tax;\n            let taxNum = docData.sales_tax;\n            let currency = (_b = docData.currency) !== null && _b !== void 0 ? _b : \"CAD\";\n            let currencySymbol = docData.currency_symbol;\n            let orderID = docData.order_id;\n            let merchantID = docData.merchant_uid;\n            var subtotal = 0.0;\n            let address = docData.delivery_address;\n            let street = address.street_address;\n            let city = address.city;\n            let country = address.country;\n            let postalCode = address.postal_code;\n            let area = address.admin_area;\n            let phone = address.phone_number;\n            let name = address.full_name;\n            let company = address.company;\n            let email = address.email;\n            let country_code = address.country_code;\n            const uid = docData.uid; // let shippingCost = (doc[\"shipping_cost\"] as? Double ?? 0.00) / 100              \n\n            let unitNum = address.unit_number;\n            let orderAddress = new ShippingInfo(name, company, street, city, country, area, unitNum, postalCode, phone, country_code, email);\n            let tax = taxNum !== null && taxNum !== void 0 ? taxNum : (taxPercent !== null && taxPercent !== void 0 ? taxPercent : 0) * subtotal;\n            let totalCost = (tax !== null && tax !== void 0 ? tax : 0.0) + (subtotal !== null && subtotal !== void 0 ? subtotal : 0.0) + (shippingCost !== null && shippingCost !== void 0 ? shippingCost : 0.0);\n            let order = new Order(orderID, timestamp, [], status, intents, totalCost, tax, subtotal, orderAddress, currency, currencySymbol, trackingNumber, shippingIntent, shippingCost, uid, merchantID);\n            (_c = Globals.orders) === null || _c === void 0 ? void 0 : _c.push(order);\n\n            _this28.getOrderProducts(order, uid, index);\n          }\n        });\n        if (_this28.myCallback) _this28.myCallback();\n        if (isPlatformBrowser(_this28.platformID)) sub.unsubscribe();\n      });\n    })();\n  }\n\n  getOrderProducts(order, uid, orderIndex, isSelectedOrder) {\n    let sub = this.db.collection(\"Users/\" + uid + \"/Orders/\" + order.orderID + \"/Purchases\").valueChanges().subscribe(docDatas => {\n      docDatas.forEach((doc, index) => {\n        const docData = doc;\n\n        if (docData) {\n          let productID = docData.productID;\n          let quantity = docData.quantity;\n          let size = docData.size;\n          let status = docData.status;\n          let price = docData.amount / quantity;\n          let timestamp = docData.timestamp.toDate();\n          let product = new Product(uid, productID, undefined, productID, timestamp, undefined, undefined, price, undefined, undefined, undefined, false, undefined, true, undefined, undefined, undefined, [], this.getURL(uid, productID));\n          let orderProduct = new ProductInCart(product, size, quantity, false, timestamp, undefined, undefined);\n          order.products.push(orderProduct);\n\n          if (isSelectedOrder !== null && isSelectedOrder !== void 0 ? isSelectedOrder : false) {\n            this.getPost(productID, undefined, undefined, undefined, orderIndex, index, true);\n          } else {\n            this.getPost(productID, undefined, undefined, true, orderIndex, index, false);\n          }\n        }\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getMiscStats(uid) {\n    Globals.views = [];\n    Globals.dropCarts = [];\n    let sub = this.db.collection(\"Users/\" + uid + \"/Daily_Info/\").valueChanges().subscribe(docDatas => {\n      docDatas.forEach((doc, index) => {\n        var _a;\n\n        const docData = doc;\n\n        if (docData) {\n          let time = docData.time;\n          let timestamp = docData.timestamp.toDate();\n          let length = time.length;\n          (_a = Globals.views) === null || _a === void 0 ? void 0 : _a.push({\n            views: length,\n            timestamp: timestamp\n          });\n        }\n      });\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n      let sub2 = this.db.collectionGroup(\"Cart_Info\", ref => ref.where(\"UID\", \"==\", uid)).valueChanges().subscribe(docDatas => {\n        docDatas.forEach((doc, index) => {\n          var _a, _b;\n\n          const docData = doc;\n\n          if (docData) {\n            let timestamp = (_a = docData.Timestamp) === null || _a === void 0 ? void 0 : _a.toDate();\n            (_b = Globals.dropCarts) === null || _b === void 0 ? void 0 : _b.push({\n              dropCarts: 1,\n              timestamp: timestamp\n            });\n          }\n        });\n        if (isPlatformBrowser(this.platformID)) sub2.unsubscribe();\n        if (this.miscCallback) this.miscCallback();\n      });\n    });\n  }\n\n  getSoldProducts(uid = \"\") {\n    Globals.productsSold = [];\n    let sub = this.db.collectionGroup(\"Purchases\", ref => ref.where(\"merchant_uid\", '==', uid).where(\"status\", '==', 'confirmed')).valueChanges().subscribe(docDatas => {\n      docDatas.forEach((doc, index) => {\n        var _a, _b;\n\n        const docData = doc;\n\n        if (docData) {\n          let productID = docData.productID;\n          let quantity = docData.quantity;\n          let size = docData.size;\n          let price = docData.amount / quantity;\n          let profit = docData.moneyToMerchant / 100;\n          let timestamp = (_a = docData.timestamp) === null || _a === void 0 ? void 0 : _a.toDate();\n          let product = new Product(uid, productID, undefined, productID, timestamp, undefined, undefined, price / 100, undefined, undefined, undefined, false, undefined, true, undefined, undefined, undefined, [], this.getURL(uid, productID));\n          let orderProduct = new ProductInCart(product, size, quantity, false, timestamp, undefined, undefined, profit !== null && profit !== void 0 ? profit : 0);\n          (_b = Globals.productsSold) === null || _b === void 0 ? void 0 : _b.push(orderProduct);\n          this.getPost(productID, undefined, undefined, false, undefined, index, false, true);\n        }\n      });\n      if (this.saleCallback) this.saleCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getPost(productID, forCart, cartIndex, forOrder, orderIndex, productIndex, isSelectedOrder, forSale) {\n    let sub = this.db.collectionGroup(\"Products\", ref => ref.where(\"Product_ID\", '==', productID).where(\"Public\", '==', true)).valueChanges().subscribe(docDatas => {\n      if (docDatas.length == 0) {\n        if (this.myCallback) this.myCallback();\n        if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n      }\n\n      docDatas.forEach(doc => {\n        var _a, _b, _c, _d, _e, _f, _g, _h;\n\n        const docData = doc;\n\n        if (docData) {\n          let uid = docData.UID;\n          let productID = docData.Product_ID;\n          let timestamp = docData.Timestamp.toDate();\n          let description = docData.Description;\n          let name = docData.Name;\n          let blurred = docData.Blurred;\n          let templateColor = docData.Template_Color;\n          let likes = docData.Likes;\n          let comments = docData.Comments;\n          let isPublic = (_a = docData.Public) !== null && _a !== void 0 ? _a : true;\n          let productType = (_b = docData.Type) !== null && _b !== void 0 ? _b : \"ATC1000\";\n          let displaySide = (_c = docData.Side) !== null && _c !== void 0 ? _c : \"front\";\n          let sides = (_d = docData[\"Sides\"]) !== null && _d !== void 0 ? _d : [\"Front\"];\n          let priceCents = docData.Price_Cents;\n          let product = new Product(uid, productID, description, productID, timestamp, \"\", blurred, priceCents, name, templateColor, likes, false, comments, true, isPublic, productType, displaySide, sides, this.getURL(uid, productID));\n\n          if (forCart !== null && forCart !== void 0 ? forCart : false) {\n            Globals.cart[cartIndex].product = product;\n            if (this.myCallback) this.myCallback();\n            if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n          } else if (forOrder !== null && forOrder !== void 0 ? forOrder : false) {\n            product.price = (_f = (_e = Globals.orders[orderIndex].products[productIndex].product) === null || _e === void 0 ? void 0 : _e.price) !== null && _f !== void 0 ? _f : 0;\n            Globals.orders[orderIndex].products[productIndex].product = product;\n            if (this.myCallback) this.myCallback();\n            if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n          } else if (isSelectedOrder !== null && isSelectedOrder !== void 0 ? isSelectedOrder : false) {\n            product.price = (_h = (_g = Globals.selectedOrder.products[productIndex].product) === null || _g === void 0 ? void 0 : _g.price) !== null && _h !== void 0 ? _h : 0;\n            Globals.selectedOrder.products[productIndex].product = product;\n            if (this.myCallback) this.myCallback();\n            if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n          } else if (forSale && productIndex && Globals.productsSold) {\n            Globals.productsSold[productIndex] = product;\n          } else {\n            Globals.selectedProduct = product;\n            if (this.myCallback) this.myCallback();\n            if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n          }\n        }\n      });\n    });\n  }\n\n  getTemplatesFiltered() {\n    Globals.templates = [...new Map(Globals.templates.map(item => [item.productCode, item])).values()];\n    return Globals.templates.filter((template, i) => {\n      var _a;\n\n      return (_a = Globals.products) === null || _a === void 0 ? void 0 : _a.some(product => product.productType === template.productCode);\n    });\n  }\n\n  getURL(uid, productID) {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FProducts%2F' + productID + '%2Flink_' + productID + '.png?alt=media';\n  }\n\n  getProfileURL(uid, dpID) {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2Fprofile_pic-' + dpID + '.jpeg?alt=media';\n  }\n\n  getThemeURL(uid) {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FStore_Images%2F' + \"theme\" + '.png?alt=media';\n  }\n\n  getDefaultURL() {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2FSample-Walls%2FHome%2F1.jpg?alt=media';\n  }\n\n  getHomeURL(uid) {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FStore_Images%2F' + \"home\" + '.png?alt=media';\n  }\n\n  getActionURL(uid) {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FStore_Images%2F' + \"action\" + '.png?alt=media';\n  }\n\n  getAltURL() {\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2Flink_empty.jpeg?alt=media';\n  }\n\n  getTemplate(templateID) {\n    Globals.selectedTemplate = undefined;\n    let sub = this.db.collection(\"Templates\", ref => ref.where(\"Code\", '==', templateID).orderBy(\"index\", \"asc\")).valueChanges({\n      idField: \"TemplateID\"\n    }).subscribe(docDatas => {\n      docDatas.forEach(doc => {\n        var docData = doc;\n\n        if (docData) {\n          let type = doc.TemplateID;\n          let testingAccounts = docData[\"testingAccounts\"];\n          let isAvailable = docData[\"isAvailable\"]; // guard isAvailable ?? false || testingAccounts?.contains(pUserInfo.uid ?? \"\") ?? false else{\n          //     continue\n          //   }\n\n          let display = docData[\"Display_Name\"];\n          let info = docData[\"Info\"];\n          let supportedSides = docData[\"Supported_Sides\"];\n\n          if (!supportedSides || supportedSides.length == 0) {\n            return;\n          }\n\n          let vari = docData[\"Colors\"];\n          let minPrice = docData[\"Min_Price_USD\"];\n          let extra = docData[\"Extra_Cost_USD\"];\n          let code = docData[\"Code\"];\n          let sizes = docData[\"Sizes\"];\n          let category = docData[\"category\"];\n          let has3D = docData[\"has3D\"];\n          let moreInfo = docData[\"More_info\"]; // let discountInfo = docData[\"Discount\"] as Dict<any>\n          // let discountedUsers = discountInfo[\"Artists\"] as Array<string>\n          // let discountedPrice = discountInfo.Minimum_Price_USD as number\n          // let discountCodes = discountInfo.Discount_Codes as Array<Dict<any>>   \n\n          const template = new Template(type, display, info, [], sizes, minPrice, code, category, moreInfo, false, [], extra, has3D);\n          supportedSides.forEach(side => {\n            var _a;\n\n            let name = side[\"Name\"];\n            let height = side[\"HeightCM\"];\n            let width = side[\"WidthCM\"];\n            let widthMultiplier = side[\"WidthMultiplier\"];\n            let centerYConst = side[\"CenterYConst\"];\n            let centerXConst = side[\"CenterXConst\"];\n            let rotation = side[\"Rotation\"];\n            let useReverseAspect = (_a = side[\"useReverseAspect\"]) !== null && _a !== void 0 ? _a : false;\n            let supportedSide = new TemplateSide(name, height, width, widthMultiplier, centerYConst, centerXConst, useReverseAspect, rotation);\n            template.supportedSides.push(supportedSide);\n          });\n          vari.forEach(v => {\n            var _a, _b;\n\n            let code = v[\"Code\"];\n            let display = v[\"Display\"];\n            let img = (_a = v[\"IMG\"]) === null || _a === void 0 ? void 0 : _a.toBase64();\n            let backImg = (_b = v[\"IMG_BACK\"]) === null || _b === void 0 ? void 0 : _b.toBase64();\n            let rgb = v[\"RGB\"];\n            let color = new Color(code, display, rgb, img, backImg);\n            template.colors.push(color);\n          });\n          Globals.selectedTemplate = template;\n        }\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n  getTemplates() {\n    Globals.templates = [];\n    let sub = this.db.collection(\"Templates\", ref => ref.orderBy(\"index\", \"asc\")).valueChanges({\n      idField: \"TemplateID\"\n    }).subscribe(docDatas => {\n      docDatas.forEach(doc => {\n        var docData = doc;\n\n        if (docData) {\n          let type = doc.TemplateID;\n          let testingAccounts = docData[\"testingAccounts\"];\n          let isAvailable = docData[\"isAvailable\"]; // guard isAvailable ?? false || testingAccounts?.contains(pUserInfo.uid ?? \"\") ?? false else{\n          //     continue\n          //   }\n\n          let display = docData[\"Display_Name\"];\n          let info = docData[\"Info\"];\n          let supportedSides = docData[\"Supported_Sides\"];\n\n          if (!supportedSides || supportedSides.length == 0) {\n            return;\n          }\n\n          let vari = docData[\"Colors\"];\n          let minPrice = docData[\"Min_Price_USD\"];\n          let extra = docData[\"Extra_Cost_USD\"];\n          let code = docData[\"Code\"];\n          let sizes = docData[\"Sizes\"];\n          let category = docData[\"category\"];\n          let has3D = docData[\"has3D\"];\n          let moreInfo = docData[\"More_info\"]; // let discountInfo = docData[\"Discount\"] as Dict<any>\n          // let discountedUsers = discountInfo[\"Artists\"] as Array<string>\n          // let discountedPrice = discountInfo.Minimum_Price_USD as number\n          // let discountCodes = discountInfo.Discount_Codes as Array<Dict<any>>   \n\n          const template = new Template(type, display, info, [], sizes, minPrice, code, category, moreInfo, false, [], extra, has3D);\n          supportedSides.forEach(side => {\n            var _a;\n\n            let name = side[\"Name\"];\n            let height = side[\"HeightCM\"];\n            let width = side[\"WidthCM\"];\n            let widthMultiplier = side[\"WidthMultiplier\"];\n            let centerYConst = side[\"CenterYConst\"];\n            let centerXConst = side[\"CenterXConst\"];\n            let rotation = side[\"Rotation\"];\n            let useReverseAspect = (_a = side[\"useReverseAspect\"]) !== null && _a !== void 0 ? _a : false;\n            let supportedSide = new TemplateSide(name, height, width, widthMultiplier, centerYConst, centerXConst, useReverseAspect, rotation);\n            template.supportedSides.push(supportedSide);\n          });\n          vari.forEach(v => {\n            var _a, _b;\n\n            let code = v[\"Code\"];\n            let display = v[\"Display\"];\n            let img = (_a = v[\"IMG\"]) === null || _a === void 0 ? void 0 : _a.toBase64();\n            let backImg = (_b = v[\"IMG_BACK\"]) === null || _b === void 0 ? void 0 : _b.toBase64();\n            let rgb = v[\"RGB\"];\n            let color = new Color(code, display, rgb, img, backImg);\n            template.colors.push(color);\n          });\n\n          if (!Globals.templates.includes(template)) {\n            Globals.templates.push(template);\n          }\n        }\n      });\n      if (this.myCallback) this.myCallback();\n      if (isPlatformBrowser(this.platformID)) sub.unsubscribe();\n    });\n  }\n\n}\n\nLoadService.ɵfac = function LoadService_Factory(t) {\n  return new (t || LoadService)(i0.ɵɵinject(PLATFORM_ID), i0.ɵɵinject(i1.AngularFirestore), i0.ɵɵinject(i2.AngularFireAuth), i0.ɵɵinject(i3.AngularFireFunctions), i0.ɵɵinject(i4.AngularFireStorage), i0.ɵɵinject(i5.StripeService), i0.ɵɵinject(i6.MatSnackBar));\n};\n\nLoadService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: LoadService,\n  factory: LoadService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/Users/artakoroushnia/Desktop/thred-web/src/app/services/load.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Inject, PLATFORM_ID } from '@angular/core';\nimport { AngularFirestore, DocumentData, DocumentReference, docChanges } from '@angular/fire/firestore';\nimport { AngularFireAuth, } from '@angular/fire/auth';\nimport firebase from 'firebase/app';\nimport { Product } from '../models/product.model';\nimport { Template } from '../models/template.model';\nimport { TemplateSide } from '../models/template-side.model';\nimport { Color } from '../models/color.model';\nimport { Country } from '../models/shipping-country.model';\nimport { Globals } from '../globals';\nimport { isPlatformBrowser } from '@angular/common';\nimport { Blog } from '../models/blog.model';\nimport { switchMap, count, take } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport { ProductInCart } from '../models/product-in-cart.model';\nimport { ShippingInfo } from '../models/shipping-address.model';\nimport { BillingInfo } from '../models/billing-address.model';\nimport { AngularFireFunctions } from '@angular/fire/functions';\nimport { AngularFireStorage } from '@angular/fire/storage';\n\nimport { environment } from 'src/environments/environment';\nimport { v4 as uuid } from 'uuid';\nimport { StripeService, StripeCardComponent } from 'ngx-stripe';\n\nimport { Address } from '../models/address.model';\nimport { Order } from '../models/order.model';\nimport { Store } from '../models/store.model';\nimport {\n  MatSnackBar,\n  MatSnackBarHorizontalPosition,\n  MatSnackBarVerticalPosition,\n} from '@angular/material/snack-bar';\nimport { StoreTheme } from '../models/theme.model';\n\n\n\nexport interface Dict<T> {\n  [key: string]: T;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\n\nexport class LoadService {\n\n  constructor(@Inject(PLATFORM_ID) \n  private platformID: Object,\n  private db: AngularFirestore,\n  private auth: AngularFireAuth,\n  private functions: AngularFireFunctions,\n  private storage: AngularFireStorage,\n  private stripeService: StripeService,\n  private snackBar: MatSnackBar\n  ) { \n  }\n\n  public myCallback: {\n    (): void;\n  } | undefined;\n\n  public orderCallback: {\n    (orderNum: string, intent: string): void;\n  } | undefined;\n\n  public saleCallback: {\n    (): void;\n  } | undefined;\n\n  public miscCallback: {\n    (): void;\n  } | undefined;\n\n  public errCallback: {\n    (message: string): void;\n  } | undefined;\n\n  isShop = false\n  hideCart = false\n  shouldShowCurrency = false\n\n  logView(){\n    if (!(Globals.didLog) && Globals.storeInfo.uid){\n      Globals.didLog = true\n      this.functions.httpsCallable(\"updateView\")({storeUID: Globals.storeInfo.uid!})\n      .pipe(first())\n      .subscribe(async resp => {\n        \n        if (resp as string){\n\n        }\n        else {\n\n        }\n      }, err => {\n        console.error({ err });\n      });\n    }\n  }\n\n  getCountries(){\n\n    let sub = this.db.collection(\"Print_Info\").doc(\"Shipping_Info\").valueChanges().subscribe((docData) => {\n\n        const data = docData as DocumentData\n\n        const usShipping = Math.round(data.shipping_rate_us * 100)\n        const caShipping = Math.round(data.shipping_rate_canada * 100)\n        const intlShipping = Math.round(data.shipping_rate_intl * 100)\n\n        const currencies = data.supportedCurrencies as Array<Dict<any>>\n\n        Globals.availableCurrencies = []\n\n        currencies.forEach((currency) => {\n\n          const name = currency.country\n          const flag = currency.flag\n          const currency_name = currency.name\n          const rate = currency.rate\n          const is_main_currency = currency.is_main_currency\n          const symbol = currency.symbol\n          const name_full = currency.country_full\n\n          const country = new Country(\n            name,\n            flag,\n            name_full,\n            currency_name,\n            symbol,\n            rate,\n            is_main_currency,\n            0\n          )\n\n\n          if (name == \"CA\"){\n            country.shipping_rate_usd = caShipping\n          }\n          else if (name == \"US\"){\n            country.shipping_rate_usd = usShipping\n            Globals.selectedCurrency = country\n          }\n          else{\n            country.shipping_rate_usd = intlShipping\n          }\n\n          if (!Globals.availableCurrencies?.includes(country)){\n            Globals.availableCurrencies.push(country)\n          }\n\n        })\n\n\n        Globals.availableCurrencies.sort(function(a, b){\n          if(a.name < b.name) { return -1; }\n          if(a.name > b.name) { return 1; }\n          return 0;\n        })\n\n        if (isPlatformBrowser(this.platformID)){\n          let cacheCurrency = localStorage.getItem(\"LOCAL_CURRENCY\")\n\n          if (cacheCurrency && cacheCurrency != null && cacheCurrency != \"\"){\n            Globals.selectedCurrency = Globals.availableCurrencies.find(currency => currency.currency_name == cacheCurrency)\n          }\n          else{\n            Globals.selectedCurrency = Globals.availableCurrencies.find(currency => currency.currency_name == \"USD\")\n          }\n        }\n\n        if (this.myCallback)\n          this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n    })\n  }\n\n  getUser(username?: string, uid?: string) {\n\n    var query = this.db.collection(\"Users\", ref => ref.where(\"Username\",'==', username))\n    if (uid){\n      query = this.db.collection(\"Users\", ref => ref.where(firebase.firestore.FieldPath.documentId(),'==', uid))\n    }\n\n\n    let sub = query.valueChanges({idField: 'UID'}).subscribe((doc) => {\n    \n        let docData = doc[0] as DocumentData\n\n        if (docData){\n          let uid = docData.UID //UID OF COMMENT IMAGE\n          let dpUID = docData[\"ProfilePicID\"] as string //UID OF COMMENT IMAGE\n          let username = docData[\"Username\"] as string //COMMENTER'S USERNAME\n          let fullName = docData[\"Full_Name\"] as string\n          let bio = docData[\"Bio\"] as string\n          let notifID = docData[\"Notification ID\"] as string\n          let userFollowing = (docData[\"Following_List\"] as Array<string>) ?? []\n          let usersBlocking = (docData[\"Users_Blocking\"] as Array<string>) ?? []\n          let followerCount = (docData[\"Followers_Count\"] as number) ?? 0\n          let followingCount = (docData[\"Following_Count\"] as number) ?? 0\n          let postCount = (docData[\"Posts_Count\"] as number) ?? 0\n          let verified = docData[\"Verified\"] as boolean ?? false\n          let postNotifs = docData[\"Post_Notifications\"] as Array<string> ?? []\n          let isPublic = docData[\"Public\"] as boolean ?? true\n          let slogan = docData[\"Slogan\"] as string\n          let loading = docData[\"indicator\"] as Dict<any>\n          let style = docData[\"store_style\"] as Dict<any>\n          let font = docData[\"font\"] as string\n          let socials = docData[\"Socials\"] as Array<{ name: string; link: string; }>\n\n\n\n          Globals.storeInfo = new Store(uid, dpUID, username, fullName, bio, notifID, userFollowing, [], followerCount, postCount, followingCount, usersBlocking, this.getProfileURL(uid, dpUID), verified, isPublic, postNotifs, slogan, undefined, this.getDefaultURL(), this.getDefaultURL(), this.getDefaultURL(), undefined, font, socials)\n\n\n          let list = docData[\"image_list\"] as Array<string> ?? []\n\n          list.forEach(type =>{\n            if (type == 'theme'){\n              Globals.storeInfo!.themeLink = new URL(this.getThemeURL(uid))\n            }\n            else if (type == 'home'){\n              Globals.storeInfo!.homeLink = new URL(this.getHomeURL(uid))\n            }\n            else if (type == 'action'){\n              Globals.storeInfo!.actionLink = new URL(this.getActionURL(uid))\n            }\n          })\n\n\n\n\n          if (loading?.name){\n            Globals.storeInfo.loading!.name = loading?.name\n          }\n          if (loading?.color){\n            Globals.storeInfo.loading!.color = this.parseColor(loading.color)\n          }\n          if (loading?.bg_color){\n            Globals.storeInfo.loading!.bg_color = this.parseColor(loading.bg_color)\n          }\n\n          if (style){\n            Globals.storeInfo.colorStyle = new StoreTheme(style?.name, style?.back_code, style?.text_code, this.parseColor(style?.bg_color), this.parseColor(style?.btn_color))\n          }\n        }\n        else{\n          Globals.storeInfo.uid = \"\"\n        }\n\n        if (this.myCallback)\n          this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n          sub.unsubscribe();\n    });\n  }\n\n  parseColor(color?: string){\n\n    var finalArr = new Array<number>()\n\n    color?.split(\",\").forEach( color => {\n      finalArr.push(Number(color.trim()))\n    })\n    return finalArr\n  }\n\n  async getCustomer() {\n\n    Globals.userInfo = new Store()\n\n    let uid = (await this.isLoggedIn())?.uid\n\n\n\n    if (uid){\n      let sub = this.db.collection(\"Users\").doc(uid).valueChanges({idField: 'UID'}).subscribe((doc) => {\n        let docData = doc as DocumentData\n\n        if (docData){\n          let uid = docData.UID //UID OF COMMENT IMAGE\n          let dpUID = docData[\"ProfilePicID\"] as string //UID OF COMMENT IMAGE\n          let username = docData[\"Username\"] as string //COMMENTER'S USERNAME\n          let fullName = docData[\"Full_Name\"] as string\n          let bio = docData[\"Bio\"] as string\n          let notifID = docData[\"Notification ID\"] as string\n          let userFollowing = (docData[\"Following_List\"] as Array<string>) ?? []\n          let usersBlocking = (docData[\"Users_Blocking\"] as Array<string>) ?? []\n          let followerCount = (docData[\"Followers_Count\"] as number) ?? 0\n          let followingCount = (docData[\"Following_Count\"] as number) ?? 0\n          let postCount = (docData[\"Posts_Count\"] as number) ?? 0\n          let verified = docData[\"Verified\"] as boolean ?? false\n          let postNotifs = docData[\"Post_Notifications\"] as Array<string> ?? []\n          let isPublic = docData[\"Public\"] as boolean ?? true\n          let slogan = docData[\"Slogan\"] as string\n          let style = docData[\"store_style\"] as Dict<any>\n          let font = docData[\"font\"] as string\n          let socials = docData[\"Socials\"] as Array<{ name: string; link: string; }>\n\n\n          let loading = docData[\"indicator\"] as Dict<any>\n\n          Globals.userInfo = new Store(uid, dpUID, username, fullName, bio, notifID, userFollowing, [], followerCount, postCount, followingCount, usersBlocking, this.getProfileURL(uid, dpUID), verified, isPublic, postNotifs, slogan, undefined, this.getDefaultURL(), this.getDefaultURL(), this.getDefaultURL(), undefined, font, socials)\n\n\n          let list = docData[\"image_list\"] as Array<string> ?? []\n\n          list.forEach(type =>{\n            if (type == 'theme'){\n              Globals.userInfo!.themeLink = new URL(this.getThemeURL(uid))\n            }\n            else if (type == 'home'){\n              Globals.userInfo!.homeLink = new URL(this.getHomeURL(uid))\n            }\n            else if (type == 'action'){\n              Globals.userInfo!.actionLink = new URL(this.getActionURL(uid))\n            }\n          })\n\n\n\n\n          if (loading?.name){\n            Globals.userInfo.loading!.name = loading?.name\n          }\n          if (loading?.color){\n            Globals.userInfo.loading!.color = this.parseColor(loading.color)\n          }\n          if (loading?.bg_color){\n            Globals.userInfo.loading!.bg_color = this.parseColor(loading.bg_color)\n          }\n\n          if (style){\n            Globals.userInfo.colorStyle = new StoreTheme(style?.name, style?.back_code, style?.text_code, this.parseColor(style?.bg_color), this.parseColor(style?.btn_color))\n          }\n\n          if (this.myCallback)\n          this.myCallback()\n          if (isPlatformBrowser(this.platformID))\n          sub.unsubscribe();\n        }\n      });\n    }\n    else{\n      if (this.myCallback)\n          this.myCallback()\n    }\n  }\n\n  getThemes(){\n\n    Globals.themes = []\n\n\n\n    var query = this.db.collection(\"Store_Themes\", ref => ref.orderBy(\"index\", \"asc\"))\n    \n    let sub = query.valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc) => {\n  \n        let docData = doc as DocumentData\n  \n        if (docData){\n          let name = docData.name as string\n          let btn_color = docData.btn_color as string\n          let bg_color = docData.bg_color as string\n          let back_code = docData.back_code as string\n          let text_code = docData.text_code as string\n\n          let theme = new StoreTheme(\n            name,\n            back_code,\n            text_code,\n            this.parseColor(bg_color),\n            this.parseColor(btn_color)\n          )\n\n          Globals.themes?.push(theme);\n        }\n      });\n      if (this.myCallback)\n          this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n    });\n  }\n  \n  \n  getPosts(filterID?:string){\n\n    Globals.products = []\n\n    const time = firebase.firestore.Timestamp.now()\n\n\n    var query = this.db.collection(\"Users/\" + Globals.storeInfo.uid + \"/Products\", ref => ref.where(\"Timestamp\",'<=', time).where(\"Has_Picture\",'==', true).where(\"Available\",'==', true).where(\"Public\",'==', true).orderBy(\"Timestamp\", \"desc\"))\n\n    if (filterID){\n      query = this.db.collection(\"Users/\" + Globals.storeInfo.uid + \"/Products\", ref => ref.where(\"Timestamp\",'<=', time).where(\"Type\",'==', filterID).where(\"Available\",'==', true).where(\"Public\",'==', true).orderBy(\"Timestamp\", \"desc\"))\n    }\n    \n    let sub = query.valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc) => {\n  \n        let docData = doc as DocumentData\n  \n        if (docData){\n          let uid = docData.UID as string\n          let productID = docData.Product_ID as string\n          let timestamp = (docData.Timestamp as firebase.firestore.Timestamp).toDate()\n          let description = docData.Description as string\n          let name = docData.Name as string\n  \n          let blurred = docData.Blurred as boolean\n          let templateColor = docData.Template_Color as string\n  \n          let likes = docData.Likes as number\n  \n          let priceCents = docData.Price_Cents as number\n          let comments = docData.Comments as number\n          let isPublic = docData.Public as boolean ?? true\n          let productType = docData.Type as string ?? \"ATC1000\"\n          let displaySide = docData.Side as string ?? \"front\"\n          let sides = docData[\"Sides\"] as Array<string> ?? [\"Front\"]\n  \n\n  \n          let product = new Product(\n            uid, \n            productID, \n            description, \n            productID, \n            timestamp, \n            \"\", \n            blurred, \n            priceCents, \n            name, \n            templateColor, \n            likes, \n            false, \n            comments, \n            true, \n            isPublic, \n            productType, \n            displaySide, \n            sides,\n            this.getURL(uid, productID)\n          )\n\n          if (!Globals.products?.includes(product)){\n            Globals.products?.push(product);\n          }\n        }\n      });\n      if (!filterID){\n        \n        Globals.availableTemplates = this.getTemplatesFiltered()\n      }\n      Globals.products?.sort(function(a, b){\n        if(a.timestamp > b.timestamp) { return -1; }\n        if(a.timestamp < b.timestamp) { return 1; }\n        return 0;\n      })\n      if (this.myCallback)\n          this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n    });\n  }\n\n  getBlogs(filterID?:string){\n\n    Globals.blogs = []\n\n    const time = firebase.firestore.Timestamp.now()\n\n\n    var query = this.db.collection(\"Users/\" + Globals.storeInfo.uid + \"/Blogs\", ref => ref.where(\"Timestamp\",'<=', time).where(\"isAvailable\",'==', true).orderBy(\"Timestamp\", \"desc\"))\n    \n    let sub = query.valueChanges({idField : \"Blog_ID\"}).subscribe((docDatas) => {\n      docDatas.forEach((doc) => {\n  \n        let docData = doc as DocumentData\n  \n        if (docData){\n          let uid = docData.UID as string\n          let title = docData.Title as string\n          let timestamp = (docData.Timestamp as firebase.firestore.Timestamp).toDate()\n          let isAvailable = docData.isAvailable as boolean\n          let blogID = docData.Blog_ID as string\n          let blogItems = docData.Blog_Items as Array<Dict<any>>\n          let coverURL = docData.Cover_URL as string\n\n\n          let blog = new Blog(uid, timestamp, \"\", isAvailable, title, blogItems, blogID, coverURL)\n\n          Globals.blogs.push(blog);\n        }\n      });\n      \n      if (this.myCallback)\n          this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n    });\n  }\n\n  hasEmptyProperties(obj: any, ignoreKeys: Array<string>) {\n    for (var key in obj) {\n      if (ignoreKeys.includes(key)){\n        continue\n      }\n      if (obj[key] == null || obj[key] == \"\" || obj[key] == undefined){\n        return true;\n      }\n    }\n    return false;\n  }\n\n  async linkAddress(){\n\n    let uid = (await this.isLoggedIn())?.uid\n\n    \n    let shipping = Globals.shippingInfo\n\n\n    if (uid && shipping && this.hasEmptyProperties(shipping, [\"unit\", \"company\", \"country_code\"])){return}\n\n\n    let email = shipping!.email\n\n    if (((await this.isLoggedIn())?.isAnonymous)){\n      let fData = {\n        email: email,\n      }\n      this.functions.httpsCallable('updateAuth')(fData)\n      .pipe(first())\n      .subscribe(async resp => {\n        \n        if (resp as string){\n          await this.setAddress(uid!)\n          this.auth.signInWithEmailAndPassword(email, resp).then(() => {\n            // Signed in..\n            if (this.myCallback) \n            this.myCallback()\n          }).catch((error) => {\n              var errorCode = error.code;\n              var errorMessage = error.message;\n              // if (this.myCallback) \n              // this.myCallback()\n          });\n        }\n        else {\n          //error\n          if (resp.errorInfo.code == \"auth/email-already-exists\"){\n              console.log(\"This email address is being used by another account.\")\n              //show popup ******\n          }\n        }\n      }, err => {\n        console.error({ err });\n      });\n    }\n    else{\n      await this.setAddress(uid!)\n      if (this.myCallback) \n      this.myCallback()\n    }\n  }\n\n  async setAddress(uid: string){\n    let shipping = Globals.shippingInfo\n\n    let data = {\n      Administrative_Area: shipping?.admin_area,\n      City: shipping?.city,\n      Country: shipping?.country,\n      First_Name: shipping?.name.split(' ').slice(0, -1).join(' '),\n      Last_Name: shipping?.name.split(' ').slice(-1).join(' '),\n      Phone_Num: shipping?.phone_num,\n      Email: shipping?.email,\n      Postal_Code: shipping?.postal,\n      Street: shipping?.street,\n      Company: shipping?.company ?? \"\",\n      Unit_Number: shipping?.unit ?? \"\"\n    }\n\n\n    if (uid){\n      await this.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Delivery_Address\").set(data)\n    }\n  }\n\n  async createPayment(storeID: string, isCard: boolean = true){\n\n    this.functions.httpsCallable('createWebIntent')({merchant_uid: storeID, isCard: isCard})\n      .pipe(first())\n      .subscribe(async resp => {        \n        if (this.orderCallback) \n          this.orderCallback(resp.order_id, resp.client_secret)\n      }, err => {\n        console.error({ err });\n      });\n\n  }\n\n  async linkCard(details: Dict<any>){\n    \n    var billing = Globals.billingInfo\n\n    let uid = (await this.isLoggedIn())?.uid\n\n    if (details.card){\n      if (billing && this.hasEmptyProperties(billing, [\"unit\", \"company\", \"brand\", \"number\"])){\n      \n        console.log(\"k\")\n        return\n      \n      }\n  \n      console.log(\"s\")\n  \n  \n      if (this.isUndefined(billing?.unit)){\n        billing!.unit = undefined\n      }\n  \n      let name = billing?.name\n      let card = details.card as StripeCardComponent\n        \n        var b: Dict<string | undefined> = {\n          line1: billing?.street,\n          city: billing?.city,\n          state: billing?.admin_area,\n          postal_code: billing?.postal,\n          country: billing?.country_code\n        }\n  \n        if (billing?.unit){\n          b.line2 = billing.unit\n        }\n        \n        this.stripeService.createPaymentMethod({\n          type: 'card',\n          card: card!.element,\n          billing_details: {\n            address: b,\n            name: name\n          }\n        })\n        .subscribe((result) => {\n          if (result.paymentMethod) {\n            // Use the token\n  \n  \n            var fData = {\n              token: result.paymentMethod.id,\n              name: billing?.name,\n              line1: billing?.street,\n              line2: billing?.unit ?? null,\n              city: billing?.city,\n              state: billing?.admin_area,\n              zip: billing?.postal,\n              country: billing?.country_code,\n            }\n        \n            if (true){\n              this.functions.httpsCallable('verifyCard')(fData)\n              .pipe(first())\n              .subscribe(async resp => {\n                let data = {\n                  Administrative_Area: billing?.admin_area,\n                  City: billing?.city,\n                  Country: billing?.country,\n                  First_Name: billing?.name.split(' ').slice(0, -1).join(' '),\n                  Last_Name: billing?.name.split(' ').slice(-1).join(' '),\n                  Postal_Code: billing?.postal,\n                  Street: billing?.street,\n                  Company: billing?.company ?? \"\",\n                  Unit_Number: billing?.unit ?? \"\"\n                }\n                if (uid){\n                  await this.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Billing_Address\").set(data)\n                }\n                if (this.myCallback) \n                  this.myCallback()\n              }, err => {\n                console.error({ err });\n              });\n            }\n            else{\n        \n              // if (this.myCallback) \n              //   this.myCallback()\n            }\n  \n          } else if (result.error) {\n            // Error creating the token\n            console.log(result.error.message);\n          }\n        });\n    }\n    else{\n      let data = {\n        Administrative_Area: billing?.admin_area,\n        City: billing?.city,\n        Country: billing?.country,\n        First_Name: billing?.name.split(' ').slice(0, -1).join(' '),\n        Last_Name: billing?.name.split(' ').slice(-1).join(' '),\n        Postal_Code: billing?.postal,\n        Street: billing?.street,\n        Company: billing?.company ?? \"\",\n        Unit_Number: billing?.unit ?? \"\"\n      }\n      if (uid){\n        await this.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Billing_Address\").set(data)\n      }\n      if (this.myCallback) \n        this.myCallback()\n    }\n  }\n\n  getBlog(blogID: string){\n\n    Globals.selectedBlog = new Blog()\n\n    let sub = this.db.collectionGroup(\"Blogs\", ref => ref.where(\"Blog_ID\",'==', blogID)).valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc) => {\n        const docData = doc as DocumentData\n        if (docData){\n          let uid = docData.UID as string\n          let title = docData.Title as string\n          let timestamp = (docData.Timestamp as firebase.firestore.Timestamp).toDate()\n          let isAvailable = docData.isAvailable as boolean\n          let blogID = docData.Blog_ID as string\n          let blogItems = docData.Blog_Items as Array<Dict<any>>\n          let coverURL = docData.Cover_URL as string\n\n\n          let blog = new Blog(uid, timestamp, \"\", isAvailable, title, blogItems, blogID, coverURL)\n\n          Globals.selectedBlog = blog;\n        }\n      })\n      if (this.myCallback) \n      this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n\n\n  async getBillingInfo(){\n      let uid = (await this.isLoggedIn())?.uid\n      let sub = this.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Identifiers\").valueChanges().subscribe((doc) => {\n        let docData = doc as DocumentData\n\n        if (docData){\n          let card_type = docData.card_type as string\n          let card_last_4 = docData.card_last_4 as string\n\n          if (Globals.billingInfo){\n            Globals.billingInfo!.brand = card_type\n            Globals.billingInfo!.number = card_last_4\n          }\n          else{\n            Globals.billingInfo = new BillingInfo(undefined, undefined, card_last_4, card_type)\n          }\n        }\n        else{\n          Globals.billingInfo = new BillingInfo()\n        }\n  \n        if (this.myCallback) \n        this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n      })\n  }\n  async getShippingAddress(oUID?: string){\n\n    var uid = oUID\n    if (!uid){\n      uid = (await this.isLoggedIn())?.uid\n    }\n\n    let sub = this.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Delivery_Address\").valueChanges().subscribe((doc) => {\n      Globals.shippingInfo = undefined\n\n      let docData = doc as DocumentData\n\n      if (docData){\n        let area = docData.Administrative_Area as string\n        let city = docData.City as string\n        let country = docData.Country as string\n        let firstName = docData.First_Name as string\n        let lastName = docData.Last_Name as string\n        let name = firstName + \" \" + lastName\n        let phone = docData.Phone_Num as string\n        let postal_code = docData.Postal_Code as string\n        let street = docData.Street as string\n        var company: string | undefined = (docData.Company as string) ?? \"\"\n        var email: string | undefined = (docData.Email as string) ?? \"\"\n        if (company == \"\") company = undefined\n        if (email == \"\") email = undefined\n        var unit: string | undefined = (docData.Unit_Number as string) ?? \"\"\n        if (unit == \"\") unit = undefined\n\n        Globals.shippingInfo = new ShippingInfo(name, company, street, city, country, area, unit, postal_code, phone, undefined, email)\n      }\n      else{\n        Globals.shippingInfo = new ShippingInfo()\n      }\n\n      if (this.myCallback) \n      this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n  async getBillingAddress(){\n\n    let uid = (await this.isLoggedIn())?.uid\n\n\n    let sub = this.db.collection(\"Users/\" + uid + \"/Payment_Info\").doc(\"Billing_Address\").valueChanges().subscribe((doc) => {\n      // Globals.selectedBlog = undefined\n\n      let docData = doc as DocumentData\n\n      \n      if (docData){\n        let area = docData.Administrative_Area as string\n        let city = docData.City as string\n        let country = docData.Country as string\n        let firstName = docData.First_Name as string\n        let lastName = docData.Last_Name as string\n        let name = firstName + \" \" + lastName\n        let postal_code = docData.Postal_Code as string\n        let street = docData.Street as string\n        var company: string | undefined = (docData.Company as string) ?? \"\"\n        if (company == \"\") company = undefined\n        var unit: string | undefined = (docData.Unit_Number as string) ?? \"\"\n        if (unit == \"\") unit = undefined\n\n        if (Globals.billingInfo){\n          Globals.billingInfo!.admin_area = area\n          Globals.billingInfo!.city = city\n          Globals.billingInfo!.country = country\n          Globals.billingInfo!.name = name\n          Globals.billingInfo!.postal = postal_code\n          Globals.billingInfo!.street = street\n          Globals.billingInfo!.company = company ?? \"\"\n        }\n        else{\n          Globals.billingInfo = new BillingInfo(name, company, undefined, undefined, street, city, country, area, unit, postal_code, undefined)\n        }\n\n      }\n      else{\n        Globals.billingInfo = new BillingInfo()\n      }\n      if (this.myCallback) \n      this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n  isUndefined(element: any){\n    return element == undefined || element == null || element == \"\"\n  }\n\n  async getTax(taxData: BillingInfo){\n\n    // let uid = (await this.isLoggedIn())?.uid\n\n    const country = taxData.country\n    const admin = taxData.admin_area\n    const street = taxData.street\n    const postal = taxData.postal\n\n\n    var salesTax = 0.0\n\n\n    if (country === \"Canada\" || country === \"CA\"){\n\n      let sub = this.db.collection(\"Canada_Tax_Docs\").doc(admin).valueChanges().subscribe((doc) => {\n        // Globals.selectedBlog = undefined\n  \n        let taxDoc = doc as DocumentData\n  \n        if (taxDoc){\n          if (!this.isUndefined(taxDoc.HST)){\n            salesTax += taxDoc.HST\n          }\n          else{\n            if (!this.isUndefined(taxDoc.GST)){\n                salesTax += taxDoc.GST\n            }\n            if (!this.isUndefined(taxDoc.PST)){\n                salesTax += taxDoc.PST\n            }\n          }\n        }\n        Globals.shippingTax = salesTax\n        if (this.myCallback) \n        this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n      });\n    }\n    else if (country === \"United States\" || country === \"US\" || country === \"USA\"){\n      Globals.shippingTax = salesTax\n      if (this.myCallback) \n      this.myCallback()\n    }\n    else if (country === \"United Kingdom\" || country === \"UK\" || country === \"GB\"){\n      let sub = this.db.collection(\"Canada_Tax_Docs\").doc(admin).valueChanges().subscribe((doc) => {\n        // Globals.selectedBlog = undefined\n  \n        let taxDoc = doc as DocumentData\n  \n        if (taxDoc){\n          if (!this.isUndefined(taxDoc.HST)){\n            salesTax += taxDoc.VAT\n          }\n        }\n        Globals.shippingTax = salesTax\n        if (this.myCallback) \n        this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n      });\n    }\n  }\n\n  async addToCart(mappedData: Dict<any>){\n\n    \n    let uid = (await this.isLoggedIn())?.uid\n\n\n\n    const storeUID = Globals.storeInfo.uid\n\n    if (!(storeUID)){\n      return\n    }\n\n    let data = {\n      \"Cart_List\" : firebase.firestore.FieldValue.arrayUnion(mappedData),\n      \"UID\" : storeUID,\n      \"Timestamp\" : mappedData.Timestamp\n    }\n\n    if (uid){\n      await this.db.collection(\"Users/\" + uid + \"/Cart_Info\").doc(\"Cart_List_\" + storeUID).set(data, {merge : true})\n    }\n  }\n\n  async saveUser(mappedData: Dict<any>){\n\n    \n    let uid = (await this.isLoggedIn())?.uid\n\n    if (mappedData.profile_pic){\n      let picID = await this.uploadFile(mappedData, uid)\n      mappedData.picID = picID\n    }\n    \n    await this.saveUsername(mappedData, uid)\n  }\n  \n  \n  async updateProduct(mappedData: Dict<any>){\n    let uid = (await this.isLoggedIn())?.uid ?? \"\"\n    let productID = mappedData.productID\n    let data = {\n      \"Name\" : mappedData.name ?? \"Post\",\n      \"Search_Name\" : mappedData.name.toLowerCase() ?? \"post\",\n      \"Description\" : mappedData.description ?? \"\",\n      \"Price_Cents\" : mappedData.price ?? 2000,\n      \"Available\" : mappedData.available ?? true,\n    }\n    await this.db.collection(\"Users/\" + uid + \"/Products\").doc(productID).update(data)\n\n    let product = Globals.products?.filter(obj => {\n      return obj.productID == productID\n    })[0] as Product\n\n    product.name = data.Name\n    product.description = data.Description\n    product.price = data.Price_Cents\n\n    return console.log(\"Updated Product\")\n  }\n\n  async createProduct(mappedData: Dict<any>){\n\n    \n    let uid = (await this.isLoggedIn())?.uid ?? \"\"\n\n    let productID = this.db.collection(\"Users/\" + uid + \"/Products\").doc().ref.id\n\n    let data = await this.saveProductInfo(mappedData, productID, uid) ?? {}\n\n    if (mappedData.images?.length > 0){\n      await mappedData.images.forEach(async (image: Dict<string>) => {\n        let url = await this.uploadProductImages(image.img, image.type, productID, uid)\n        console.log(url)\n      });\n      let url = mappedData.images.filter((obj: Dict<string>) => {\n        return obj.type == \"link_\"\n      })[0].img as string\n      let product = new Product(\n        uid, \n        productID, \n        data.Description, \n        productID, \n        data.Timestamp, \n        undefined, \n        data.Blurred, \n        data.Price_Cents, \n        data.Name, \n        data.Template_Color, \n        data.Likes, \n        false, \n        data.Comments, \n        data.Available, \n        data.Public, \n        data.Type, \n        data.Side,\n        data.sides,\n        url\n      )\n      Globals.products?.unshift(product)\n    }\n  }\n\n  async saveStore(mappedData: Dict<any>){\n\n    \n    let uid = (await this.isLoggedIn())?.uid\n\n    if (mappedData.images?.length > 0){\n      mappedData.image_list = new Array<string>()\n      await mappedData.images.forEach(async (image: Dict<string>) => {\n        mappedData.image_list.push(image.type)\n        let url = await this.uploadStoreImages(image.img, image.type, uid)\n      });\n\n    }\n    \n    await this.saveStoreInfo(mappedData, uid)\n  }\n\n  private async uploadProductImages(image: string, type: string, productID: string, uid?: string) {\n      const filePath = 'Users/' + uid + '/Products/' + productID + \"/\" + type + productID + '.png';\n      let ref = this.storage.ref(filePath);\n      const byteArray = new Buffer(image.replace(/^[\\w\\d;:\\/]+base64\\,/g, ''), 'base64');\n  \n      // const task = await this.storage.upload(filePath, byteArray);\n      const task = await ref.put(byteArray);\n      const url = await task.ref.getDownloadURL();\n\n      // if (type == \"theme\"){\n      //   Globals.userInfo!.themeLink = url\n    \n      //   if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //     Globals.storeInfo!.themeLink = url\n      //   }\n      // }\n      // else if (type == \"home\"){\n      //   Globals.userInfo!.homeLink = url\n    \n      //   if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //     Globals.storeInfo!.homeLink = url\n      //   }\n      // }\n      // else if (type == \"action\"){\n\n      //   Globals.userInfo!.actionLink = url\n    \n      //   if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //     Globals.storeInfo!.actionLink = url\n      //   }\n      // }\n      return url;\n    return undefined\n  }\n\n  private async uploadStoreImages(image: string, type?: string, uid?: string) {\n    if (type){\n      const filePath = 'Users/' + uid + '/Store_Images/' + type + '.png';\n      let ref = this.storage.ref(filePath);\n      const byteArray = new Buffer(image.replace(/^[\\w\\d;:\\/]+base64\\,/g, ''), 'base64');\n  \n  \n      // const task = await this.storage.upload(filePath, byteArray);\n      const task = await ref.put(byteArray);\n      const url = await task.ref.getDownloadURL();\n\n      if (type == \"theme\"){\n        Globals.userInfo!.themeLink = url\n    \n        if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n          Globals.storeInfo!.themeLink = url\n        }\n      }\n      else if (type == \"home\"){\n        Globals.userInfo!.homeLink = url\n    \n        if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n          Globals.storeInfo!.homeLink = url\n        }\n      }\n      else if (type == \"action\"){\n\n        Globals.userInfo!.actionLink = url\n    \n        if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n          Globals.storeInfo!.actionLink = url\n        }\n      }\n      return url;\n    }\n    return undefined\n  }\n\n  async saveProductInfo(mappedData: Dict<any>, productID: string, uid?: string){\n\n\n    let data = {\n      \"Name\" : mappedData.name ?? \"Post\",\n      \"Search_Name\" : mappedData.name.toLowerCase() ?? \"post\",\n      \"Description\" : mappedData.description ?? \"\",\n      \"Price_Cents\" : mappedData.price ?? 2000,\n      \"UID\" : uid,\n      \"Blurred\" : false,\n      \"Timestamp\" : new Date(),\n      \"Template_Color\" : mappedData.templateColor ?? \"black\",\n      \"Likes\" : 0,\n      \"Comments\" : 0,\n      \"Has_Picture\" : false,\n      \"Product_ID\" : productID,\n      \"Available\" : true,\n      \"Public\" : true,\n      \"Type\" : mappedData.productType ?? \"ATC1000\",\n      \"Side\" : mappedData.displaySide ?? \"front\",\n      \"Sides\" : mappedData.sides\n     } as Dict<any>\n\n    if (uid){\n      \n      await this.db.collection(\"Users/\" + uid + \"/Products\").doc(productID).set(data)\n\n      return data\n      \n      // Globals.userInfo!.slogan = mappedData.slogan\n      // let matchingTheme = Globals.themes?.filter(theme => theme.name == mappedData.theme.name)[0]\n\n      // if (matchingTheme){\n      //   Globals.userInfo!.colorStyle = matchingTheme\n      // }\n      // Globals.userInfo!.slogan = mappedData.slogan\n      // Globals.userInfo!.fontName = mappedData.font\n\n      // if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      //   if (matchingTheme){\n      //     Globals.storeInfo!.colorStyle = matchingTheme\n      //     Globals.storeInfo!.fontName = mappedData.font\n      //   }\n      // }\n    }\n    return undefined\n  }\n\n  async saveStoreInfo(mappedData: Dict<any>, uid?: string){\n\n\n    var data: Dict<any> = {\n      \"Slogan\" : mappedData.slogan ?? \"\",\n    }\n\n    if (mappedData.indicator){\n      data[\"indicator\"] = mappedData.indicator\n    }\n\n    if (mappedData.theme){\n      data[\"store_style\"] = mappedData.theme\n    }\n\n    if (mappedData.font){\n      data[\"font\"] = mappedData.font\n    }\n\n    if (mappedData.image_list){\n      data[\"image_list\"] = firebase.firestore.FieldValue.arrayUnion(...mappedData.image_list)\n    }\n\n    if (uid){\n      await this.db.collection(\"Users\").doc(uid).update(data)\n      Globals.userInfo!.slogan = mappedData.slogan\n      let matchingTheme = Globals.themes?.filter(theme => theme.name == mappedData.theme.name)[0]\n\n      if (matchingTheme){\n        Globals.userInfo!.colorStyle = matchingTheme\n      }\n      Globals.userInfo!.slogan = mappedData.slogan\n      Globals.userInfo!.fontName = mappedData.font\n\n      if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n        if (matchingTheme){\n          Globals.storeInfo!.colorStyle = matchingTheme\n          Globals.storeInfo!.fontName = mappedData.font\n        }\n      }\n    }\n    if (this.myCallback)\n      this.myCallback()\n  }\n\n  private async uploadFile(mappedData: Dict<any>, uid?: string) {\n    let picID = uuid().toString().replace(\"-\", \"\")\n    const filePath = 'Users/' + uid + '/profile_pic-' + picID + '.jpeg';\n    let ref = this.storage.ref(filePath);\n    const byteArray = new Buffer(mappedData.profile_pic.replace(/^[\\w\\d;:\\/]+base64\\,/g, ''), 'base64');\n\n\n    // const task = await this.storage.upload(filePath, byteArray);\n    const task = await ref.put(byteArray);\n    const url = await task.ref.getDownloadURL();\n    Globals.userInfo!.dpID = picID\n    Globals.userInfo!.profileLink = url\n\n    if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n      Globals.storeInfo!.dpID = picID\n      Globals.storeInfo!.profileLink = url\n    }\n\n    return picID;\n  }\n\n  async saveUsername(mappedData: Dict<any>, uid?: string){\n\n\n    var data: Dict<string> = {\n      \"Username\" : mappedData.username,\n      \"Full_Name\" : mappedData.full_name,\n      \"Bio\" : mappedData.bio,\n    }\n\n    if (mappedData.picID){\n      data[\"ProfilePicID\"] = mappedData.picID\n    }\n    if (mappedData.socials){\n      data[\"Socials\"] = mappedData.socials ?? []\n    }\n\n    if (uid){\n      await this.db.collection(\"Users\").doc(uid).update(data)\n      Globals.userInfo!.username = mappedData.username\n      Globals.userInfo!.fullName = mappedData.full_name\n\n      \n      if (Globals.storeInfo.uid == Globals.userInfo?.uid){\n        Globals.storeInfo!.username = mappedData.username\n        Globals.storeInfo!.fullName = mappedData.full_name\n      }\n    }\n    if (this.myCallback)\n      this.myCallback()\n  }\n\n\n  openSnackBar(\n    message: string,\n    timeDuration = 1000,\n    horizontal: MatSnackBarHorizontalPosition = 'right',\n    vertical: MatSnackBarVerticalPosition = 'top'\n  ) {\n    this.snackBar.open(message, '', {\n      duration: timeDuration,\n      horizontalPosition: horizontal,\n      verticalPosition: vertical,\n    });\n  }\n\n  async changeCart(mappedData: Array<Dict<any>>){\n\n    let uid = (await this.isLoggedIn())?.uid\n\n\n    let data = {\n      \"Cart_List\" : mappedData\n    }\n\n    const storeUID = Globals.storeInfo.uid\n\n    if (!(storeUID)){\n      return\n    }\n\n    if (uid){\n      await this.db.collection(\"Users/\" + uid + \"/Cart_Info\").doc(\"Cart_List_\" + storeUID).set(data)\n    }\n  }\n\n  async signOut(){\n\n    await this.auth.signOut().then(() =>{\n      Globals.userInfo = undefined\n      if (this.myCallback)\n      this.myCallback()\n    }).catch((error) => {\n      var errorCode = error.code;\n      var errorMessage = error.message;\n\n      if (this.errCallback)\n      this.errCallback(errorMessage)\n    });\n    // Sign Out\n  }\n\n  isLoggedIn() {\n    return this.auth.authState.pipe(first()).toPromise();\n  }\n\n  registerAccount(type: string, credentials?: Dict<string>){\n\n    if (type == \"Guest\"){\n      this.auth.signInAnonymously().then(() => {\n        // Signed in..\n    \n        if (this.myCallback)\n          this.myCallback()\n\n        }).catch((error) => {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n\n          if (this.errCallback)\n          this.errCallback(errorMessage)\n        });\n    }\n\n    else if(type == \"Email_UP\"){\n\n      let username = credentials?.username\n      let password = credentials?.password!\n      let email = credentials?.email!\n\n      this.auth.createUserWithEmailAndPassword(email, password).then(async (result) => {\n        // Signed in..\n        await result.user?.sendEmailVerification()\n        if (result.user && username){\n          await this.setUsername(result.user?.uid, username, true)\n          if (this.myCallback)\n          this.myCallback()\n        }\n        else{\n          await this.auth.signOut()\n          if (this.myCallback)\n          this.myCallback()\n        }\n        }).catch((error) => {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n\n          if (this.errCallback)\n          this.errCallback(errorMessage)\n\n          console.log(errorCode)\n          \n      });  \n    }\n    else if(type == \"Email_IN\"){\n      let password = credentials?.password!\n      let email = credentials?.email!\n\n      this.auth.signInWithEmailAndPassword(email, password).then(async (result) => {\n        // Signed in..\n        if (result.user){\n          if (this.myCallback)\n          this.myCallback()\n        }\n        else{\n          await this.auth.signOut()\n          if (this.myCallback)\n          this.myCallback()\n        }\n        }).catch((error) => {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n\n          if (this.errCallback)\n          this.errCallback(errorMessage)\n\n          console.log(errorCode)\n      }); \n    }\n    else if(type == \"Email_IN_USER\"){\n\n      let data = {\n        \"Field\" : credentials?.Field,\n        \"Term\" : credentials?.Term\n      }\n      this.functions.httpsCallable('auth')(data)\n      .pipe(first())\n      .subscribe(async resp => {\n        \n        if (resp as string){\n          if (resp.includes(\"ERROR:\")){\n            let err = resp.replace(\"ERROR:\", \"\")\n            console.log(err)\n          }\n          else{\n\n            let email = resp as string\n            let password = credentials?.password!\n\n            this.auth.signInWithEmailAndPassword(email, password).then(async (result) => {\n              // Signed in..\n              if (result.user){\n                if (this.myCallback)\n                this.myCallback()\n              }\n              else{\n                await this.auth.signOut()\n                if (this.myCallback)\n                this.myCallback()\n              }\n              }).catch((error) => {\n                var errorCode = error.code;\n                var errorMessage = error.message;\n      \n                if (this.errCallback)\n                this.errCallback(errorMessage)\n      \n                console.log(errorCode)\n            }); \n          }\n        }\n        else {\n\n        }\n      }, err => {\n        var errorCode = err.code;\n        var errorMessage = err.message;\n        if (this.errCallback)\n          this.errCallback(errorMessage)\n        console.log(errorCode)\n      });\n    }\n    else if (type == \"Apple\"){\n      var appleProvider = new firebase.auth.OAuthProvider('apple.com');\n      appleProvider.addScope('email');\n      appleProvider.addScope('name');\n\n      this.auth.signInWithPopup(appleProvider).then(async (result) => {\n        // Signed in..\n    \n        if ((result.additionalUserInfo?.isNewUser ?? false) && result.user?.uid){\n          await result.user?.sendEmailVerification()\n          await this.setUsername(result.user?.uid, result?.additionalUserInfo?.username ?? 'user_' + uuid.toString(), (!(this.isUndefined(result?.additionalUserInfo?.username))))\n        }\n        if (this.myCallback)\n          this.myCallback()\n\n        }).catch((error) => {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n\n          if (this.errCallback)\n          this.errCallback(errorMessage)\n        });\n    }\n    else if (type == \"Google\"){\n      var googleProvider = new firebase.auth.GoogleAuthProvider();\n      googleProvider.addScope('email');\n      googleProvider.addScope('profile');\n\n      this.auth.signInWithPopup(googleProvider).then(async (result) => {\n        // Signed in..\n        if ((result.additionalUserInfo?.isNewUser ?? false) && result.user?.uid){\n          // await result.user?.sendEmailVerification()\n          await this.setUsername(result.user?.uid, result?.additionalUserInfo?.username ?? 'user_' + uuid().replace('-', ''), (!(this.isUndefined(result?.additionalUserInfo?.username))))\n        }\n        if (this.myCallback)\n          this.myCallback()\n\n        }).catch((error) => {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n\n          console.log(error)\n          if (this.errCallback)\n          this.errCallback(errorMessage)\n        });\n    }\n  }\n\n\n  async setUsername(uid: string, username: string, hasUsername?: boolean){\n    \n    var data = {\n      'Full_Name' : \"GUEST\",\n      'Username': username,\n      'Bio' : '',\n      'ProfilePicID' : null,\n      'notification_tokens' : [],\n      'Following_List' : [],\n      'Following_Count' : 0,\n      'Followers_Count' : 0,\n      'Posts_Count' : 0,\n      'Platform' : \"WEB\"\n    }\n\n    if (hasUsername ?? false){\n      data.Full_Name = username.toUpperCase()\n    }\n\n    await this.db.collection(\"Users\").doc(uid).set(data, {merge : true})\n    return true\n  }\n\n\n\n  async authenticated(){\n    const user = await this.isLoggedIn()\n    if (user) {\n      return true\n    } else {\n      return false\n   }\n  }\n\n  async getCart(){\n\n    const uid = (await this.isLoggedIn())?.uid\n    const storeUID = Globals.storeInfo.uid\n\n    Globals.cart = []\n\n    if (!(storeUID) || !(uid)){\n      if (this.myCallback)\n      this.myCallback()\n      return\n    }\n\n\n    let sub = this.db.collection(\"Users/\" + uid + \"/Cart_Info\").doc(\"Cart_List_\" + storeUID).valueChanges().subscribe((doc) => {\n      const docData = doc as DocumentData\n\n      if (docData){\n\n        let cartList = docData.Cart_List as Array<Dict<any>>\n\n        cartList.forEach((productInCart, i) => {\n\n          let uid = productInCart.UID as string\n          let size = productInCart.Size as string\n          let qty = productInCart.Qty as number\n          let timestamp = (productInCart.Timestamp as firebase.firestore.Timestamp).toDate()\n          let productID = productInCart.Post_ID as string\n\n          let product = new Product(\n            uid, \n            productID, \n            undefined, \n            productID, \n            timestamp, \n            undefined, \n            undefined, \n            undefined, \n            undefined, \n            undefined, \n            undefined, \n            false, \n            undefined, \n            true, \n            undefined, \n            undefined, \n            undefined, \n            [],\n            this.getURL(uid, productID)\n          )\n\n          let productCart = new ProductInCart(product, size, qty, false, timestamp, \"\", undefined)\n          Globals.cart?.push(productCart)\n          this.getPost(productID, true, i)\n        })\n      }\n      if (this.myCallback)\n      this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n  async getOrder(orderID: string){\n    \n\n    let sub = this.db.collectionGroup(\"Orders\", ref => ref.where(\"order_id\",'==', orderID)).valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc) => {\n        const docData = doc as DocumentData\n        if (docData){\n          let status = docData.status as string ?? \"cancelled\"\n          let intents = docData.order_intents as Array<Dict<string>>\n          \n          let timestamp = (docData.timestamp as firebase.firestore.Timestamp).toDate()\n          let shippingIntent = docData.shipping_intent as string\n          let trackingNumber = docData.tracking_id as string\n          let shippingCost = (docData.shipping_cost as number ?? 0) / 100\n          let taxPercent = docData.tax as number\n          let taxNum = docData.sales_tax as number\n  \n          let currency = docData.currency as string ?? \"CAD\"\n\n          let currencySymbol = docData.currency_symbol as string\n          let orderID = docData.order_id as string\n          let merchantID = docData.merchant_uid as string\n\n          var subtotal = 0.0\n\n\n          let address = docData.delivery_address as Dict<string>\n          let street = address.street_address as string\n          let city = address.city as string\n          let country = address.country as string\n          let postalCode = address.postal_code as string\n          let area = address.admin_area as string\n          let phone = address.phone_number as string\n          let name = address.full_name as string\n          let company = address.company as string\n          let email = address.email as string\n          let country_code = address.country_code as string\n          const uid = docData.uid as string\n\n                    // let shippingCost = (doc[\"shipping_cost\"] as? Double ?? 0.00) / 100              \n                \n                    \n          let unitNum = address.unit_number as string\n                    \n          let orderAddress = new ShippingInfo(name, company, street, city, country, area, unitNum, postalCode, phone, country_code, email)\n                    \n          let tax = taxNum ?? (taxPercent ?? 0) * subtotal\n          let totalCost = (tax ?? 0.0) + (subtotal ?? 0.0) + (shippingCost ?? 0.0)\n\n\n          let order = new Order(orderID, timestamp, [], status, intents, totalCost, tax, subtotal, orderAddress, currency, currencySymbol, trackingNumber, shippingIntent, shippingCost, uid, merchantID)\n\n\n          Globals.selectedOrder = order\n\n\n          this.getOrderProducts(order, uid, 0, true)\n        }\n        else{\n          \n          Globals.selectedOrder = new Order()\n        }\n      })\n      if (this.myCallback) \n          this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n  async getOrders(){\n    \n    const uid = (await this.isLoggedIn())?.uid\n    const storeUID = Globals.storeInfo.uid\n\n    if (!(storeUID) || !(uid)){\n      if (this.myCallback)\n      this.myCallback()\n      return\n    }\n\n    var query = this.db.collection(\"Users/\" + uid + \"/Orders\", ref => ref.where(\"merchant_uid\",'==', storeUID).orderBy(\"timestamp\", \"desc\"))\n\n    Globals.orders = []\n    \n    let sub = query.valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc, index) => {\n        const docData = doc as DocumentData\n        if (docData){\n          let status = docData.status as string ?? \"cancelled\"\n          let intents = docData.order_intents as Array<Dict<string>>\n          \n          let timestamp = (docData.timestamp as firebase.firestore.Timestamp).toDate()\n          let shippingIntent = docData.shipping_intent as string\n          let trackingNumber = docData.tracking_id as string\n          let shippingCost = docData.shipping_cost as number\n          let taxPercent = docData.tax as number\n          let taxNum = docData.sales_tax as number\n  \n          let currency = docData.currency as string ?? \"CAD\"\n\n          let currencySymbol = docData.currency_symbol as string\n          let orderID = docData.order_id as string\n          let merchantID = docData.merchant_uid as string\n\n          var subtotal = 0.0\n\n\n          let address = docData.delivery_address as Dict<string>\n          let street = address.street_address as string\n          let city = address.city as string\n          let country = address.country as string\n          let postalCode = address.postal_code as string\n          let area = address.admin_area as string\n          let phone = address.phone_number as string\n          let name = address.full_name as string\n          let company = address.company as string\n          let email = address.email as string\n          let country_code = address.country_code as string\n          const uid = docData.uid as string\n\n\n                    // let shippingCost = (doc[\"shipping_cost\"] as? Double ?? 0.00) / 100              \n                \n                    \n          let unitNum = address.unit_number as string\n                    \n          let orderAddress = new ShippingInfo(name, company, street, city, country, area, unitNum, postalCode, phone, country_code, email)\n                    \n\n          let tax = taxNum ?? (taxPercent ?? 0) * subtotal\n          let totalCost = (tax ?? 0.0) + (subtotal ?? 0.0) + (shippingCost ?? 0.0)\n\n          let order = new Order(orderID, timestamp, [], status, intents, totalCost, tax, subtotal, orderAddress, currency, currencySymbol, trackingNumber, shippingIntent, shippingCost, uid, merchantID)\n\n\n          Globals.orders?.push(order)\n\n\n          this.getOrderProducts(order, uid, index)\n    \n        }\n      })\n      if (this.myCallback) \n          this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n  getOrderProducts(order: Order, uid: string, orderIndex: number, isSelectedOrder?: boolean){\n    let sub = this.db.collection(\"Users/\" + uid + \"/Orders/\" + order.orderID + \"/Purchases\").valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc, index) => {\n        const docData = doc as DocumentData\n        if (docData){\n\n          let productID = docData.productID as string\n          let quantity = docData.quantity as number\n          let size = docData.size as string\n          let status = docData.status as string\n          let price = (docData.amount as number) / quantity\n          let timestamp = (docData.timestamp as firebase.firestore.Timestamp).toDate()\n\n          let product = new Product(\n            uid, \n            productID, \n            undefined, \n            productID, \n            timestamp, \n            undefined, \n            undefined, \n            price, \n            undefined, \n            undefined, \n            undefined, \n            false, \n            undefined, \n            true, \n            undefined, \n            undefined, \n            undefined, \n            [],\n            this.getURL(uid, productID)\n          )\n\n          \n          let orderProduct = new ProductInCart(product, size, quantity, false, timestamp, undefined, undefined)\n\n          order.products.push(orderProduct)\n\n          if (isSelectedOrder ?? false){\n            this.getPost(productID, undefined, undefined, undefined, orderIndex, index, true)\n          }\n          else{\n            this.getPost(productID, undefined, undefined, true, orderIndex, index, false)\n          }\n        }\n      })\n      if (this.myCallback) \n          this.myCallback()\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n    });\n  }\n\n  getMiscStats(uid: string){\n\n    Globals.views = []\n    Globals.dropCarts = []\n    let sub = this.db.collection(\"Users/\" + uid + \"/Daily_Info/\").valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc, index) => {\n        const docData = doc as DocumentData\n        if (docData){\n          let time = docData.time as Array<Date>\n          let timestamp = (docData.timestamp as firebase.firestore.Timestamp).toDate()\n          let length = time.length\n          Globals.views?.push({views: length, timestamp: timestamp})\n        }\n      })\n      if (isPlatformBrowser(this.platformID))\n      sub.unsubscribe();\n\n      let sub2 = this.db.collectionGroup(\"Cart_Info\", ref => ref.where(\"UID\", \"==\", uid)).valueChanges().subscribe((docDatas) => {\n        \n        docDatas.forEach((doc, index) => {\n          const docData = doc as DocumentData\n          if (docData){\n            let timestamp = (docData.Timestamp as firebase.firestore.Timestamp)?.toDate()\n            Globals.dropCarts?.push({dropCarts: 1, timestamp: timestamp})\n          }\n        })\n        if (isPlatformBrowser(this.platformID))\n        sub2.unsubscribe();\n        if (this.miscCallback) \n            this.miscCallback()\n      });\n    });\n  }\n\n  getSoldProducts(uid: string = \"\"){\n    \n    Globals.productsSold = []\n\n    let sub = this.db.collectionGroup(\"Purchases\", ref => ref.where(\"merchant_uid\",'==', uid).where(\"status\",'==', 'confirmed')).valueChanges().subscribe((docDatas) => {\n      docDatas.forEach((doc, index) => {\n        const docData = doc as DocumentData\n        if (docData){\n          let productID = docData.productID as string\n          let quantity = docData.quantity as number\n          let size = docData.size as string\n          let price = (docData.amount as number) / quantity\n          let profit = docData.moneyToMerchant as number / 100\n          let timestamp = (docData.timestamp as firebase.firestore.Timestamp)?.toDate()\n\n          let product = new Product(\n            uid, \n            productID, \n            undefined, \n            productID, \n            timestamp, \n            undefined, \n            undefined, \n            price / 100, \n            undefined, \n            undefined, \n            undefined, \n            false, \n            undefined, \n            true, \n            undefined, \n            undefined, \n            undefined, \n            [],\n            this.getURL(uid, productID)\n          )\n\n          \n          let orderProduct = new ProductInCart(product, size, quantity, false, timestamp, undefined, undefined, profit ?? 0)\n\n          Globals.productsSold?.push(orderProduct)\n          this.getPost(productID, undefined, undefined, false, undefined, index, false, true)\n        }\n      })\n      if (this.saleCallback) \n              this.saleCallback()\n            if (isPlatformBrowser(this.platformID))\n              sub.unsubscribe();\n    });\n  }\n\n  getPost(productID: string, forCart?: boolean, cartIndex?: number, forOrder?: boolean, orderIndex?: number, productIndex?: number, isSelectedOrder?: boolean, forSale?: boolean){\n    \n    let sub = this.db.collectionGroup(\"Products\", ref => ref.where(\"Product_ID\",'==', productID).where(\"Public\",'==', true)).valueChanges().subscribe((docDatas) => {\n\n      if (docDatas.length == 0){\n        if (this.myCallback) \n          this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n          sub.unsubscribe();\n      }\n\n      docDatas.forEach((doc) => {\n        const docData = doc as DocumentData\n        if (docData){\n          let uid = docData.UID as string\n          let productID = docData.Product_ID as string\n          let timestamp = (docData.Timestamp as firebase.firestore.Timestamp).toDate()\n          let description = docData.Description as string\n          let name = docData.Name as string\n  \n          let blurred = docData.Blurred as boolean\n          let templateColor = docData.Template_Color as string\n  \n          let likes = docData.Likes as number\n  \n          let comments = docData.Comments as number\n          let isPublic = docData.Public as boolean ?? true\n          let productType = docData.Type as string ?? \"ATC1000\"\n          let displaySide = docData.Side as string ?? \"front\"\n          let sides = docData[\"Sides\"] as Array<string> ?? [\"Front\"]\n          let priceCents = docData.Price_Cents as number\n\n          let product = new Product(\n            uid, \n            productID, \n            description, \n            productID, \n            timestamp, \n            \"\", \n            blurred, \n            priceCents,\n            name, \n            templateColor, \n            likes, \n            false, \n            comments, \n            true, \n            isPublic, \n            productType, \n            displaySide, \n            sides,\n            this.getURL(uid, productID)\n          )\n\n          if ((forCart ?? false)){\n            Globals.cart![cartIndex!].product = product\n            if (this.myCallback) \n              this.myCallback()\n            if (isPlatformBrowser(this.platformID))\n              sub.unsubscribe();\n          }\n          else if ((forOrder ?? false)){\n            product.price = Globals.orders![orderIndex!].products[productIndex!].product?.price ?? 0\n            Globals.orders![orderIndex!].products[productIndex!].product = product\n            if (this.myCallback) \n              this.myCallback()\n            if (isPlatformBrowser(this.platformID))\n              sub.unsubscribe();\n          }\n          else if ((isSelectedOrder ?? false)){\n            product.price = Globals.selectedOrder!.products[productIndex!].product?.price ?? 0\n            Globals.selectedOrder!.products[productIndex!].product = product\n            if (this.myCallback) \n              this.myCallback()\n            if (isPlatformBrowser(this.platformID))\n              sub.unsubscribe();\n          }\n          else if (forSale && productIndex && Globals.productsSold){\n            Globals.productsSold![productIndex] = product;\n          }\n          else{\n            Globals.selectedProduct = product;\n            if (this.myCallback) \n              this.myCallback()\n            if (isPlatformBrowser(this.platformID))\n              sub.unsubscribe();\n          }\n        }\n      })\n\n    });\n  }\n  \n  getTemplatesFiltered(){\n    \n\n    Globals.templates = [...new Map(Globals.templates.map(item => [item.productCode, item])).values()]\n    return Globals.templates.filter(\n      (template, i) => Globals.products?.some(product => product.productType === template.productCode));\n  }\n  \n  getURL(uid: string, productID: string){\n      return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FProducts%2F' + productID + '%2Flink_' + productID + '.png?alt=media'\n  }\n\n  getProfileURL(uid: string, dpID: string){\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2Fprofile_pic-' + dpID + '.jpeg?alt=media'\n  }\n\n  getThemeURL(uid: string){\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FStore_Images%2F' + \"theme\" + '.png?alt=media'\n  }\n\n  getDefaultURL(){\n\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2FSample-Walls%2FHome%2F1.jpg?alt=media'\n  }\n\n\n  getHomeURL(uid: string){\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FStore_Images%2F' + \"home\" + '.png?alt=media'\n  }\n\n  getActionURL(uid: string){\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Users%2F' + uid + '%2FStore_Images%2F' + \"action\" + '.png?alt=media'\n  }\n  \n  \n  getAltURL(){\n    return 'https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2Flink_empty.jpeg?alt=media'\n  }\n\n  getTemplate(templateID: string){\n\n    Globals.selectedTemplate = undefined\n\n    let sub = this.db.collection(\"Templates\", ref => ref.where(\"Code\",'==', templateID).orderBy(\"index\", \"asc\")).valueChanges({idField : \"TemplateID\"}).subscribe((docDatas) => {\n\n      docDatas.forEach((doc) => {\n  \n        var docData = doc as DocumentData\n  \n        if (docData){\n          let type = doc.TemplateID\n          let testingAccounts = docData[\"testingAccounts\"] as Array<string>\n          let isAvailable = docData[\"isAvailable\"] as boolean\n\n          // guard isAvailable ?? false || testingAccounts?.contains(pUserInfo.uid ?? \"\") ?? false else{\n              \n          //     continue\n          //   }\n          \n          let display = docData[\"Display_Name\"] as string\n          let info = docData[\"Info\"] as string\n          let supportedSides = docData[\"Supported_Sides\"] as Array<Dict<any>>\n          \n          if (!supportedSides || supportedSides.length == 0){\n            return\n          }\n\n          let vari = docData[\"Colors\"] as Array<Dict<any>>\n          \n          let minPrice = docData[\"Min_Price_USD\"] as number\n          let extra = docData[\"Extra_Cost_USD\"] as number\n          let code = docData[\"Code\"] as string\n          let sizes = docData[\"Sizes\"] as Array<string>\n          let category = docData[\"category\"] as string\n          let has3D = docData[\"has3D\"] as boolean\n\n          let moreInfo = (docData[\"More_info\"] as string)\n          // let discountInfo = docData[\"Discount\"] as Dict<any>\n          // let discountedUsers = discountInfo[\"Artists\"] as Array<string>\n          // let discountedPrice = discountInfo.Minimum_Price_USD as number\n          // let discountCodes = discountInfo.Discount_Codes as Array<Dict<any>>   \n          \n          const template = new Template(\n            type,\n            display,\n            info,\n            [],\n            sizes,\n            minPrice,\n            code,\n            category,\n            moreInfo,\n            false,\n            [],\n            extra,\n            has3D,\n          );\n\n          supportedSides.forEach((side) => {\n            let name = side[\"Name\"] as string\n            let height = side[\"HeightCM\"] as number\n            let width = side[\"WidthCM\"] as number\n            let widthMultiplier = side[\"WidthMultiplier\"] as number\n            let centerYConst = side[\"CenterYConst\"] as number\n            let centerXConst = side[\"CenterXConst\"] as number\n            let rotation = side[\"Rotation\"] as number\n            let useReverseAspect = side[\"useReverseAspect\"] as boolean ?? false\n            \n            let supportedSide = new TemplateSide(\n              name,\n              height,\n              width,\n              widthMultiplier,\n              centerYConst,\n              centerXConst,\n              useReverseAspect,\n              rotation\n            )\n            template.supportedSides.push(supportedSide)\n          })\n\n          vari.forEach((v) => {\n            let code = v[\"Code\"] as string\n            let display = v[\"Display\"] as string\n            let img = (v[\"IMG\"] as firebase.firestore.Blob)?.toBase64()\n            let backImg = (v[\"IMG_BACK\"] as firebase.firestore.Blob)?.toBase64()\n            let rgb = v[\"RGB\"] as Array<number>\n            let color = new Color(\n              code,\n              display,\n              rgb,\n              img,\n              backImg\n            )\n            template.colors.push(color)\n          })\n          Globals.selectedTemplate = template\n        }\n      });\n      if (this.myCallback)\n          this.myCallback()\n          if (isPlatformBrowser(this.platformID))\n          sub.unsubscribe();\n      });\n  }\n\n\n  getTemplates(){\n\n    Globals.templates = []\n\n\n\n    let sub = this.db.collection(\"Templates\", ref => ref.orderBy(\"index\", \"asc\")).valueChanges({idField : \"TemplateID\"}).subscribe((docDatas) => {\n\n      docDatas.forEach((doc) => {\n  \n        var docData = doc as DocumentData\n  \n        if (docData){\n          let type = doc.TemplateID\n          let testingAccounts = docData[\"testingAccounts\"] as Array<string>\n          let isAvailable = docData[\"isAvailable\"] as boolean\n\n          // guard isAvailable ?? false || testingAccounts?.contains(pUserInfo.uid ?? \"\") ?? false else{\n              \n          //     continue\n          //   }\n          \n          let display = docData[\"Display_Name\"] as string\n          let info = docData[\"Info\"] as string\n          let supportedSides = docData[\"Supported_Sides\"] as Array<Dict<any>>\n          \n          if (!supportedSides || supportedSides.length == 0){\n            return\n          }\n\n          let vari = docData[\"Colors\"] as Array<Dict<any>>\n          \n          let minPrice = docData[\"Min_Price_USD\"] as number\n          let extra = docData[\"Extra_Cost_USD\"] as number\n          let code = docData[\"Code\"] as string\n          let sizes = docData[\"Sizes\"] as Array<string>\n          let category = docData[\"category\"] as string\n          let has3D = docData[\"has3D\"] as boolean\n\n          let moreInfo = (docData[\"More_info\"] as string)\n          // let discountInfo = docData[\"Discount\"] as Dict<any>\n          // let discountedUsers = discountInfo[\"Artists\"] as Array<string>\n          // let discountedPrice = discountInfo.Minimum_Price_USD as number\n          // let discountCodes = discountInfo.Discount_Codes as Array<Dict<any>>   \n          \n          const template = new Template(\n            type,\n            display,\n            info,\n            [],\n            sizes,\n            minPrice,\n            code,\n            category,\n            moreInfo,\n            false,\n            [],\n            extra,\n            has3D,\n          );\n\n          supportedSides.forEach((side) => {\n            let name = side[\"Name\"] as string\n            let height = side[\"HeightCM\"] as number\n            let width = side[\"WidthCM\"] as number\n            let widthMultiplier = side[\"WidthMultiplier\"] as number\n            let centerYConst = side[\"CenterYConst\"] as number\n            let centerXConst = side[\"CenterXConst\"] as number\n            let rotation = side[\"Rotation\"] as number\n            let useReverseAspect = side[\"useReverseAspect\"] as boolean ?? false\n            \n            let supportedSide = new TemplateSide(\n              name,\n              height,\n              width,\n              widthMultiplier,\n              centerYConst,\n              centerXConst,\n              useReverseAspect,\n              rotation\n            )\n            template.supportedSides.push(supportedSide)\n          })\n\n          vari.forEach((v) => {\n            let code = v[\"Code\"] as string\n            let display = v[\"Display\"] as string\n            let img = (v[\"IMG\"] as firebase.firestore.Blob)?.toBase64()\n            let backImg = (v[\"IMG_BACK\"] as firebase.firestore.Blob)?.toBase64()\n\n            let rgb = v[\"RGB\"] as Array<number>\n            let color = new Color(\n              code,\n              display,\n              rgb,\n              img,\n              backImg\n            )\n            template.colors.push(color)\n          })\n          \n          if (!Globals.templates.includes(template)){\n            Globals.templates.push(template)\n          }\n        }\n      });\n      if (this.myCallback)\n        this.myCallback()\n        if (isPlatformBrowser(this.platformID))\n        sub.unsubscribe();\n    });\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}