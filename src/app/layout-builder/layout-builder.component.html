<div style="position: relative" class="h-100">
  <!-- <ngx-spinner
    bdColor="{{ selectedIndicator().bg_color }}"
    size="large"
    color="{{ selectedIndicator().color }}"
    type="{{ selectedIndicator().name }}"
    [fullScreen]="false"
    style.color="{{ selectedIndicator()!.color }}"
    [name]="'loader'"
  >
    <h3 [style.font-family]="storeInfo?.fontName!" class="text-center mt-5">
      {{ title }}
    </h3>
  </ngx-spinner> -->
  <div
    mat-dialog-title
    class="d-flex justify-content-between align-items-center"
  >
    <div class="big-design-header">
      <h2 class="big-design-title">
        {{
          loaded
            ? mode == 0
              ? editingBlock == undefined
                ? "Edit Layout"
                : "Edit Block"
              : "Edit Page"
            : ""
        }}
      </h2>
      <!-- <a
        role="button"
        (click)="changeSetting()"
        class="btn-secondary p-2 rounded-circle ms-2 fw-bolder text-light d-inline-flex justify-content-center align-items-center"
        style="font-size: x-large; text-decoration: none"
      >
        <mat-icon>web</mat-icon>
      </a> -->
      <div class="text-end">
        <a
          role="button"
          (click)="close()"
          class="big-design-alt-button me-1"
          matTooltip="Save & Publish Page"
        >
          {{ saving ? "Saving" : mode == 0 ? "Save" : "Save Page" }}
          <div class="big-design-alt-button-spinner" [hidden]="!saving">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </a>

        <a role="button" (click)="closeDialog()" class="big-design-button ms-1">
          Close
        </a>
      </div>
    </div>
  </div>
  <mat-dialog-content *ngIf="mode == 0 && loaded" class="h-100">
    <div
      class="w-100 h-100 d-block d-md-flex justify-content-between align-items-top"
    >
      <div class="d-none d-md-block w-100 w-md-25 h-100 parent">
        <div class="h-100 right">
          <div class="sticky h-100" style="overflow-y: scroll" id="label">
            <div [hidden]="editingBlock != undefined" class="w-100 h-100">
              <div
                class="w-100 pe-3"
                cdkDropList
                (cdkDropListDropped)="drop($event)"
              >
                <div
                  *ngFor="
                    let row of layoutForm.controls.rows.value ?? [];
                    index as i
                  "
                  class="m-0 d-flex justify-content-between align-items-center"
                  cdkDrag
                  (click)="edit(i)"
                >
                  <div
                    class="example-custom-placeholder"
                    *cdkDragPlaceholder
                  ></div>
                  <div
                    class="d-block justify-content-between align-items-center ms-1 mt-1"
                  >
                    <a role="button" (click)="edit(i)">
                      <mat-icon class="me-2">settings</mat-icon>
                    </a>
                    <a role="button" (click)="removeRows(i)">
                      <mat-icon class="me-2 text-danger">delete</mat-icon>
                    </a>
                  </div>
                  <div class="m-0 h-100 w-100">
                    <div
                      class="big-design-card h-100 shadow my-1 me-1 p-1 zoom"
                      role="button"
                      (mouseover)="changeStyle($event, i)"
                      (mouseout)="changeStyle($event, i)"
                      style="position: relative"
                      [style.background-color]="
                        ((aRow.index == i ? aRow?.row : undefined) ?? row)
                          .backgroundColor
                      "
                    >
                      <div
                        *ngIf="
                          (
                            (aRow.index == i ? aRow?.row : undefined)?.text ??
                            row.text ??
                            ''
                          ).trim() != ''
                        "
                        class="d-flex align-items-center justify-content-center mt-2 mb-1"
                        style="
                          max-height: 50px;
                          font-weight: bold;
                          font-size: 4px;
                          pointer-events: none;
                        "
                        style.color="{{ selectedTheme!.color }}"
                      >
                        <p
                          class="text-center text-dark"
                          style="line-height: 1.2em"
                          [style.font-family]="storeInfo?.fontName!"
                        >
                          {{
                            (aRow.index == i ? aRow?.row : undefined)?.text ??
                              row.text
                          }}
                        </p>
                      </div>
                      <div
                        class="row mx-0 gx-1 gx-lg-1 gy-1 row-cols-1 row-cols-md-{{
                          (aRow.index == i ? aRow?.row : undefined)?.grid_row ??
                            row.grid_row ??
                            1
                        }} justify-content-start"
                        style="pointer-events: none"
                      >
                        <div
                          class="col"
                          *ngFor="
                            let product of (aRow.index == i ? aRow?.row : row)
                              .products ?? []
                          "
                        >
                          <div
                            class="bg-white shadow rounded border border-secondary"
                            style="overflow: hidden"
                            *ngIf="items![product]"
                          >
                            <div class="pb-0 w-100">
                              <a role="button" class="w-100">
                                <img
                                  loading="lazy"
                                  id="image"
                                  class="h-100 w-100"
                                  [useSrcset]="true"
                                  [defaultImage]="'/assets/default.png'"
                                  [lazyLoad]="
                                    items![product].nft.img ??
                                    '/assets/default.png'
                                  "
                                  alt="ok"
                                  style="object-fit: cover; aspect-ratio: 1"
                                />
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div
                        class="row gx-0 row-cols-1 row-cols-md-{{
                          (aRow.index == i ? aRow?.row : undefined)?.grid_row ??
                            row.grid_row ??
                            1
                        }} justify-content-center w-100 mx-0"
                        *ngIf="
                          ((aRow.index == i ? aRow?.row : undefined)?.type ??
                            row.type) ==
                          1
                        "
                        style="pointer-events: none"
                      >
                        <div
                          class="col"
                          *ngFor="
                            let img of (aRow.index == i ? aRow?.row : undefined)
                              ?.imgs ??
                              row.imgs ??
                              []
                          "
                          style="
                            margin-bottom: 1px;
                            padding-left: 0.5px;
                            padding-right: 0.5px;
                          "
                        >
                          <div
                            class="d-block align-items-center text-center text-sm-start w-100"
                          >
                            <a class="ms-0 me-0" role="button">
                              <img
                                loading="lazy"
                                class="h-auto w-100 white"
                                [useSrcset]="true"
                                [defaultImage]="'/assets/default.png'"
                                [lazyLoad]="img"
                                alt="ok"
                              />
                            </a>
                          </div>
                        </div>
                      </div>

                      <div
                        class="row gx-0 row-cols-1 row-cols-md-{{
                          (aRow.index == i ? aRow?.row : undefined)?.grid_row ??
                            row.grid_row ??
                            1
                        }} justify-content-center w-100 mx-0"
                        *ngIf="
                          ((aRow.index == i ? aRow?.row : undefined)?.type ??
                            row.type) ==
                          4
                        "
                      >
                        <div
                          class="col mb-1"
                          *ngFor="
                            let vid of (
                              (aRow.index == i ? aRow?.row : undefined) ?? row
                            ).vids ?? [];
                            index as i
                          "
                        >
                          <div
                            class="d-block align-items-center text-center text-sm-start w-100"
                          >
                            <a class="ms-0 me-0" role="button">
                              <iframe
                                [src]="vid | videoPipe | safeUrl"
                                width="100%"
                                style="aspect-ratio: 16/9"
                              ></iframe>
                            </a>
                          </div>
                        </div>
                      </div>

                      <div
                        class="w-100 mx-0"
                        *ngIf="
                          ((aRow.index == i ? aRow?.row : undefined)?.type ??
                            row.type) ==
                          2
                        "
                        style="pointer-events: none"
                      >
                        <div
                          class="m-1 w-100 px-0"
                          style="
                            text-overflow: ellipsis;
                            line-height: 2em;
                            font-size: 3px;
                            word-break: break-all;
                            padding-right: 2px;
                          "
                          style.color="{{ selectedTheme!.color }}"
                          [style.font-family]="storeInfo?.fontName!"
                          [innerHTML]="
                            ((aRow.index == i ? aRow?.row : undefined) ?? row)
                              .html | safeTextRows: true
                          "
                        ></div>
                      </div>

                      <div
                        class="w-100 mx-0"
                        *ngIf="
                          ((aRow.index == i ? aRow?.row : undefined)?.type ??
                            row.type) ==
                          7
                        "
                        style="pointer-events: none"
                        c
                      >
                        <h1 class="m-2 text-center fw-bolder">CUSTOM HTML</h1>
                      </div>

                      <div
                        class="w-100 h-100"
                        style="
                          position: absolute;
                          pointer-events: all;
                          cursor: grab;
                        "
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="w-100 d-flex justify-content-between align-items-center"
              >
                <div class="d-block justify-content-between align-items-center">
                  <a role="button">
                    <mat-icon class="me-2"></mat-icon>
                  </a>
                  <a role="button">
                    <mat-icon class="me-2"></mat-icon>
                  </a>
                </div>
                <div
                  class="card zoom container-fluid d-flex justify-content-center align-items-center big-design-placeholder m-3 ms-3 me-4 mt-1"
                  role="button"
                  (click)="addBlock()"
                  matTooltip="Add New Content Block"
                >
                  <a
                    class="fw-bolder text-secondary d-flex align-items-center justify-content-center"
                    style="font-size: large; text-decoration: none"
                  >
                    ADD BLOCK
                    <mat-icon
                      class="ms-1"
                      style="font-weight: bolder"
                      [inline]="true"
                      >add</mat-icon
                    >
                  </a>
                </div>
              </div>
            </div>
            <div [hidden]="editingBlock == undefined" class="w-100 h-100 pe-3">
              <form [formGroup]="rowForm" novalidate>
                <mat-form-field class="w-100" appearance="outline">
                  <mat-select
                    formControlName="type"
                    class="big-design-input-text"
                    (selectionChange)="changed(undefined, $event)"
                  >
                    <mat-select-trigger
                      class="d-flex align-items-center big-design-input-text"
                      *ngIf="matchingType(rowForm.controls.type.value)"
                    >
                      Type:
                      {{ matchingType(rowForm.controls.type.value)!.name }}
                    </mat-select-trigger>
                    <mat-option
                      class="big-design-input-text"
                      *ngFor="let type of types"
                      [value]="type.code"
                    >
                      <!-- <mat-icon >{{type.icon}}</mat-icon> -->
                      {{ type.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <div
                  *ngIf="rowForm.controls.type.value == 2"
                  [ngxSummernote]="config"
                  formControlName="htmlText"
                ></div>

                <div
                  class="w-100"
                  *ngIf="rowForm.controls.type.value == 7"
                  [class.relative]="codeMode == false"
                  style="height: 450px"
                >
                  <ngx-monaco-editor
                    class="w-100 h-100"
                    [class.absolute]="codeMode"
                    ngDefaultControl
                    [options]="editorOptions"
                    formControlName="html"
                  >
                  </ngx-monaco-editor>

                  <!-- <a [hidden]='codeMode' (click)='codeMode = true' style="position: absolute; bottom: 15px; right: 5px; z-index: 100; height: 30px; width: 30px; text-decoration: none;" role="button" class="btn btn-light shadow rounded-circle d-flex justify-content-center align-items-center"><mat-icon >fullscreen</mat-icon></a> -->
                </div>

                <mat-form-field
                  class="w-100"
                  appearance="outline"
                  *ngIf="
                    rowForm.controls.type.value != 2 &&
                    rowForm.controls.type.value != 7 &&
                    rowForm.controls.type.value != 6
                  "
                >
                  <mat-select
                    class="big-design-input-text"
                    formControlName="grid"
                    (selectionChange)="changed($event)"
                  >
                    <mat-select-trigger
                      class="d-flex align-items-center big-design-input-text"
                      *ngIf="rowForm.controls.grid.value"
                    >
                      {{ rowForm.controls.grid.value }} Item(s) Per. Row
                    </mat-select-trigger>
                    <mat-option
                      *ngFor="let g of grid"
                      class="big-design-input-text"
                      [value]="g.name"
                    >
                      <!-- <mat-icon >{{type.icon}}</mat-icon> -->
                      {{ g.name }} Per. Row
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <!-- colors -->
                <div class="card h-auto mb-3">
                  <a
                    role="button"
                    class="btn d-flex justify-content-between align-items-center"
                    [cpPosition]="'bottom'"
                    [cpPositionRelativeToArrow]="false"
                    (colorPickerSelect)="selectColor($event, true)"
                    [cpOutputFormat]="'rgba'"
                    [cpOKButton]="true"
                    [cpOKButtonText]="'SET COLOR'"
                    [cpOKButtonClass]="'big-design-alt-button'"
                    [cpSaveClickOutside]="false"
                    [colorPicker]="rowForm.controls.backgroundColor.value"
                  >
                    <p
                      class="big-design-input-text my-auto p-0"
                      style="font-size: 14px"
                    >
                      Background Color
                    </p>
                    <div
                      class="rounded-circle border border-secondary"
                      style="height: 20px; aspect-ratio: 1"
                      [style.background-color]="
                        rowForm.controls.backgroundColor.value
                      "
                    ></div>
                  </a>
                </div>

                <mat-form-field class="w-100" appearance="outline">
                  <mat-select
                    class="big-design-input-text"
                    formControlName="corners"
                    (selectionChange)="changed($event)"
                  >
                    <mat-select-trigger
                      class="d-flex align-items-center big-design-input-text"
                      *ngIf="rowForm.controls.corners.value"
                    >
                      {{ cornerName(rowForm.controls.corners.value) }} Corners
                    </mat-select-trigger>
                    <mat-option
                      *ngFor="let c of corners"
                      class="big-design-input-text"
                      [value]="c.code"
                    >
                      <!-- <mat-icon >{{type.icon}}</mat-icon> -->
                      {{ c.name }} Corners
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <div
                  cdkDropList
                  class="rounded shadow bg-light w-100 h-100"
                  (cdkDropListDropped)="drop($event, true)"
                  style="overflow-y: scroll"
                  *ngIf="rowForm.controls.type.value == 1"
                >
                  <div
                    class="example-box"
                    *ngFor="let image of images"
                    cdkDrag
                    [cdkDragDisabled]="!image.isActive"
                  >
                    <div class="h-100 w-100 p-1" style="position: relative">
                      <a
                        *ngIf="image.isActive"
                        role="button"
                        (click)="fileInput.click()"
                      >
                        <img
                          loading="lazy"
                          class="ani-style w-100 white"
                          [useSrcset]="true"
                          [defaultImage]="'/assets/default.png'"
                          [lazyLoad]="image.img"
                          style="object-fit: contain"
                          alt="ok"
                        />
                      </a>

                      <div style="position: absolute; top: 0; right: 0">
                        <a
                          *ngIf="image.isActive && canCancel()"
                          class="ani-style"
                          (click)="removeImg(image)"
                          role="button"
                          ><mat-icon>cancel</mat-icon></a
                        >
                      </div>

                      <div
                        *ngIf="!image.isActive"
                        class="cdk-drag-placeholder w-100"
                        style="height: 100px"
                      >
                        <a
                          class="h-100 w-100 d-flex ani-style justify-content-center align-items-center"
                          (click)="fileInput.click()"
                          style="text-decoration: none"
                          role="button"
                        >
                          <mat-icon>add_circle</mat-icon>
                        </a>
                      </div>
                      <mat-form-field class="w-100 my-1" floatLabel="never">
                        <input
                          type="text"
                          matInput
                          [ngModelOptions]="{ standalone: true }"
                          [(ngModel)]="image.link"
                          style="font-size: small"
                          placeholder="Image Click URL"
                          class="text-dark big-design-input-text"
                        />
                        <mat-icon role="button" matSuffix>link</mat-icon>
                      </mat-form-field>
                      <input
                        #fileInput
                        type="file"
                        (change)="fileChangeEvent($event, image)"
                        style="display: none"
                      />
                    </div>
                  </div>
                </div>

                <div
                  cdkDropList
                  class="rounded shadow bg-light w-100 h-100"
                  (cdkDropListDropped)="drop($event, true)"
                  style="overflow-y: scroll"
                  *ngIf="rowForm.controls.type.value == 4"
                >
                  <div
                    class="example-box"
                    *ngFor="let vid of videos"
                    cdkDrag
                    [cdkDragDisabled]="!vid.isActive"
                  >
                    <div class="h-100 w-100 p-1" style="position: relative">
                      <a class="ms-0 me-0" role="button" *ngIf="vid.isActive">
                        <iframe
                          [src]="vid.link | videoPipe | safeUrl"
                          width="100%"
                          style="aspect-ratio: 16/9"
                        ></iframe>
                      </a>

                      <div style="position: absolute; top: 0; right: 0">
                        <a *ngIf="vid.isActive" class="ani-style" role="button"
                          ><mat-icon>cancel</mat-icon></a
                        >
                      </div>

                      <div
                        *ngIf="!vid.isActive"
                        class="cdk-drag-placeholder w-100 m-0"
                        style="aspect-ratio: 16/9"
                      >
                        <a
                          class="h-100 w-100 d-flex ani-style justify-content-center align-items-center"
                          style="text-decoration: none"
                          role="button"
                        >
                          No Video Set
                        </a>
                      </div>
                      <mat-form-field class="w-100 my-1" floatLabel="never">
                        <input
                          type="text"
                          matInput
                          [ngModelOptions]="{ standalone: true }"
                          [(ngModel)]="vid.link"
                          (keyup)="vidChangeEvent($event, vid)"
                          style="font-size: small"
                          placeholder="Video URL"
                          class="text-dark big-design-input-text"
                        />
                        <mat-icon role="button" matSuffix>link</mat-icon>
                      </mat-form-field>
                    </div>
                  </div>
                </div>

                <mat-form-field
                  *ngIf="rowForm.controls.type.value == 0"
                  class="w-100"
                  appearance="outline"
                >
                  <mat-chip-list #chipList aria-label="Product selection">
                    <mat-chip
                      *ngFor="let product of prods ?? []"
                      [selectable]="selectable"
                      [removable]="removable"
                      (removed)="remove(product)"
                      class="category-chip big-design-input-text"
                    >
                      <div class="category-chip__text">
                        {{ productName(product) }}
                      </div>
                      <button
                        matChipRemove
                        class="d-flex justify-content-center align-items-center btn me-1"
                        style="width: fit-content; aspect-ratio: 1/1"
                        *ngIf="removable"
                      >
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip>
                    <input
                      class="big-design-input-text"
                      *ngIf="!allSelected()"
                      placeholder="Products"
                      #productInput
                      [formControl]="productCtrl"
                      [matAutocomplete]="auto"
                      [matChipInputFor]="chipList"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                      (matChipInputTokenEnd)="add($event)"
                    />
                  </mat-chip-list>
                  <mat-autocomplete
                    #auto="matAutocomplete"
                    (optionSelected)="selected($event)"
                  >
                    <cdk-virtual-scroll-viewport
                      class="autocomplete-test-viewport"
                      [ngStyle]="{ height: '200px' }"
                      itemSize="35"
                    >
                      <mat-option
                        *cdkVirtualFor="let product of filteredProducts | async"
                        [value]="product.docID"
                      >
                        <div
                          class="d-flex justify-content-start align-items-center w-100"
                        >
                          <img
                            id="image"
                            class="white me-2 rounded big-design-input-text"
                            [src]="product.img ?? ''"
                            style="
                              object-fit: cover;
                              width: 35px;
                              aspect-ratio: 1;
                            "
                          />
                          {{ product.name }}
                        </div>
                      </mat-option>
                    </cdk-virtual-scroll-viewport>
                  </mat-autocomplete>
                </mat-form-field>
                <!-- <mat-form-field class="w-100 my-3" appearance="outline">
                  <mat-label>Scroll Animation</mat-label>
                  <mat-select
                    formControlName="animations"
                    (selectionChange)="changed($event)"
                  >
                    <mat-optgroup
                      style="display: block"
                      class="text-dark bg-light"
                      *ngFor="let anim of animations()"
                      [label]="anim.name"
                    >

                      <mat-option
                        class="not-empty-select text-dark bg-light"
                        *ngFor="let a of anim.animations"
                        [value]="a"
                      >
                        {{ a }}
                      </mat-option>
                    </mat-optgroup>
                  </mat-select>
                </mat-form-field> -->
              </form>
              <div class="mt-2">
                <a
                  role="button"
                  (click)="finishedEditing()"
                  class="big-design-alt-button"
                  matTooltip="Save Block"
                >
                  Save
                </a>
                <a
                  role="button"
                  (click)="finishedEditing(true)"
                  class="big-design-button ms-2"
                  matTooltip="Delete Block"
                >
                  Delete
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="ms-md-4 w-100 w-md-75 h-100 py-3 pt-1">
        <div class="big-design-card h-100 w-100">
          <div
            class="w-100 h-100 big-design-body p-0"
            style="overflow-y: scroll"
            id="capture"
          >
            <section class="py-0 w-100 mb-0">
              <!-- (cdkDropListDropped)="drop($event)" -->
              <div
                cdkDropList
                class="ms-0 mb-0 h-100"
                (cdkDropListDropped)="drop($event)"
              >
                <div
                  class="pb-0 block {{
                    ((aRow.index == i ? aRow?.row : undefined) ?? row).corners
                  }}-corners"
                  *ngFor="
                    let row of layoutForm.controls.rows.value ?? [];
                    index as i
                  "
                  id="p-{{ i }}"
                  cdkDrag
                  role="button"
                  (click)="edit(i)"
                  [class.highlight]="hoverIndex != undefined && hoverIndex == i"
                  [style.background-color]="
                    ((aRow.index == i ? aRow?.row : undefined) ?? row)
                      .backgroundColor
                  "
                >
                  <!-- {{ ((aRow.index == i ? aRow?.row : undefined) ??
                    row).backgroundColor }} -->

                  <!-- <div class="example-custom-placeholder" *cdkDragPlaceholder></div> -->
                  <div
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined)?.text ??
                        row.text ??
                        '') !=
                      ''
                    "
                    class="d-flex align-items-center justify-content-center pb-1 mb-5"
                    style="height: 50px; font-weight: bold; font-size: 30px"
                    style.color="{{ selectedTheme!.color }}"
                  >
                    <p
                      class="text-center text-dark"
                      style="line-height: 1.2em"
                      [style.font-family]="storeInfo?.fontName!"
                    >
                      {{
                        (aRow.index == i ? aRow?.row : undefined)?.text ??
                          row.text
                      }}
                    </p>
                  </div>
                  <div
                    class="w-100"
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined)?.type ??
                        row.type) ==
                      0
                    "
                  >
                    <app-product-section
                      [items]="items"
                      [row]="(aRow.index == i ? aRow?.row : undefined) ?? row"
                      [storeInfo]="storeInfo"
                      [selectedTheme]="storeInfo | storeTheme"
                      [hidePrice]="true"
                      [lazy]="false"
                      [canOpen]="false"
                    >
                    </app-product-section>
                  </div>
                  <div
                    class="row gx-0 row-cols-1 row-cols-md-{{
                      (aRow.index == i ? aRow?.row : undefined)?.grid_row ??
                        row.grid_row ??
                        1
                    }} justify-content-center w-100 mx-0"
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined)?.type ??
                        row.type) ==
                      1
                    "
                    style="pointer-events: none"
                  >
                    <div
                      class="col"
                      style="margin-bottom: 2px"
                      *ngFor="
                        let img of (aRow.index == i ? aRow?.row : undefined)
                          ?.imgs ??
                          row.imgs ??
                          []
                      "
                    >
                      <div
                        class="d-block align-items-center text-center text-sm-start w-100"
                      >
                        <a class="mx-0" role="button">
                          <img
                            class="h-auto w-100"
                            style="object-fit: contain"
                            [src]="img"
                            alt="ok"
                          />
                        </a>
                      </div>
                    </div>
                  </div>
                  <div
                    class="row gx-0 row-cols-1 row-cols-md-{{
                      (aRow.index == i ? aRow?.row : undefined)?.grid_row ??
                        row.grid_row ??
                        1
                    }} justify-content-center w-100 px-3 mb-1"
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined)?.type ??
                        row.type) ==
                      3
                    "
                    style="pointer-events: none"
                  ></div>
                  <div
                    class="row gx-0 row-cols-1 row-cols-md-{{
                      (aRow.index == i ? aRow?.row : undefined)?.grid_row ??
                        row.grid_row ??
                        1
                    }} justify-content-center w-100 mx-0"
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined)?.type ??
                        row.type) ==
                      4
                    "
                  >
                    <div
                      class="col mb-1"
                      *ngFor="
                        let vid of (
                          (aRow.index == i ? aRow?.row : undefined) ?? row
                        ).vids ?? [];
                        index as i
                      "
                    >
                      <div
                        class="d-block align-items-center text-center text-sm-start w-100"
                      >
                        <a class="ms-0 me-0" role="button">
                          <iframe
                            [src]="vid | videoPipe | safeUrl"
                            width="100%"
                            style="aspect-ratio: 16/9"
                          ></iframe>
                        </a>
                      </div>
                    </div>
                  </div>
                  <div
                    class="w-100 mx-0"
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined)?.type ??
                        row.type) ==
                      2
                    "
                    style="pointer-events: none"
                  >
                    <div
                      class="p-3 h-100"
                      [style.font-family]="storeInfo?.fontName!"
                      style.color="{{ selectedTheme!.color }}"
                      [innerHTML]="
                        ((aRow.index == i ? aRow?.row : undefined) ?? row).html
                          | safeTextRows
                      "
                    ></div>
                  </div>

                  <div
                    class="w-100 mx-0"
                    id="c{{ i }}"
                    *ngIf="
                      ((aRow.index == i ? aRow?.row : undefined) ?? row).type ==
                      7
                    "
                    style="pointer-events: none"
                  >
                    <iframe
                      width="100%"
                      id="frame{{ i }}"
                      height="100%"
                      (load)="resizeIframe(i)"
                      [srcdoc]="
                        ((aRow.index == i ? aRow?.row : undefined) ?? row)
                          .htmlTemplate ?? ''
                          | storePipe
                          | safeHtml
                      "
                    ></iframe>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="!loaded" style="height: 100vh"></div>
  </mat-dialog-content>

  <mat-dialog-content
    *ngIf="mode == 1 && loaded"
    class="h-100 d-block d-md-flex pb-4"
    style="overflow-y: hidden"
  >
    <div class="w-100 h-100 w-md-50 big-design-card mt-1 py-3">
      <div class="big-design-body h-100" style="overflow-y: scroll">
        <form [formGroup]="layoutForm" novalidate class="mx-2 mt-2 mb-0 h-100">
          <div class="row row-cols-1 my-4">
            <div class="col mt-0">
              <div class="mt-2">
                <h2 class="big-design-input-title my-0">URL</h2>
                <h5 class="big-design-input-subtitle my-0">
                  The URL of your page
                </h5>
                <mat-form-field
                  class="w-100 mt-2"
                  style="font-size: small"
                  appearance="outline"
                  floatLabel="never"
                >
                  <input
                    formControlName="url"
                    type="text"
                    matInput
                    placeholder="Page URL (ex. 'home')"
                    class="text-dark my-auto big-design-input-text"
                  />
                  <h4
                    matSuffix
                    class="text-secondary big-design-input-text d-none d-md-block"
                  >
                    {{ urlText(false) }}
                  </h4>
                </mat-form-field>
              </div>
            </div>
            <div class="col mt-0">
              <div class="mt-0">
                <h2 class="big-design-input-title my-0">Name</h2>
                <h5 class="big-design-input-subtitle my-0">
                  The name of your page
                </h5>
                <mat-form-field
                  class="w-100 mt-2"
                  style="font-size: small"
                  appearance="outline"
                  floatLabel="never"
                >
                  <input
                    formControlName="name"
                    type="text"
                    matInput
                    placeholder="Page Name (ex. 'New-Product')"
                    class="text-dark big-design-input-text"
                  />
                </mat-form-field>
              </div>
            </div>
            <div class="col mt-0">
              <div class="mt-0 mb-0">
                <h2 class="big-design-input-title my-0">Meta Title</h2>
                <h5 class="big-design-input-subtitle my-0">
                  The meta title of your page
                </h5>
                <mat-form-field
                  class="w-100 mt-2"
                  style="font-size: small"
                  appearance="outline"
                  floatLabel="never"
                >
                  <input
                    formControlName="metaTitle"
                    type="text"
                    matInput
                    placeholder="Meta Title"
                    class="text-dark big-design-input-text"
                  />
                </mat-form-field>
                <h2 class="big-design-input-title my-0">Meta Description</h2>
                <h5 class="big-design-input-subtitle my-0">
                  The meta description of your page
                </h5>
                <mat-form-field
                  class="w-100 mt-2"
                  style="font-size: small"
                  appearance="outline"
                  floatLabel="never"
                >
                  <textarea
                    formControlName="metaDesc"
                    type="text"
                    matInput
                    placeholder="Meta Description"
                    class="text-dark big-design-input-text"
                    style="height: 100px"
                  ></textarea>
                </mat-form-field>

                <h2 class="big-design-input-title my-0">Meta Tags</h2>
                <h5 class="big-design-input-subtitle my-0">
                  The meta tags of your page
                </h5>
                <mat-form-field
                  class="w-100 mt-2"
                  appearance="outline"
                  floatLabel="never"
                >
                  <mat-chip-list #tagChipList aria-label="Keyword selection">
                    <mat-chip
                      *ngFor="
                        let tag of layoutForm.controls.seoTags.value ?? []
                      "
                      [selectable]="selectable"
                      [removable]="removable"
                      (removed)="removeTag(tag)"
                      class="category-chip"
                    >
                      <div class="category-chip__text big-design-input-text">
                        {{ tag }}
                      </div>
                      <button
                        matChipRemove
                        class="d-flex justify-content-center align-items-center btn me-1"
                        style="width: fit-content; aspect-ratio: 1/1"
                        *ngIf="removable"
                      >
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip>
                    <!-- *ngIf='!allSelected()' -->
                    <input
                      placeholder="Add Tag..."
                      #productInput
                      [formControl]="tagCtrl"
                      [matChipInputFor]="tagChipList"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                      (matChipInputTokenEnd)="addTag($event)"
                    />
                  </mat-chip-list>
                </mat-form-field>
              </div>
            </div>
            <div class="col mt-0">
              <h2 class="big-design-input-title my-0">Visibility</h2>
              <h5 class="mt-0 big-design-input-subtitle">
                When set to 'Visible', your page will be accessible from your
                store's navigation menu.
              </h5>
              <mat-radio-group class="mb-4" formControlName="isFullscreen">
                <div>
                  <mat-radio-button
                    class="big-design-input-text"
                    [value]="false"
                    (change)="radioChange($event)"
                    >Visible</mat-radio-button
                  >
                </div>
                <div class="mt-2">
                  <mat-radio-button
                    class="big-design-input-text"
                    [value]="true"
                    (change)="radioChange($event)"
                    >Hidden</mat-radio-button
                  >
                </div>
              </mat-radio-group>
            </div>
            <div class="col my-3">
              <hr />
            </div>
            <div class="col mt-0 mb-4">
              <a
                class="big-design-button"
                (click)="deletePage()"
                matTooltip="Remove Page from Storefront"
              >
                {{ deleting ? "Deleting" : "Delete Page" }}
                <div class="big-design-button-spinner" [hidden]="!deleting">
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                </div>
              </a>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="w-100 w-md-50 h-100">
      <div class="h-100 w-100 px-md-5 mx-auto mt-0" style="overflow-y: scroll">
        <div
          id="back"
          role="button"
          style="aspect-ratio: 2/1"
          class="big-design-card mt-1"
        >
          <div class="big-design-header">
            <p class="big-design-title">Page Builder</p>
            <a
              role="button"
              (click)="mode = 0"
              class="big-design-button"
              matTooltip="Edit Body Content of the Page"
            >
              Edit Content</a
            >
          </div>
          <div class="big-design-body w-100 h-200 rounded border mt-3">
            <div
              class="w-100 h-100 rounded"
              style="overflow-y: hidden; aspect-ratio: 2.5/1"
            >
              <img
                class="w-100 h-auto"
                style="object-fit: contain"
                loading="lazy"
                [useSrcset]="true"
                [defaultImage]="'/assets/default.png'"
                [lazyLoad]="pageDisplay ?? '/assets/default.png'"
              />
            </div>
          </div>
        </div>
        <div class="w-100 big-design-card mt-1" style="height: fit-content">
          <div class="big-design-header">
            <p class="big-design-title">Search Engine Listing Preview</p>
          </div>
          <div class="mt-2 w-100">
            <p
              class="mb-0 w-100"
              style="color: #2417af; font-family: Arial; font-size: large"
            >
              {{ this.layoutForm.controls.metaTitle.value ?? "" }}
            </p>
            <p
              class="my-0 w-100"
              style="color: #006521; font-family: Arial; font-size: small"
            >
              {{ urlText(true) ?? "" }}
            </p>
            <p
              class="my-0 w-100"
              style="
                color: #6e6e6e;
                font-family: Arial;
                font-size: small;
                line-break: auto;
                word-break: break-all;
              "
            >
              {{ this.layoutForm.controls.metaDesc.value ?? "" }}
            </p>
          </div>
        </div>
        <!-- <div class="col w-100 big-design-card mt-1">
          <div class="big-design-header">
            <p class="big-design-title">Social Link Preview</p>
          </div>
          <div class="d-flex mt-2">
            <div
              class="w-100 my-0 d-flex align-items-center justify-content-start"
              style="height: 150px"
            >
              <img
                class="h-100"
                style="object-fit: contain; aspect-ratio: 1"
                src="{{
                  this.layoutForm.controls.metaPic.value ??
                    storeInfo?.profileLink
                }}"
              />
              <p
                class="ms-3 my-auto"
                style="
                  color: #6e6e6e;
                  font-family: Arial;
                  font-size: small;
                  text-overflow: ellipsis;
                  overflow-y: hidden;
                  height: 120px;
                "
              >
                <b class="text-dark" style="font-size: medium">
                  {{ this.layoutForm.controls.metaTitle.value ?? "" }}
                </b>
                <br />

                {{ this.layoutForm.controls.metaDesc.value ?? "" }}
              </p>
            </div>
          </div>
        </div> -->
      </div>
    </div>
  </mat-dialog-content>
</div>
<!-- <div class="w-100" mat-dialog-actions>

    <div class="w-100">
        <h2 class="w-100 fw-bolder text-start">Tools</h2>
        <div class="d-block align-items-center w-100">
            <div class="card h-100">
                <div class="card-body p-2 pb-0">
                    
                </div>
                <div class="card-footer p-4 pt-0 pt-0 pb-4 border-top-0 bg-transparent">
                                      
                </div>
            </div>
        </div>
    </div>
</div> -->
