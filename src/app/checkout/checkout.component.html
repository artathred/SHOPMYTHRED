<router-outlet></router-outlet>


<ngx-spinner
*ngIf="isBrowser()" 
bdColor = '{{selectedIndicator().bg_color}}'
size = "large"
color = '{{selectedIndicator().color}}'
type = {{selectedIndicator().name}} 
[fullScreen] = "true"
style.color = "{{selectedIndicator()!.color}}"
>
<h3 class="text-center mt-5" [style.font-family]="storeInfo().fontName!"> {{loadingName}}
</h3>
</ngx-spinner>
  <!-- Header-->
  <header *ngIf="isBrowser() && hasCart() && storeInfo().username != undefined" [hidden]="stillLoadingProducts()" class="bg-{{storeInfo().colorStyle!.back_code}} py-6">
    <div class="cover" style="background-image: url(https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2FSample-Walls%2FHome%2F1.jpg?alt=media);" [style.background-image]='"url(" + (storeInfo()!.themeLink?.toString() ?? "") + ")"'>
        <div class="d-flex align-items-center justify-content-center" style="height: 200px; font-weight: bold;font-size:30px">
          <div class="px-2">
            <p [style.font-family]="storeInfo().fontName!" class = "text-center" style = "line-height:1.2em;text-shadow: 2px 2px 4px #42424281;">
              REVIEW ORDER
             </p>
             <p [style.font-family]="storeInfo().fontName!" class = "text-center" style = "line-height:1.2em; font-size:25px; text-shadow: 2px 2px 4px #42424281;">
              SECURE CHECKOUT
              <mat-icon [inline]='true'>
                lock
              </mat-icon>
             </p>
          </div>
           </div>
      </div>
  </header>

  <section *ngIf="isBrowser() && hasCart() && storeInfo().username != undefined" [hidden]="stillLoadingProducts()" class="py-5" style.background-color="{{selectedTheme()!.bg_color}}">
    <div class="container pb-5 mb-2 mb-md-4">
        <div class="row">
          <!-- List of items-->
          <!-- <div class="d-flex justify-content-left align-items-center pb-4 pb-sm-5 mt-1 ms-2 ps-1">
            <a class="btn btn-outline-primary btn-sm ps-2" href="shop-grid-ls.html"><i class="ci-arrow-left me-2"></i>Continue shopping</a>
          </div> -->

          <section class="col-lg-8 order-2 order-sm-1">
            
            <div class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-2 pb-1">
                <div class="py-0 px-xl-2">
                  <div [hidden]="stillLoadingProducts()" class="text-accent">
                    <h2 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="h6 mb-3 pb-1 ps-4 mt-2">1. Shipping Address</h2>
                    <h3 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fw-normal ps-4" style="font-style: italic">{{getShippingAddressFirst()}}</h3>
                    <h3 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fw-normal ps-4" style="font-style: italic">{{getShippingAddressSecond()}}</h3>
                    <h3 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fw-normal ps-4" style="font-style: italic">{{getShippingAddressThird()}}</h3>
                    <p><a [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" role="button" (click)="routeToShipping()" class="text-primary text-decoration-none ps-4" style="font-weight: bold;">Change</a></p>
                  </div>
                </div>
            </div>

            <div class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-2 pt-3 pb-1 mt-3">
                <div class="py-0 px-xl-2">
                  <div [hidden]="stillLoadingProducts()" class="text-accent">
                    <h2 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="h6 mb-3 pb-1 ps-4 mt-2">2. Payment Method </h2>
                    <h3 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fw-normal ps-4" style="font-style: italic">{{getBillingAddressFirst()}}</h3>
                    <p><a [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" role="button" (click)="routeToBilling()" class="text-primary text-decoration-none ps-4" style="font-weight: bold;">Change</a></p>
                    </div>
                </div>
            </div>
            <!-- Item-->
            <div class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-4 pt-3 mt-3">
                <h2 [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="h6 mb-1 pb-1 ps-2 mt-2">3. Review Order</h2>
                <div class="py-2 px-xl-2">
                    <div *ngFor="let product of cart(); index as i" class="d-sm-flex justify-content-between align-items-center pb-3 pt-3">
                        <div class="d-block d-sm-flex align-items-center text-center text-sm-start"><a class="d-inline-block flex-shrink-0 mx-auto me-sm-4" role="button" (click)="routeToProduct(product.product!.productID)"><img style="border-radius: 2.5%;" src="{{product.product!.url}}" onerror="this.src='https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2Flink_empty.jpeg?alt=media';" width="160" alt="Product"/></a>
                          <div class="pt-2">
                              <p><a [style.font-family]="storeInfo().fontName!" role="button" (click)="routeToProduct(product.product!.productID)" class="text-{{storeInfo().colorStyle!.text_code}} text-decoration-none" style="font-weight: bold;" style.color="{{selectedTheme()!.color}}">{{product.product?.name ?? ""}}</a></p>
                            <div [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fs-sm"><span class="text-muted me-2">Size:</span>{{product.size ?? "M"}}</div>
                            <div [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fs-sm"><span class="text-muted me-2">Color:</span>{{getColor(product.product)}}</div>
                            <div [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}" class="fs-lg text-accent pt-2">{{formatPrice(mainPrice(product.product!))}}</div>
                          </div>
                        </div>
                        <div class="pt-2 pt-sm-0 ps-sm-3 mx-auto mx-sm-0 text-center text-sm-start" style="max-width: 5.5rem;">
                          <label [style.font-family]="storeInfo().fontName!" class="form-label" for="quantity_i" style.color="{{selectedTheme()!.color}}">Quantity</label>
                          <input [style.font-family]="storeInfo().fontName!" #qtyChooser class="form-control" type="number" id="quantity_i" min="1" value="{{product.quantity ?? 1}}" (change)="updateProductQty(product, qtyChooser.value)" style.background-color="{{selectedTheme()!.bg_color}}" style.color="{{selectedTheme()!.color}}"/>
                          <button [style.font-family]="storeInfo().fontName!" class="btn btn-link px-0 text-danger" type="button" (click)="updateProductQty(product, '0')"><i class="ci-close-circle me-0"></i><span class="fs-sm" style="font-size: 10px;">Remove</span></button>
                        </div>
                      </div>
                </div>
            </div>
            
          </section>
          <!-- Sidebar-->
          <aside class="col-lg-4 pb-2 pb-sm-0 ps-xl-5 order-1 order-sm-2">
            <div [hidden]="stillLoading()" class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-4 pb-0">
              <div class="py-2 px-xl-2">
                <p [hidden]="err == ''" [style.font-family]="storeInfo().fontName!" class = "text-center mt-1 mb-3" style = "line-height:1.0em; font-size: 12px; height: 15px; font-weight: normal; color: red;">
                  {{err}}
                 </p>
                <div class="text-center mt-2"><a *ngIf="!useOtherPaymentMethod" [style.font-family]="storeInfo().fontName!" class="btn mb-4 d-flex flex-wrap" style="font-weight:bold; font-size:20px; justify-content: center;" (click)="placeOrder($event)" style.background-color="{{selectedTheme()!.color}}" style.color="{{selectedTheme()!.bg_color}}"  [innerHTML]="'Place Order'"></a></div>

                <ngx-stripe-payment-request-button
                *ngIf="isBrowser() && tax() != undefined && billingAddress()?.admin_area != undefined && billingAddress()?.admin_area != ''"
                [paymentOptions]="paymentRequestOptions"
                (paymentMethod)="onPaymentMethod($event)"
                class="mb-4"
                ></ngx-stripe-payment-request-button>

                <div class="text-center mt-4 pt-3 border-top border-bottom">
                <div class="d-flex justify-content-between">
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-bold" style="font-size: 9;">Items ({{itemCount()}}):</h3>
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-normal" style="font-size: 9;">{{formatPrice(d_total(true))}}</h3>
                </div>
                <div class="d-flex justify-content-between">
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-bold" style="font-size: 9;">Shipping & Handling:</h3>
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-normal" style="font-size: 9;">{{shipping()}}</h3>
                </div>
                <div class="d-flex justify-content-between">
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-bold" style="font-size: 9;">Sales Tax:</h3>
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-normal" style="font-size: 9;">{{productTax(true)}}</h3>
                </div>
                <div *ngIf='cartDiscount()' class="d-flex justify-content-between">
                  <h3 style.color="{{selectedTheme()!.color}}" class="fw-bold" style="font-size: 9;">Discount:</h3>
                  <h3 class="fw-normal" style="font-size: 9; color: rgb(192, 19, 19);">-{{formatPrice(orderNum(true)-orderNum())}}</h3>
                </div>
                </div>
                <div class="d-flex justify-content-between pt-2 mt-2">
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-bold" style="font-size: 9;">Order Total:</h3>
                    <h3 style.color="{{selectedTheme()!.color}}" class="fw-normal" style="font-size: 9;">{{orderTotal()}}</h3>
                </div>
                <div class="w-100 d-flex justify-content-end my-1 mb-4">
                  <img class="rounded"  style="object-fit: contain;" [style.height.px]="60"  alt='ok' src="assets/secure.png"/>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
  </section>
