<router-outlet></router-outlet>

<ngx-spinner
*ngIf="isBrowser()" 
bdColor = '{{selectedIndicator().bg_color}}'
size = "large"
color = '{{selectedIndicator().color}}'
type = {{selectedIndicator().name}} 
[fullScreen] = "true"
style.color = "{{selectedIndicator()!.color}}"
>
<h3 class="text-center mt-5" [style.font-family]="storeInfo().fontName!">{{storeInfo()?.fullName}}
</h3>
</ngx-spinner>
  <!-- Header-->
  <header *ngIf="isBrowser()" [hidden]="storeInfo().username == undefined || storeInfo().username == ''" class="bg-{{storeInfo().colorStyle!.back_code}} py-6" style="height: fit-content;">
    <img class="w-100 h-100" [src]='storeInfo()!.themeLink?.toString()'>
  </header>
  
    <section *ngIf="isBrowser() && storeInfo().username != undefined" class="py-5"  style.background-color="{{selectedTheme()!.bg_color}}">
      <div class="container pb-5 mb-2 mb-md-4">
          <div class="row">
            <section class="col-lg-8 order-2 order-sm-1">
              <div *ngIf="hasCart() && loadedCart;" class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-4 pt-3 mt-0">
                  <h2 style.color="{{selectedTheme()!.color}}" [style.font-family]="storeInfo().fontName!" class="h6 mb-1 pb-1 ps-3 mt-2">My Shopping Bag</h2>
                  <div class="py-2 px-xl-2">
                      <div *ngFor="let product of cart()" class="d-sm-flex justify-content-between align-items-center pb-3 pt-3">
                          <div class="d-block d-sm-flex align-items-center text-center text-sm-start"><a role="button" (click)="routeToProduct(product.product!.productID)" class="d-inline-block flex-shrink-0 mx-auto me-sm-4"><img style="border-radius: 2.5%;" src="{{product.product!.url}}" onerror="this.src='https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2Flink_empty.jpeg?alt=media';" width="160" alt="Product"/></a>
                            <div class="pt-2">
                                <p [style.font-family]="storeInfo().fontName!"><a role="button" (click)="routeToProduct(product.product!.productID)" class="text-{{storeInfo().colorStyle!.text_code}} text-decoration-none" style="font-weight: bold;" style.color="{{selectedTheme()!.color}}">{{product.product?.name ?? ""}}</a></p>
                              <div class="fs-sm" [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}"><span [style.font-family]="storeInfo().fontName!" class="text-muted me-2">Size:</span>{{product.size ?? "M"}}</div>
                              <div class="fs-sm" [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}"><span [style.font-family]="storeInfo().fontName!" class="text-muted me-2">Color:</span>{{getColor(product.product)}}</div>
                              <div class="fs-lg text-accent pt-2" [style.font-family]="storeInfo().fontName!" style.color="{{selectedTheme()!.color}}">{{formatPrice(mainPrice(product.product!))}}</div>
                            </div>
                          </div>
                          <div class="pt-2 pt-sm-0 ps-sm-3 mx-auto mx-sm-0 text-center text-sm-start" style="max-width: 5.5rem;">
                            <label [style.font-family]="storeInfo().fontName!" class="form-label" for="quantity1" style.color="{{selectedTheme()!.color}}">Quantity</label>
                            <input [style.font-family]="storeInfo().fontName!" #qtyChooser class="form-control" type="number" id="quantity1" min="1" value="{{product.quantity ?? 1}}" (change)="updateProductQty(product, qtyChooser.value)" style.background-color="{{selectedTheme()!.bg_color}}" style.color="{{selectedTheme()!.color}}"/>
                            <button [style.font-family]="storeInfo().fontName!" class="btn btn-link px-0 text-danger" type="button" (click)="updateProductQty(product, '0')"><i class="ci-close-circle me-0"></i><span class="fs-sm" style="font-size: 10px;">Remove</span></button>
                          </div>
                      </div>
                  </div>
              </div>
              <div *ngIf="!(hasCart()) && loadedCart;" class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-4 pt-3 mt-0">
                  <h2 [style.font-family]="storeInfo().fontName!" class="h6 ps-3 mt-2 text-center" style.color="{{selectedTheme()!.color}}">Your Shopping Bag is Empty</h2>
                  <div class="py-2 px-xl-2">
                      <div class="d-block align-items-center pt-2">
                          <div class="d-block align-items-center text-center text-sm-start"><a class="mx-auto me-sm-4" role="button" (click)="routeToShop()"><img style="border-radius: 2.5%;" src="{{storeInfo()!.actionLink?.toString() ?? ''}}" style="max-width: 100%; height: auto;" alt="Product"/></a>
                            <div class="pt-2">
                                <h2 [style.font-family]="storeInfo().fontName!" class="h6 ps-3 mt-2 text-center"><a role="button" (click)="routeToShop()" class="text-{{storeInfo().colorStyle!.text_code}} text-decoration-underline" style="font-weight: bold;">Shop More Products</a></h2>
                            </div>
                          </div>
                      </div>
                  </div>
              </div>
            </section>
            <!-- Sidebar-->
            <aside class="col-lg-4 pb-2 pb-sm-0 ps-xl-5 order-1 order-sm-2">
              <div class="bg-{{storeInfo().colorStyle!.back_code}} rounded-3 shadow-lg p-4">
                <div class="py-2 px-xl-2">
                  <div [hidden]="stillLoadingProducts()" class="text-center mb-4 pb-3 border-bottom">
                    <h2 [style.font-family]="storeInfo().fontName!" class="h6 mb-3 pb-1" style.color="{{selectedTheme()!.color}}">Subtotal</h2>
                    <h3 [style.font-family]="storeInfo().fontName!" class="fw-normal" style.color="{{selectedTheme()!.color}}">{{formatPrice(total())}}</h3>
                  </div>
                  <h3 *ngIf='cartDiscount() && cartDiscount()!.style == 0' [style.font-family]="storeInfo().fontName!" class="fw-normal text-center" style.color="{{selectedTheme()!.color}}">{{cartDiscount()!.amt * 100}}% off applied at checkout</h3>
                  <h3 *ngIf='cartDiscount() && cartDiscount()!.style == 1' [style.font-family]="storeInfo().fontName!" class="fw-normal text-center" style.color="{{selectedTheme()!.color}}">{{formatPrice(cartDiscount()!.amt * 100)}} off applied at checkout</h3>
                  <div class="text-center my-2"><a *ngIf="hasCart() && loadedCart;" [style.font-family]="storeInfo().fontName!" class="btn mt-auto d-flex flex-wrap" style="font-weight:bold; font-size:20px; justify-content: center;" style.background-color="{{selectedTheme()!.color}}" style.color="{{selectedTheme()!.bg_color}}" (click) = "next()" [innerHTML]="'CHECKOUT'"></a></div>

                  <div class="accordion" id="order-options">
                    <!-- <div class="accordion-item">
                      <h3 class="accordion-header"><a class="accordion-button" href="#promo-code" role="button" data-bs-toggle="collapse" aria-expanded="true" aria-controls="promo-code">Apply promo code</a></h3>
                      <div class="accordion-collapse collapse show" id="promo-code" data-bs-parent="#order-options">
                        <form class="accordion-body needs-validation" novalidate="novalidate">
                          <div class="mb-3">
                            <input (keyup)="onKey($event)"class="form-control" type="text" placeholder="Promo code" required="required"/>
                            <div class="invalid-feedback">Please provide promo code.</div>
                          </div>
                          <button class="btn btn-outline-primary d-block w-100" type="button" (click) = "calculateDiscount()">Apply promo code</button>
                        </form>
                      </div>
                    </div> -->
                    <div class="accordion-item" style.background-color="{{selectedTheme()!.bg_color}}" style.color="{{selectedTheme()!.color}}">
                      <h3 [style.font-family]="storeInfo().fontName!" class="accordion-header" style.color="{{selectedTheme()!.color}}" ><a style.background-color="{{selectedTheme()!.bg_color}}" style.color="{{selectedTheme()!.color}}" class="accordion-button collapsed" href="#shipping-estimates" role="button" data-bs-toggle="collapse" aria-expanded="true" aria-controls="shipping-estimates">Shipping estimates</a></h3>
                      <div class="accordion-collapse collapse" id="shipping-estimates" data-bs-parent="#order-options">
                        <div class="accordion-body">
                          <form class="needs-validation" novalidate="novalidate">
                            <div class="mb-3">
                              <h2 [style.font-family]="storeInfo().fontName!" class="h5 mb-3 pb-1" style.color="{{selectedTheme()!.color}}">Shipping: {{shipping()}}</h2>
                              <select  class="form-select" style.color="{{selectedTheme()!.color}}" style.background-color="{{selectedTheme()!.bg_color}}" (change)="calculateShipping($event)" required="required">
                                <option value="">Choose your country</option>
                                <option value="United States">United States</option>
                                <option value="Canada">Canada</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Australia">Australia</option>
                              </select>
                              
                              <div class="invalid-feedback">Please choose your country!</div>
                            </div>
                            
                            <!-- <div class="mb-3">
                              <select class="form-select" required="required">
                                <option value="">Choose your city</option>
                                <option value="Bern">Bern</option>
                                <option value="Brussels">Brussels</option>
                                <option value="Canberra">Canberra</option>
                                <option value="Helsinki">Helsinki</option>
                                <option value="Mexico City">Mexico City</option>
                                <option value="Ottawa">Ottawa</option>
                                <option value="Washington D.C.">Washington D.C.</option>
                                <option value="Wellington">Wellington</option>
                              </select>
                              <div class="invalid-feedback">Please choose your city!</div>
                            </div> -->
                            <!-- <div class="mb-3">
                              <input class="form-control" type="text" placeholder="ZIP / Postal code" required="required"/>
                              <div class="invalid-feedback">Please provide a valid zip!</div>
                            </div> -->
  
                            <button [style.font-family]="storeInfo().fontName!" class="btn btn-primary d-block w-100" type="button" (click)="calculate()">Calculate shipping</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="w-100 d-flex justify-content-end mt-2 mb-0 ">
                    <img class="rounded"  style="object-fit: contain;" [style.height.px]="60"  alt='ok' src="assets/secure.png"/>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        </div>
    </section>
