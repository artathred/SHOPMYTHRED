exports.id=191,exports.ids=[191],exports.modules={15191:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CheckoutModule:()=>CheckoutModule});var common=__webpack_require__(38583),globals=__webpack_require__(37503),card=__webpack_require__(93738),ngx_spinner=__webpack_require__(79866),asyncToGenerator=__webpack_require__(16304),core=__webpack_require__(37716),ngx_stripe=__webpack_require__(72284),of=__webpack_require__(25917),router=__webpack_require__(95987),platform_browser=__webpack_require__(39075),load_service=__webpack_require__(56105),app_component=__webpack_require__(97430),routing_service=__webpack_require__(78078),icon=__webpack_require__(76627);function CheckoutComponent_ngx_spinner_1_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ngx-spinner",3),core.TgZ(1,"h3",4),core._uU(2),core.qZA(),core.qZA()),2&rf){const ctx_r0=core.oxw();core.Udp("color",ctx_r0.selectedIndicator().color),core.s9C("bdColor",ctx_r0.selectedIndicator().bg_color),core.s9C("color",ctx_r0.selectedIndicator().color),core.s9C("type",ctx_r0.selectedIndicator().name),core.Q6J("fullScreen",!0),core.xp6(1),core.Udp("font-family",ctx_r0.storeInfo().fontName),core.xp6(1),core.hij(" ",ctx_r0.loadingName,"\n")}}function CheckoutComponent_header_2_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"header",5),core.TgZ(1,"div",6),core.TgZ(2,"div",7),core.TgZ(3,"div",8),core.TgZ(4,"p",9),core._uU(5," REVIEW ORDER "),core.qZA(),core.TgZ(6,"p",10),core._uU(7," SECURE CHECKOUT "),core.TgZ(8,"mat-icon",11),core._uU(9," lock "),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA()),2&rf){const ctx_r1=core.oxw();let tmp_2_0;core.Gre("bg-",ctx_r1.storeInfo().colorStyle.back_code," py-6"),core.Q6J("hidden",ctx_r1.stillLoadingProducts()),core.xp6(1),core.Udp("background-image","url("+(null!==(tmp_2_0=null==ctx_r1.storeInfo().themeLink?null:ctx_r1.storeInfo().themeLink.toString())&&void 0!==tmp_2_0?tmp_2_0:"")+")"),core.xp6(3),core.Udp("font-family",ctx_r1.storeInfo().fontName),core.xp6(2),core.Udp("font-family",ctx_r1.storeInfo().fontName),core.xp6(2),core.Q6J("inline",!0)}}function CheckoutComponent_section_3_div_32_Template(rf,ctx){if(1&rf){const _r11=core.EpF();core.TgZ(0,"div",37),core.TgZ(1,"div",38),core.TgZ(2,"a",39),core.NdJ("click",function CheckoutComponent_section_3_div_32_Template_a_click_2_listener(){const product_r7=core.CHM(_r11).$implicit;return core.oxw(2).routeToProduct(product_r7.product.productID)}),core._UZ(3,"img",40),core.qZA(),core.TgZ(4,"div",41),core.TgZ(5,"p"),core.TgZ(6,"a",42),core.NdJ("click",function CheckoutComponent_section_3_div_32_Template_a_click_6_listener(){const product_r7=core.CHM(_r11).$implicit;return core.oxw(2).routeToProduct(product_r7.product.productID)}),core._uU(7),core.qZA(),core.qZA(),core.TgZ(8,"div",43),core.TgZ(9,"span",44),core._uU(10,"Size:"),core.qZA(),core._uU(11),core.qZA(),core.TgZ(12,"div",43),core.TgZ(13,"span",44),core._uU(14,"Color:"),core.qZA(),core._uU(15),core.qZA(),core.TgZ(16,"div",45),core._uU(17),core.qZA(),core.qZA(),core.qZA(),core.TgZ(18,"div",46),core.TgZ(19,"label",47),core._uU(20,"Quantity"),core.qZA(),core.TgZ(21,"input",48,49),core.NdJ("change",function CheckoutComponent_section_3_div_32_Template_input_change_21_listener(){const product_r7=core.CHM(_r11).$implicit,_r9=core.MAs(22);return core.oxw(2).updateProductQty(product_r7,_r9.value)}),core.qZA(),core.TgZ(23,"button",50),core.NdJ("click",function CheckoutComponent_section_3_div_32_Template_button_click_23_listener(){const product_r7=core.CHM(_r11).$implicit;return core.oxw(2).updateProductQty(product_r7,"0")}),core._UZ(24,"i",51),core.TgZ(25,"span",52),core._uU(26,"Remove"),core.qZA(),core.qZA(),core.qZA(),core.qZA()}if(2&rf){const product_r7=ctx.$implicit,ctx_r3=core.oxw(2);let tmp_4_0,tmp_7_0,tmp_19_0;core.xp6(3),core.s9C("src",product_r7.product.url,core.LSH),core.xp6(3),core.Gre("text-",ctx_r3.storeInfo().colorStyle.text_code," text-decoration-none"),core.Udp("font-family",ctx_r3.storeInfo().fontName)("color",ctx_r3.selectedTheme().color),core.xp6(1),core.Oqu(null!==(tmp_4_0=null==product_r7.product?null:product_r7.product.name)&&void 0!==tmp_4_0?tmp_4_0:""),core.xp6(1),core.Udp("font-family",ctx_r3.storeInfo().fontName)("color",ctx_r3.selectedTheme().color),core.xp6(3),core.Oqu(null!==(tmp_7_0=product_r7.size)&&void 0!==tmp_7_0?tmp_7_0:"M"),core.xp6(1),core.Udp("font-family",ctx_r3.storeInfo().fontName)("color",ctx_r3.selectedTheme().color),core.xp6(3),core.Oqu(ctx_r3.getColor(product_r7.product)),core.xp6(1),core.Udp("font-family",ctx_r3.storeInfo().fontName)("color",ctx_r3.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r3.formatPrice(ctx_r3.mainPrice(product_r7.product))),core.xp6(2),core.Udp("font-family",ctx_r3.storeInfo().fontName)("color",ctx_r3.selectedTheme().color),core.xp6(2),core.Udp("font-family",ctx_r3.storeInfo().fontName)("background-color",ctx_r3.selectedTheme().bg_color)("color",ctx_r3.selectedTheme().color),core.s9C("value",null!==(tmp_19_0=product_r7.quantity)&&void 0!==tmp_19_0?tmp_19_0:1),core.xp6(2),core.Udp("font-family",ctx_r3.storeInfo().fontName)}}function CheckoutComponent_section_3_a_39_Template(rf,ctx){if(1&rf){const _r16=core.EpF();core.TgZ(0,"a",53),core.NdJ("click",function CheckoutComponent_section_3_a_39_Template_a_click_0_listener($event){core.CHM(_r16);return core.oxw(2).placeOrder($event)}),core.qZA()}if(2&rf){const ctx_r4=core.oxw(2);core.Udp("font-family",ctx_r4.storeInfo().fontName)("background-color",ctx_r4.selectedTheme().color)("color",ctx_r4.selectedTheme().bg_color),core.Q6J("innerHTML","Place Order",core.oJD)}}function CheckoutComponent_section_3_ngx_stripe_payment_request_button_40_Template(rf,ctx){if(1&rf){const _r18=core.EpF();core.TgZ(0,"ngx-stripe-payment-request-button",54),core.NdJ("paymentMethod",function CheckoutComponent_section_3_ngx_stripe_payment_request_button_40_Template_ngx_stripe_payment_request_button_paymentMethod_0_listener($event){core.CHM(_r18);return core.oxw(2).onPaymentMethod($event)}),core.qZA()}if(2&rf){const ctx_r5=core.oxw(2);core.Q6J("paymentOptions",ctx_r5.paymentRequestOptions)}}function CheckoutComponent_section_3_div_57_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",30),core.TgZ(1,"h3",31),core._uU(2,"Discount:"),core.qZA(),core.TgZ(3,"h3",55),core._uU(4),core.qZA(),core.qZA()),2&rf){const ctx_r6=core.oxw(2);core.xp6(1),core.Udp("color",ctx_r6.selectedTheme().color),core.xp6(3),core.hij("-",ctx_r6.formatPrice(ctx_r6.orderNum(!0)-ctx_r6.orderNum()),"")}}function CheckoutComponent_section_3_Template(rf,ctx){if(1&rf){const _r20=core.EpF();core.TgZ(0,"section",12),core.TgZ(1,"div",13),core.TgZ(2,"div",14),core.TgZ(3,"section",15),core.TgZ(4,"div"),core.TgZ(5,"div",16),core.TgZ(6,"div",17),core.TgZ(7,"h2",18),core._uU(8,"1. Shipping Address"),core.qZA(),core.TgZ(9,"h3",19),core._uU(10),core.qZA(),core.TgZ(11,"h3",19),core._uU(12),core.qZA(),core.TgZ(13,"h3",19),core._uU(14),core.qZA(),core.TgZ(15,"p"),core.TgZ(16,"a",20),core.NdJ("click",function CheckoutComponent_section_3_Template_a_click_16_listener(){core.CHM(_r20);return core.oxw().routeToShipping()}),core._uU(17,"Change"),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.TgZ(18,"div"),core.TgZ(19,"div",16),core.TgZ(20,"div",17),core.TgZ(21,"h2",18),core._uU(22,"2. Payment Method "),core.qZA(),core.TgZ(23,"h3",19),core._uU(24),core.qZA(),core.TgZ(25,"p"),core.TgZ(26,"a",20),core.NdJ("click",function CheckoutComponent_section_3_Template_a_click_26_listener(){core.CHM(_r20);return core.oxw().routeToBilling()}),core._uU(27,"Change"),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.TgZ(28,"div"),core.TgZ(29,"h2",21),core._uU(30,"3. Review Order"),core.qZA(),core.TgZ(31,"div",22),core.YNc(32,CheckoutComponent_section_3_div_32_Template,27,44,"div",23),core.qZA(),core.qZA(),core.qZA(),core.TgZ(33,"aside",24),core.TgZ(34,"div",5),core.TgZ(35,"div",22),core.TgZ(36,"p",25),core._uU(37),core.qZA(),core.TgZ(38,"div",26),core.YNc(39,CheckoutComponent_section_3_a_39_Template,1,9,"a",27),core.qZA(),core.YNc(40,CheckoutComponent_section_3_ngx_stripe_payment_request_button_40_Template,1,1,"ngx-stripe-payment-request-button",28),core.TgZ(41,"div",29),core.TgZ(42,"div",30),core.TgZ(43,"h3",31),core._uU(44),core.qZA(),core.TgZ(45,"h3",32),core._uU(46),core.qZA(),core.qZA(),core.TgZ(47,"div",30),core.TgZ(48,"h3",31),core._uU(49,"Shipping & Handling:"),core.qZA(),core.TgZ(50,"h3",32),core._uU(51),core.qZA(),core.qZA(),core.TgZ(52,"div",30),core.TgZ(53,"h3",31),core._uU(54,"Sales Tax:"),core.qZA(),core.TgZ(55,"h3",32),core._uU(56),core.qZA(),core.qZA(),core.YNc(57,CheckoutComponent_section_3_div_57_Template,5,4,"div",33),core.qZA(),core.TgZ(58,"div",34),core.TgZ(59,"h3",31),core._uU(60,"Order Total:"),core.qZA(),core.TgZ(61,"h3",32),core._uU(62),core.qZA(),core.qZA(),core.TgZ(63,"div",35),core._UZ(64,"img",36),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA(),core.qZA()}if(2&rf){const ctx_r2=core.oxw();let tmp_36_0;core.Udp("background-color",ctx_r2.selectedTheme().bg_color),core.Q6J("hidden",ctx_r2.stillLoadingProducts()),core.xp6(4),core.Gre("bg-",ctx_r2.storeInfo().colorStyle.back_code," rounded-3 shadow-lg p-2 pb-1"),core.xp6(2),core.Q6J("hidden",ctx_r2.stillLoadingProducts()),core.xp6(1),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.getShippingAddressFirst()),core.xp6(1),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.getShippingAddressSecond()),core.xp6(1),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.getShippingAddressThird()),core.xp6(2),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Gre("bg-",ctx_r2.storeInfo().colorStyle.back_code," rounded-3 shadow-lg p-2 pt-3 pb-1 mt-3"),core.xp6(2),core.Q6J("hidden",ctx_r2.stillLoadingProducts()),core.xp6(1),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.getBillingAddressFirst()),core.xp6(2),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Gre("bg-",ctx_r2.storeInfo().colorStyle.back_code," rounded-3 shadow-lg p-4 pt-3 mt-3"),core.xp6(1),core.Udp("font-family",ctx_r2.storeInfo().fontName)("color",ctx_r2.selectedTheme().color),core.xp6(3),core.Q6J("ngForOf",ctx_r2.cart()),core.xp6(2),core.Gre("bg-",ctx_r2.storeInfo().colorStyle.back_code," rounded-3 shadow-lg p-4 pb-0"),core.Q6J("hidden",ctx_r2.stillLoading()),core.xp6(2),core.Udp("font-family",ctx_r2.storeInfo().fontName),core.Q6J("hidden",""==ctx_r2.err),core.xp6(1),core.hij(" ",ctx_r2.err," "),core.xp6(2),core.Q6J("ngIf",!ctx_r2.useOtherPaymentMethod),core.xp6(1),core.Q6J("ngIf",ctx_r2.isBrowser()&&null!=ctx_r2.tax()&&null!=(null==(tmp_36_0=ctx_r2.billingAddress())?null:tmp_36_0.admin_area)&&""!=(null==(tmp_36_0=ctx_r2.billingAddress())?null:tmp_36_0.admin_area)),core.xp6(3),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(1),core.hij("Items (",ctx_r2.itemCount(),"):"),core.xp6(1),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.formatPrice(ctx_r2.d_total(!0))),core.xp6(2),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.shipping()),core.xp6(2),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.productTax(!0)),core.xp6(1),core.Q6J("ngIf",ctx_r2.cartDiscount()),core.xp6(2),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(2),core.Udp("color",ctx_r2.selectedTheme().color),core.xp6(1),core.Oqu(ctx_r2.orderTotal()),core.xp6(2),core.Udp("height",60,"px")}}class CheckoutComponent{constructor(platformID,stripeKey,cdr,router,_router,titleService,metaService,loadService,spinner,rootComponent,stripeService,routingService){var _a;this.platformID=platformID,this.stripeKey=stripeKey,this.cdr=cdr,this.router=router,this._router=_router,this.titleService=titleService,this.metaService=metaService,this.loadService=loadService,this.spinner=spinner,this.rootComponent=rootComponent,this.stripeService=stripeService,this.routingService=routingService,this.useCard=!1,this.err="",this.loadingName="",this.isSpinning=!1,this.useOtherPaymentMethod=!1,this.paymentRequestOptions={country:"US",currency:"usd",total:{label:"Thred Apps Inc.",amount:0},requestPayerName:!1,requestPayerEmail:!1},this.useOtherPaymentMethod=null!==(_a=globals.O.useOtherPaymentMethod)&&void 0!==_a&&_a}storeInfo(){return globals.O.storeInfo}availableCurrencies(){return globals.O.availableCurrencies}selectedCurrency(){return globals.O.selectedCurrency}templates(){return globals.O.availableTemplates}availableTemplates(){return globals.O.availableTemplates}selectedTemplate(){return globals.O.selectedTemplate}shippingAddress(){return globals.O.shippingInfo}billingAddress(){return globals.O.billingInfo}tax(){return globals.O.shippingTax}cartLength(){var _a,_b;return 0==(null===(_a=this.rootComponent.cart)||void 0===_a?void 0:_a.length)?"":null===(_b=this.rootComponent.cart)||void 0===_b?void 0:_b.length}cart(){var _a;return null!==(_a=this.rootComponent.cart)&&void 0!==_a?_a:[]}routeToCart(){this.rootComponent.routeToCart()}productTax(noCoupon=!1){var _a;let tax=null!==(_a=this.productTaxNum(noCoupon))&&void 0!==_a?_a:0;return tax>0?this.numberWithCommas(this.formatPrice(null!=tax?tax:0)):"N/A"}productTaxNum(noCoupon=!1){var _a;return(this.d_total(noCoupon)+this.shippingNum())*(null!==(_a=this.tax())&&void 0!==_a?_a:0)}orderTotal(noCoupon=!1){return this.numberWithCommas(this.formatPrice(this.orderNum(noCoupon)))}orderNum(noCoupon=!1){return this.total(noCoupon)+this.shippingNum()+this.productTaxNum(noCoupon)}getColor(product){var _a,_b,_c;let colors=null===(_a=globals.O.templates.find(template=>template.productCode==(null==product?void 0:product.productType)))||void 0===_a?void 0:_a.colors;return null!==(_c=null===(_b=null==colors?void 0:colors.find(color=>color.code==(null==product?void 0:product.templateColor)))||void 0===_b?void 0:_b.display)&&void 0!==_c?_c:"White"}stillLoadingProducts(){var _a,_b;return 0!=(null===(_b=null===(_a=this.rootComponent.cart)||void 0===_a?void 0:_a.filter(product=>{var _a;return null==(null===(_a=product.product)||void 0===_a?void 0:_a.price)}))||void 0===_b?void 0:_b.length)}stillLoading(){var _a,_b,_c,_d;return 0!=(null===(_b=null===(_a=this.rootComponent.cart)||void 0===_a?void 0:_a.filter(product=>{var _a;return null==(null===(_a=product.product)||void 0===_a?void 0:_a.price)}))||void 0===_b?void 0:_b.length)||0!=(null===(_d=null===(_c=globals.O.availableCurrencies)||void 0===_c?void 0:_c.filter(currency=>null==currency.shipping_rate_usd))||void 0===_d?void 0:_d.length)||null==globals.O.shippingTax}calculateShipping($event){let country=$event.target.options[$event.target.options.selectedIndex].text;this.selectedCountry=country}onKey(event){const inputValue=event.target.value;this.selectedCode=inputValue}calculateDiscount(){}updateProductQty(product,newQty){var _this=this;return(0,asyncToGenerator.Z)(function*(){var _a,_b,_c;product.quantity=Number(newQty);let mappedData=[],dataToRemove=[];null===(_a=_this.rootComponent.cart)||void 0===_a||_a.forEach((cartProduct,index)=>{var _a,_b,_c;if((null!==(_a=cartProduct.quantity)&&void 0!==_a?_a:0)>0){let data={UID:null===(_b=cartProduct.product)||void 0===_b?void 0:_b.uid,Size:cartProduct.size,Qty:cartProduct.quantity,Timestamp:cartProduct.timestamp,Post_ID:null===(_c=cartProduct.product)||void 0===_c?void 0:_c.productID};mappedData.push(data)}else dataToRemove.push(cartProduct)}),_this.rootComponent.cart=null===(_b=_this.rootComponent.cart)||void 0===_b?void 0:_b.filter(cartProduct=>!dataToRemove.includes(cartProduct)),yield _this.loadService.changeCart(mappedData),0!=(null===(_c=_this.rootComponent.cart)||void 0===_c?void 0:_c.length)?(_this.updatePayBtnOptions(),_this.cdr.detectChanges()):_this.routeToCart()})()}calculate(){this.cdr.detectChanges()}shipping(){var _a,_b;let shipping=(null!==(_b=null===(_a=globals.O.availableCurrencies.find(country=>country.name_full==this.selectedCountry))||void 0===_a?void 0:_a.shipping_rate_usd)&&void 0!==_b?_b:0)/100;return shipping>0?this.numberWithCommas(this.formatPrice(shipping)):"FREE"}shippingNum(){var _a,_b;return(null!==(_b=null===(_a=globals.O.availableCurrencies.find(country=>country.name_full==this.selectedCountry))||void 0===_a?void 0:_a.shipping_rate_usd)&&void 0!==_b?_b:0)/100}autoCoupon(product){var _a;return null===(_a=this.storeInfo().coupons)||void 0===_a?void 0:_a.filter(coupon=>coupon.products.includes(product.productID)&&coupon.auto).sort(function(a,b){return a.amt<b.amt?1:a.amt>b.amt?-1:0})[0]}cartDiscount(){var _a;return null===(_a=this.storeInfo().coupons)||void 0===_a?void 0:_a.filter(coupon=>{var _a;return"order_qty"==coupon.type&&this.totalLength()>=coupon.threshold||"order_val"==coupon.type&&(null!==(_a=this.total(!0))&&void 0!==_a?_a:0)>=coupon.threshold&&coupon.auto}).sort(function(a,b){return a.amt<b.amt?1:a.amt>b.amt?-1:0})[0]}mainPrice(product,cartDiscounts=!1){var _a,_b,_c,_d,_e,_f,_g,_h;let coupon=this.autoCoupon(product);if(coupon&&(!this.cartDiscount()||1==(null===(_a=this.cartDiscount())||void 0===_a?void 0:_a.style)&&1==coupon.style)){if(0==coupon.style)return(null!==(_b=product.price)&&void 0!==_b?_b:0)/100-(null!==(_c=product.price)&&void 0!==_c?_c:0)/100*coupon.amt;if(1==coupon.style)return(null!==(_d=product.price)&&void 0!==_d?_d:0)/100-100*(null!==(_e=coupon.amt)&&void 0!==_e?_e:0)}if(cartDiscounts){let cartCoupon=this.cartDiscount();if(cartCoupon&&0==cartCoupon.style)return(null!==(_f=product.price)&&void 0!==_f?_f:0)/100-(null!==(_g=product.price)&&void 0!==_g?_g:0)/100*cartCoupon.amt}return(null!==(_h=product.price)&&void 0!==_h?_h:0)/100}total(noCoupon=!1){var _a,_b,f,total=0;return null===(_a=this.rootComponent.cart)||void 0===_a||_a.forEach(product=>{var _a,_b,_c,_d,_e,_f,_g,_h;if(noCoupon){var coupon=this.autoCoupon(product.product);0==(null==coupon?void 0:coupon.style)?total+=(null!==(_b=null===(_a=product.product)||void 0===_a?void 0:_a.price)&&void 0!==_b?_b:0)*(null!==(_c=product.quantity)&&void 0!==_c?_c:1):total+=((null!==(_e=null===(_d=product.product)||void 0===_d?void 0:_d.price)&&void 0!==_e?_e:0)-1e4*(null!==(_f=null==coupon?void 0:coupon.amt)&&void 0!==_f?_f:0))*(null!==(_g=product.quantity)&&void 0!==_g?_g:1)}else{total+=100*this.mainPrice(product.product,!0)*(null!==(_h=product.quantity)&&void 0!==_h?_h:1);let l=this.cartDiscount();1==(null==l?void 0:l.style)&&(f=l)}}),noCoupon?total/100:total/100-100*(null!==(_b=null==f?void 0:f.amt)&&void 0!==_b?_b:0)}d_total(noCoupon=!1){var _a,total=0;return null===(_a=this.rootComponent.cart)||void 0===_a||_a.forEach(product=>{var _a,_b;total+=noCoupon?100*this.mainPrice(product.product,!1)*(null!==(_a=product.quantity)&&void 0!==_a?_a:1):100*this.mainPrice(product.product,!0)*(null!==(_b=product.quantity)&&void 0!==_b?_b:1)}),total/100}format(d){return globals.O.months[d.getMonth()].substring(0,3)+" "+d.getDate()+" "+d.getFullYear()}hasCart(){var _a,_b;return null!==(_b=0!=(null===(_a=this.rootComponent.cart)||void 0===_a?void 0:_a.length))&&void 0!==_b&&_b}callback(){var _this2=this;return(0,asyncToGenerator.Z)(function*(){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r;if(yield _this2.loadService.authenticated())if(globals.O.storeInfo.username)if(_this2.loadingName=null!==(_b=null===(_a=_this2.storeInfo())||void 0===_a?void 0:_a.fullName)&&void 0!==_b?_b:"",_this2.showSpinner(),_this2.rootComponent.setFavIcon(null!==(_d=null===(_c=globals.O.storeInfo.profileLink)||void 0===_c?void 0:_c.toString())&&void 0!==_d?_d:""),_this2.rootComponent.setOptions(),_this2.addTags(null!==(_e=globals.O.storeInfo.fullName)&&void 0!==_e?_e:"Thred",(null!==(_f=globals.O.storeInfo.profileLink)&&void 0!==_f?_f:new URL("https://shopmythred.com")).toString(),null!==(_g=globals.O.storeInfo.bio)&&void 0!==_g?_g:"Check out my Thred Store!","shopmythred.com/"+globals.O.storeInfo.username),null==globals.O.userInfo&&(0,common.NF)(_this2.platformID))_this2.loadService.getCustomer();else{if(0==(null===(_h=_this2.rootComponent.cart)||void 0===_h?void 0:_h.length)&&(0,common.NF)(_this2.platformID))return void _this2.routeToCart();if(null==globals.O.shippingInfo&&(0,common.NF)(_this2.platformID))_this2.loadService.getShippingAddress();else{if((""==(null===(_j=globals.O.shippingInfo)||void 0===_j?void 0:_j.email)||null==(null===(_k=globals.O.shippingInfo)||void 0===_k?void 0:_k.email))&&(0,common.NF)(_this2.platformID))return void _this2.routeToCart();if(!_this2.useOtherPaymentMethod&&null==globals.O.billingInfo&&(0,common.NF)(_this2.platformID))_this2.loadService.getBillingInfo();else{if(!(_this2.useOtherPaymentMethod||""!=(null===(_l=globals.O.billingInfo)||void 0===_l?void 0:_l.number)&&null!=(null===(_m=globals.O.billingInfo)||void 0===_m?void 0:_m.number))&&(0,common.NF)(_this2.platformID))return void _this2.routeToBilling();0==globals.O.availableCurrencies.length&&(0,common.NF)(_this2.platformID)?_this2.loadService.getCountries():0==globals.O.templates.length&&(0,common.NF)(_this2.platformID)?_this2.loadService.getTemplates():null==(null===(_o=globals.O.billingInfo)||void 0===_o?void 0:_o.admin_area)||""==(null===(_p=globals.O.billingInfo)||void 0===_p?void 0:_p.admin_area)&&(0,common.NF)(_this2.platformID)?_this2.loadService.getBillingAddress():null==globals.O.shippingTax&&(null===(_q=globals.O.billingInfo)||void 0===_q?void 0:_q.admin_area)&&""!=(null===(_r=globals.O.billingInfo)||void 0===_r?void 0:_r.admin_area)&&(0,common.NF)(_this2.platformID)?_this2.loadService.getTax(_this2.billingAddress()):(console.log(globals.O.billingInfo.country),_this2.updatePayBtnOptions(),_this2.cdr.detectChanges())}}}else _this2.routingService.routeTo404(_this2.getStoreName().isCustom);else _this2.routeToCart()})()}updatePayBtnOptions(){var _a,_b,_c,_d;let same=null===(_a=globals.O.availableCurrencies)||void 0===_a?void 0:_a.filter(currency=>{var _a;return currency.name_full==(null===(_a=globals.O.billingInfo)||void 0===_a?void 0:_a.country)});if(same&&0!=same.length){const amount=Math.round(100*(null!==(_b=(this.total()+this.shippingNum()+this.productTaxNum())*same[0].rate)&&void 0!==_b?_b:1));console.log(same[0].currency_name),console.log(amount),this.paymentRequestOptions={country:same[0].name,currency:same[0].currency_name.toLowerCase(),total:{label:null!==(_c=globals.O.storeInfo.fullName)&&void 0!==_c?_c:"Thred Apps Inc.",amount:amount},requestPayerName:!0,requestPayerEmail:!0},console.log(this.paymentRequestOptions)}else{const amount=Math.round(100*(this.total()+this.shippingNum()+this.productTaxNum()));console.log(same[0].currency_name),console.log(amount),this.paymentRequestOptions={country:"US",currency:"usd",total:{label:null!==(_d=globals.O.storeInfo.fullName)&&void 0!==_d?_d:"Thred Apps Inc.",amount:amount},requestPayerName:!0,requestPayerEmail:!0}}}theme(){return"light"==this.storeInfo().colorStyle.back_code?"dark":"light"}selectedIndicator(){var _a,_b,_c,_d,_e,_f;let co=null===(_b=null===(_a=globals.O.storeInfo)||void 0===_a?void 0:_a.loading)||void 0===_b?void 0:_b.color,bco=null===(_d=null===(_c=globals.O.storeInfo)||void 0===_c?void 0:_c.loading)||void 0===_d?void 0:_d.bg_color;return{name:null===(_f=null===(_e=globals.O.storeInfo)||void 0===_e?void 0:_e.loading)||void 0===_f?void 0:_f.name,color:"rgba("+co[0]+","+co[1]+","+co[2]+","+co[3]+")",bg_color:"rgba("+bco[0]+","+bco[1]+","+bco[2]+","+bco[3]+")"}}selectedTheme(){var _a,_b,_c,_d,_e,_f;let co=null===(_b=null===(_a=globals.O.storeInfo)||void 0===_a?void 0:_a.colorStyle)||void 0===_b?void 0:_b.btn_color,bco=null===(_d=null===(_c=globals.O.storeInfo)||void 0===_c?void 0:_c.colorStyle)||void 0===_d?void 0:_d.bg_color;return{name:null===(_f=null===(_e=globals.O.storeInfo)||void 0===_e?void 0:_e.colorStyle)||void 0===_f?void 0:_f.name,color:"rgba("+co[0]+","+co[1]+","+co[2]+","+co[3]+")",bg_color:"rgba("+bco[0]+","+bco[1]+","+bco[2]+","+bco[3]+")"}}showSpinner(){this.isSpinning||(this.isSpinning=!0,(0,common.NF)(this.platformID)&&this.spinner.show(),setTimeout(()=>{this.spinner.hide()},1500))}hideSpinner(){this.isSpinning&&(this.isSpinning=!1)}routeToProduct(productID){this.rootComponent.routeToProduct(productID)}routeToShipping(){this.rootComponent.routeToShipping()}routeToBilling(){this.rootComponent.routeToBilling()}routeToShop(){this.rootComponent.routeToShop()}placeOrder(event){this.loadingName="Placing Order...",(0,common.NF)(this.platformID)&&this.spinner.show(),event.target.disabled=!0;let storeID=this.storeInfo().uid;this.loadService.createPayment(storeID,!0,(order_id,client_secret,err)=>{this.spinner.hide(),err?this.err=err:this.finishedOrder(order_id,client_secret)},this.cartDiscount())}finishedOrder(order_id,_client_secret){this.loadingName="",(0,common.NF)(this.platformID)&&this.spinner.hide(),this.rootComponent.routeToOrder(order_id)}init(){globals.O.shippingInfo=void 0,globals.O.billingInfo=void 0,globals.O.shippingTax=void 0;const storeInfo=this.getStoreName();this.downloadAllStoreInfo(storeInfo.link,storeInfo.isCustom)}downloadAllStoreInfo(storeName,isCustom=!1){this.loadService.myCallback=()=>this.callback(),this.loadService.getUser(storeName,void 0,isCustom)}getStoreName(){var request="";if((0,common.PM)(this.platformID)?(request=globals.O.URL,console.log(request)):request=globalThis.location.host,"localhost:4200"!=request&&"shopmythred.com"!=request)return{isCustom:!0,link:request};return{isCustom:!1,link:this.router.snapshot.paramMap.get("user")}}onPaymentMethod(ev){let storeID=this.storeInfo().uid;this.loadService.createPayment(storeID,!1,(order_id,client_secret,err)=>this.stripeService.confirmCardPayment(client_secret,{payment_method:ev.paymentMethod.id},{handleActions:!1}).subscribe(confirmResult=>confirmResult.error?(this.err=err,ev.complete("fail"),console.log(confirmResult.error),(0,of.of)({error:new Error("Error Confirming the payment")})):(console.log("success"),ev.complete("success"),this.finishedOrder(order_id,client_secret))))}getShippingAddressSecond(){var _a,_b,address=null===(_a=this.shippingAddress())||void 0===_a?void 0:_a.street,unit=null===(_b=this.shippingAddress())||void 0===_b?void 0:_b.unit;return unit&&(address+=". "+unit),address}getShippingAddressThird(){var _a,_b,_c;return(null===(_a=this.shippingAddress())||void 0===_a?void 0:_a.city)+", "+(null===(_b=this.shippingAddress())||void 0===_b?void 0:_b.admin_area)+". "+(null===(_c=this.shippingAddress())||void 0===_c?void 0:_c.postal)}itemCount(){var _a,count=0;return null===(_a=this.rootComponent.cart)||void 0===_a||_a.forEach(product=>{var _a;count+=null!==(_a=product.quantity)&&void 0!==_a?_a:0}),count}getShippingAddressFirst(){var _a,_b,name=null===(_a=this.shippingAddress())||void 0===_a?void 0:_a.name,company=null===(_b=this.shippingAddress())||void 0===_b?void 0:_b.company;return company&&(name+=" - "+company),name}getBillingAddressFirst(){var _a,_b,_c,_d,name=null!==(_d=this.titleCase(null!==(_b=null===(_a=this.billingAddress())||void 0===_a?void 0:_a.brand)&&void 0!==_b?_b:"")+" ending in "+(null===(_c=this.billingAddress())||void 0===_c?void 0:_c.number))&&void 0!==_d?_d:"";return this.useOtherPaymentMethod&&(name=""),name}totalLength(){var _a,total=0;return null===(_a=this.rootComponent.cart)||void 0===_a||_a.forEach(product=>{var _a;total+=null!==(_a=product.quantity)&&void 0!==_a?_a:1}),total}titleCase(str=""){for(var splitStr=str.toLowerCase().split(" "),i=0;i<splitStr.length;i++)splitStr[i]=splitStr[i].charAt(0).toUpperCase()+splitStr[i].substring(1);return splitStr.join(" ")}isBrowser(){return(0,common.NF)(this.platformID)}formatPrice(price){var priceAsString=new String((price*globals.O.selectedCurrency.rate).toFixed(2));switch(priceAsString.indexOf(".")){case priceAsString.length-1:priceAsString+="00";break;case priceAsString.length-2:priceAsString+="0"}return this.numberWithCommas(this.getCurrencyForCountry(globals.O.selectedCurrency,"US"!=globals.O.selectedCurrency.name)+priceAsString)}numberWithCommas(x){return x.replace(/\B(?=(\d{3})+(?!\d))/g,",")}getCurrencyForCountry(country,shouldShowName){var returnItem=country.currency_symbol;return shouldShowName&&(returnItem=country.name+" "+returnItem),returnItem}addTags(title,imgUrl,description,url){this.metaService.updateTag({property:"og:title",content:title+" - Checkout"}),this.metaService.updateTag({property:"og:image:width",content:"200"}),this.metaService.updateTag({property:"og:image:height",content:"200"}),this.metaService.updateTag({property:"og:image",content:imgUrl}),this.metaService.updateTag({property:"og:url",content:url}),this.metaService.updateTag({property:"og:description",content:description}),this.titleService.setTitle(title),this.metaService.updateTag({property:"description",content:description})}ngAfterViewInit(){}ngOnInit(){this.init()}}CheckoutComponent.\u0275fac=function CheckoutComponent_Factory(t){return new(t||CheckoutComponent)(core.Y36(core.Lbi),core.Y36(ngx_stripe.QZ),core.Y36(core.sBO),core.Y36(router.gz),core.Y36(router.F0),core.Y36(platform_browser.Dx),core.Y36(platform_browser.h_),core.Y36(load_service.J),core.Y36(ngx_spinner.t2),core.Y36(app_component.y),core.Y36(ngx_stripe.tJ),core.Y36(routing_service.Z))},CheckoutComponent.\u0275cmp=core.Xpm({type:CheckoutComponent,selectors:[["app-checkout"]],decls:4,vars:3,consts:[["size","large",3,"bdColor","color","type","fullScreen",4,"ngIf"],[3,"hidden","class",4,"ngIf"],["class","py-5",3,"hidden","background-color",4,"ngIf"],["size","large",3,"bdColor","color","type","fullScreen"],[1,"text-center","mt-5"],[3,"hidden"],[1,"cover",2,"background-image","url(https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2FSample-Walls%2FHome%2F1.jpg?alt=media)"],[1,"d-flex","align-items-center","justify-content-center",2,"height","200px","font-weight","bold","font-size","30px"],[1,"px-2"],[1,"text-center",2,"line-height","1.2em","text-shadow","2px 2px 4px #42424281"],[1,"text-center",2,"line-height","1.2em","font-size","25px","text-shadow","2px 2px 4px #42424281"],[3,"inline"],[1,"py-5",3,"hidden"],[1,"container","pb-5","mb-2","mb-md-4"],[1,"row"],[1,"col-lg-8","order-2","order-sm-1"],[1,"py-0","px-xl-2"],[1,"text-accent",3,"hidden"],[1,"h6","mb-3","pb-1","ps-4","mt-2"],[1,"fw-normal","ps-4",2,"font-style","italic"],["role","button",1,"text-primary","text-decoration-none","ps-4",2,"font-weight","bold",3,"click"],[1,"h6","mb-1","pb-1","ps-2","mt-2"],[1,"py-2","px-xl-2"],["class","d-sm-flex justify-content-between align-items-center pb-3 pt-3",4,"ngFor","ngForOf"],[1,"col-lg-4","pb-2","pb-sm-0","ps-xl-5","order-1","order-sm-2"],[1,"text-center","mt-1","mb-3",2,"line-height","1.0em","font-size","12px","height","15px","font-weight","normal","color","red",3,"hidden"],[1,"text-center","mt-2"],["class","btn mb-4 d-flex flex-wrap","style","font-weight:bold; font-size:20px; justify-content: center;",3,"font-family","background-color","color","innerHTML","click",4,"ngIf"],["class","mb-4",3,"paymentOptions","paymentMethod",4,"ngIf"],[1,"text-center","mt-4","pt-3","border-top","border-bottom"],[1,"d-flex","justify-content-between"],[1,"fw-bold",2,"font-size","9"],[1,"fw-normal",2,"font-size","9"],["class","d-flex justify-content-between",4,"ngIf"],[1,"d-flex","justify-content-between","pt-2","mt-2"],[1,"w-100","d-flex","justify-content-end","my-1","mb-4"],["alt","ok","src","assets/secure.png",1,"rounded",2,"object-fit","contain"],[1,"d-sm-flex","justify-content-between","align-items-center","pb-3","pt-3"],[1,"d-block","d-sm-flex","align-items-center","text-center","text-sm-start"],["role","button",1,"d-inline-block","flex-shrink-0","mx-auto","me-sm-4",3,"click"],["onerror","this.src='https://firebasestorage.googleapis.com/v0/b/clothingapp-ed125.appspot.com/o/Resources%2Flink_empty.jpeg?alt=media';","width","160","alt","Product",2,"border-radius","2.5%",3,"src"],[1,"pt-2"],["role","button",2,"font-weight","bold",3,"click"],[1,"fs-sm"],[1,"text-muted","me-2"],[1,"fs-lg","text-accent","pt-2"],[1,"pt-2","pt-sm-0","ps-sm-3","mx-auto","mx-sm-0","text-center","text-sm-start",2,"max-width","5.5rem"],["for","quantity_i",1,"form-label"],["type","number","id","quantity_i","min","1",1,"form-control",3,"value","change"],["qtyChooser",""],["type","button",1,"btn","btn-link","px-0","text-danger",3,"click"],[1,"ci-close-circle","me-0"],[1,"fs-sm",2,"font-size","10px"],[1,"btn","mb-4","d-flex","flex-wrap",2,"font-weight","bold","font-size","20px","justify-content","center",3,"innerHTML","click"],[1,"mb-4",3,"paymentOptions","paymentMethod"],[1,"fw-normal",2,"font-size","9","color","rgb(192, 19, 19)"]],template:function CheckoutComponent_Template(rf,ctx){1&rf&&(core._UZ(0,"router-outlet"),core.YNc(1,CheckoutComponent_ngx_spinner_1_Template,3,10,"ngx-spinner",0),core.YNc(2,CheckoutComponent_header_2_Template,10,11,"header",1),core.YNc(3,CheckoutComponent_section_3_Template,65,107,"section",2)),2&rf&&(core.xp6(1),core.Q6J("ngIf",ctx.isBrowser()),core.xp6(1),core.Q6J("ngIf",ctx.isBrowser()&&ctx.hasCart()&&null!=ctx.storeInfo().username),core.xp6(1),core.Q6J("ngIf",ctx.isBrowser()&&ctx.hasCart()&&null!=ctx.storeInfo().username))},directives:[router.lC,common.O5,ngx_spinner.Ro,icon.Hw,common.sg,ngx_stripe.T1],styles:[".centered[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.cover[_ngcontent-%COMP%]{color:#fff;position:relative;background-repeat:no-repeat;background-position-x:center;background-position-y:center;background-size:cover}"]});const routes=[{path:"",component:CheckoutComponent}];class CheckoutModule{}CheckoutModule.\u0275fac=function CheckoutModule_Factory(t){return new(t||CheckoutModule)},CheckoutModule.\u0275mod=core.oAB({type:CheckoutModule,bootstrap:[CheckoutComponent]}),CheckoutModule.\u0275inj=core.cJS({providers:[globals.O],imports:[[common.ez,card.QW,icon.Ps,ngx_spinner.ef,router.Bz.forChild(routes),ngx_stripe.lO.forRoot("pk_live_m7nEWhyTHoxGspcxtJAci6pu002LUiOnJK")]]})}};